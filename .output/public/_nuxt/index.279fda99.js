var Ar=Object.defineProperty;var Er=(n,t,e)=>t in n?Ar(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var P=(n,t,e)=>(Er(n,typeof t!="symbol"?t+"":t,e),e);import{E as Xe,b as zt}from"./entry.87fa91ac.js";var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function In(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function r(){if(this instanceof r){var u=[null];u.push.apply(u,arguments);var f=Function.bind.apply(t,u);return new f}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var u=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,u.get?u:{enumerable:!0,get:function(){return n[r]}})}),e}var Ve={},Pt={},ie={},Wt={},Sr={get exports(){return Wt},set exports(n){Wt=n}};(function(n){(function(t){var e,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,u=Math.ceil,f=Math.floor,c="[BigNumber Error] ",o=c+"Number primitive has more than 15 significant digits: ",s=1e14,l=14,g=9007199254740991,k=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],C=1e7,R=1e9;function B(_){var A,S,I,O=N.prototype={constructor:N,toString:null,valueOf:null},q=new N(1),H=20,F=4,tt=-7,rt=21,at=-1e7,st=1e7,ut=!1,Tt=1,wt=0,Yt={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},bt="0123456789abcdefghijklmnopqrstuvwxyz",Qt=!0;function N(a,i){var h,v,p,y,E,d,w,T,m=this;if(!(m instanceof N))return new N(a,i);if(i==null){if(a&&a._isBigNumber===!0){m.s=a.s,!a.c||a.e>st?m.c=m.e=null:a.e<at?m.c=[m.e=0]:(m.e=a.e,m.c=a.c.slice());return}if((d=typeof a=="number")&&a*0==0){if(m.s=1/a<0?(a=-a,-1):1,a===~~a){for(y=0,E=a;E>=10;E/=10,y++);y>st?m.c=m.e=null:(m.e=y,m.c=[a]);return}T=String(a)}else{if(!r.test(T=String(a)))return I(m,T,d);m.s=T.charCodeAt(0)==45?(T=T.slice(1),-1):1}(y=T.indexOf("."))>-1&&(T=T.replace(".","")),(E=T.search(/e/i))>0?(y<0&&(y=E),y+=+T.slice(E+1),T=T.substring(0,E)):y<0&&(y=T.length)}else{if(j(i,2,bt.length,"Base"),i==10&&Qt)return m=new N(a),ot(m,H+m.e+1,F);if(T=String(a),d=typeof a=="number"){if(a*0!=0)return I(m,T,d,i);if(m.s=1/a<0?(T=T.slice(1),-1):1,N.DEBUG&&T.replace(/^0\.0*|\./,"").length>15)throw Error(o+a)}else m.s=T.charCodeAt(0)===45?(T=T.slice(1),-1):1;for(h=bt.slice(0,i),y=E=0,w=T.length;E<w;E++)if(h.indexOf(v=T.charAt(E))<0){if(v=="."){if(E>y){y=w;continue}}else if(!p&&(T==T.toUpperCase()&&(T=T.toLowerCase())||T==T.toLowerCase()&&(T=T.toUpperCase()))){p=!0,E=-1,y=0;continue}return I(m,String(a),d,i)}d=!1,T=S(T,i,10,m.s),(y=T.indexOf("."))>-1?T=T.replace(".",""):y=T.length}for(E=0;T.charCodeAt(E)===48;E++);for(w=T.length;T.charCodeAt(--w)===48;);if(T=T.slice(E,++w)){if(w-=E,d&&N.DEBUG&&w>15&&(a>g||a!==f(a)))throw Error(o+m.s*a);if((y=y-E-1)>st)m.c=m.e=null;else if(y<at)m.c=[m.e=0];else{if(m.e=y,m.c=[],E=(y+1)%l,y<0&&(E+=l),E<w){for(E&&m.c.push(+T.slice(0,E)),w-=l;E<w;)m.c.push(+T.slice(E,E+=l));E=l-(T=T.slice(E)).length}else E-=w;for(;E--;T+="0");m.c.push(+T)}}else m.c=[m.e=0]}N.clone=B,N.ROUND_UP=0,N.ROUND_DOWN=1,N.ROUND_CEIL=2,N.ROUND_FLOOR=3,N.ROUND_HALF_UP=4,N.ROUND_HALF_DOWN=5,N.ROUND_HALF_EVEN=6,N.ROUND_HALF_CEIL=7,N.ROUND_HALF_FLOOR=8,N.EUCLID=9,N.config=N.set=function(a){var i,h;if(a!=null)if(typeof a=="object"){if(a.hasOwnProperty(i="DECIMAL_PLACES")&&(h=a[i],j(h,0,R,i),H=h),a.hasOwnProperty(i="ROUNDING_MODE")&&(h=a[i],j(h,0,8,i),F=h),a.hasOwnProperty(i="EXPONENTIAL_AT")&&(h=a[i],h&&h.pop?(j(h[0],-R,0,i),j(h[1],0,R,i),tt=h[0],rt=h[1]):(j(h,-R,R,i),tt=-(rt=h<0?-h:h))),a.hasOwnProperty(i="RANGE"))if(h=a[i],h&&h.pop)j(h[0],-R,-1,i),j(h[1],1,R,i),at=h[0],st=h[1];else if(j(h,-R,R,i),h)at=-(st=h<0?-h:h);else throw Error(c+i+" cannot be zero: "+h);if(a.hasOwnProperty(i="CRYPTO"))if(h=a[i],h===!!h)if(h)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))ut=h;else throw ut=!h,Error(c+"crypto unavailable");else ut=h;else throw Error(c+i+" not true or false: "+h);if(a.hasOwnProperty(i="MODULO_MODE")&&(h=a[i],j(h,0,9,i),Tt=h),a.hasOwnProperty(i="POW_PRECISION")&&(h=a[i],j(h,0,R,i),wt=h),a.hasOwnProperty(i="FORMAT"))if(h=a[i],typeof h=="object")Yt=h;else throw Error(c+i+" not an object: "+h);if(a.hasOwnProperty(i="ALPHABET"))if(h=a[i],typeof h=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(h))Qt=h.slice(0,10)=="0123456789",bt=h;else throw Error(c+i+" invalid: "+h)}else throw Error(c+"Object expected: "+a);return{DECIMAL_PLACES:H,ROUNDING_MODE:F,EXPONENTIAL_AT:[tt,rt],RANGE:[at,st],CRYPTO:ut,MODULO_MODE:Tt,POW_PRECISION:wt,FORMAT:Yt,ALPHABET:bt}},N.isBigNumber=function(a){if(!a||a._isBigNumber!==!0)return!1;if(!N.DEBUG)return!0;var i,h,v=a.c,p=a.e,y=a.s;t:if({}.toString.call(v)=="[object Array]"){if((y===1||y===-1)&&p>=-R&&p<=R&&p===f(p)){if(v[0]===0){if(p===0&&v.length===1)return!0;break t}if(i=(p+1)%l,i<1&&(i+=l),String(v[0]).length==i){for(i=0;i<v.length;i++)if(h=v[i],h<0||h>=s||h!==f(h))break t;if(h!==0)return!0}}}else if(v===null&&p===null&&(y===null||y===1||y===-1))return!0;throw Error(c+"Invalid BigNumber: "+a)},N.maximum=N.max=function(){return Re(arguments,O.lt)},N.minimum=N.min=function(){return Re(arguments,O.gt)},N.random=function(){var a=9007199254740992,i=Math.random()*a&2097151?function(){return f(Math.random()*a)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(h){var v,p,y,E,d,w=0,T=[],m=new N(q);if(h==null?h=H:j(h,0,R),E=u(h/l),ut)if(crypto.getRandomValues){for(v=crypto.getRandomValues(new Uint32Array(E*=2));w<E;)d=v[w]*131072+(v[w+1]>>>11),d>=9e15?(p=crypto.getRandomValues(new Uint32Array(2)),v[w]=p[0],v[w+1]=p[1]):(T.push(d%1e14),w+=2);w=E/2}else if(crypto.randomBytes){for(v=crypto.randomBytes(E*=7);w<E;)d=(v[w]&31)*281474976710656+v[w+1]*1099511627776+v[w+2]*4294967296+v[w+3]*16777216+(v[w+4]<<16)+(v[w+5]<<8)+v[w+6],d>=9e15?crypto.randomBytes(7).copy(v,w):(T.push(d%1e14),w+=7);w=E/7}else throw ut=!1,Error(c+"crypto unavailable");if(!ut)for(;w<E;)d=i(),d<9e15&&(T[w++]=d%1e14);for(E=T[--w],h%=l,E&&h&&(d=k[l-h],T[w]=f(E/d)*d);T[w]===0;T.pop(),w--);if(w<0)T=[y=0];else{for(y=-1;T[0]===0;T.splice(0,1),y-=l);for(w=1,d=T[0];d>=10;d/=10,w++);w<l&&(y-=l-w)}return m.e=y,m.c=T,m}}(),N.sum=function(){for(var a=1,i=arguments,h=new N(i[0]);a<i.length;)h=h.plus(i[a++]);return h},S=function(){var a="0123456789";function i(h,v,p,y){for(var E,d=[0],w,T=0,m=h.length;T<m;){for(w=d.length;w--;d[w]*=v);for(d[0]+=y.indexOf(h.charAt(T++)),E=0;E<d.length;E++)d[E]>p-1&&(d[E+1]==null&&(d[E+1]=0),d[E+1]+=d[E]/p|0,d[E]%=p)}return d.reverse()}return function(h,v,p,y,E){var d,w,T,m,U,D,x,W,Y=h.indexOf("."),et=H,z=F;for(Y>=0&&(m=wt,wt=0,h=h.replace(".",""),W=new N(v),D=W.pow(h.length-Y),wt=m,W.c=i(b(L(D.c),D.e,"0"),10,p,a),W.e=W.c.length),x=i(h,v,p,E?(d=bt,a):(d=a,bt)),T=m=x.length;x[--m]==0;x.pop());if(!x[0])return d.charAt(0);if(Y<0?--T:(D.c=x,D.e=T,D.s=y,D=A(D,W,et,z,p),x=D.c,U=D.r,T=D.e),w=T+et+1,Y=x[w],m=p/2,U=U||w<0||x[w+1]!=null,U=z<4?(Y!=null||U)&&(z==0||z==(D.s<0?3:2)):Y>m||Y==m&&(z==4||U||z==6&&x[w-1]&1||z==(D.s<0?8:7)),w<1||!x[0])h=U?b(d.charAt(1),-et,d.charAt(0)):d.charAt(0);else{if(x.length=w,U)for(--p;++x[--w]>p;)x[w]=0,w||(++T,x=[1].concat(x));for(m=x.length;!x[--m];);for(Y=0,h="";Y<=m;h+=d.charAt(x[Y++]));h=b(h,T,d.charAt(0))}return h}}(),A=function(){function a(v,p,y){var E,d,w,T,m=0,U=v.length,D=p%C,x=p/C|0;for(v=v.slice();U--;)w=v[U]%C,T=v[U]/C|0,E=x*w+T*D,d=D*w+E%C*C+m,m=(d/y|0)+(E/C|0)+x*T,v[U]=d%y;return m&&(v=[m].concat(v)),v}function i(v,p,y,E){var d,w;if(y!=E)w=y>E?1:-1;else for(d=w=0;d<y;d++)if(v[d]!=p[d]){w=v[d]>p[d]?1:-1;break}return w}function h(v,p,y,E){for(var d=0;y--;)v[y]-=d,d=v[y]<p[y]?1:0,v[y]=d*E+v[y]-p[y];for(;!v[0]&&v.length>1;v.splice(0,1));}return function(v,p,y,E,d){var w,T,m,U,D,x,W,Y,et,z,X,nt,It,re,ne,ht,Ot,ct=v.s==p.s?1:-1,it=v.c,Q=p.c;if(!it||!it[0]||!Q||!Q[0])return new N(!v.s||!p.s||(it?Q&&it[0]==Q[0]:!Q)?NaN:it&&it[0]==0||!Q?ct*0:ct/0);for(Y=new N(ct),et=Y.c=[],T=v.e-p.e,ct=y+T+1,d||(d=s,T=$(v.e/l)-$(p.e/l),ct=ct/l|0),m=0;Q[m]==(it[m]||0);m++);if(Q[m]>(it[m]||0)&&T--,ct<0)et.push(1),U=!0;else{for(re=it.length,ht=Q.length,m=0,ct+=2,D=f(d/(Q[0]+1)),D>1&&(Q=a(Q,D,d),it=a(it,D,d),ht=Q.length,re=it.length),It=ht,z=it.slice(0,ht),X=z.length;X<ht;z[X++]=0);Ot=Q.slice(),Ot=[0].concat(Ot),ne=Q[0],Q[1]>=d/2&&ne++;do{if(D=0,w=i(Q,z,ht,X),w<0){if(nt=z[0],ht!=X&&(nt=nt*d+(z[1]||0)),D=f(nt/ne),D>1)for(D>=d&&(D=d-1),x=a(Q,D,d),W=x.length,X=z.length;i(x,z,W,X)==1;)D--,h(x,ht<W?Ot:Q,W,d),W=x.length,w=1;else D==0&&(w=D=1),x=Q.slice(),W=x.length;if(W<X&&(x=[0].concat(x)),h(z,x,X,d),X=z.length,w==-1)for(;i(Q,z,ht,X)<1;)D++,h(z,ht<X?Ot:Q,X,d),X=z.length}else w===0&&(D++,z=[0]);et[m++]=D,z[0]?z[X++]=it[It]||0:(z=[it[It]],X=1)}while((It++<re||z[0]!=null)&&ct--);U=z[0]!=null,et[0]||et.splice(0,1)}if(d==s){for(m=1,ct=et[0];ct>=10;ct/=10,m++);ot(Y,y+(Y.e=m+T*l-1)+1,E,U)}else Y.e=T,Y.r=+U;return Y}}();function te(a,i,h,v){var p,y,E,d,w;if(h==null?h=F:j(h,0,8),!a.c)return a.toString();if(p=a.c[0],E=a.e,i==null)w=L(a.c),w=v==1||v==2&&(E<=tt||E>=rt)?Z(w,E):b(w,E,"0");else if(a=ot(new N(a),i,h),y=a.e,w=L(a.c),d=w.length,v==1||v==2&&(i<=y||y<=tt)){for(;d<i;w+="0",d++);w=Z(w,y)}else if(i-=E,w=b(w,y,"0"),y+1>d){if(--i>0)for(w+=".";i--;w+="0");}else if(i+=y-d,i>0)for(y+1==d&&(w+=".");i--;w+="0");return a.s<0&&p?"-"+w:w}function Re(a,i){for(var h,v=1,p=new N(a[0]);v<a.length;v++)if(h=new N(a[v]),h.s)i.call(p,h)&&(p=h);else{p=h;break}return p}function ee(a,i,h){for(var v=1,p=i.length;!i[--p];i.pop());for(p=i[0];p>=10;p/=10,v++);return(h=v+h*l-1)>st?a.c=a.e=null:h<at?a.c=[a.e=0]:(a.e=h,a.c=i),a}I=function(){var a=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,h=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,p=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(y,E,d,w){var T,m=d?E:E.replace(p,"");if(v.test(m))y.s=isNaN(m)?null:m<0?-1:1;else{if(!d&&(m=m.replace(a,function(U,D,x){return T=(x=x.toLowerCase())=="x"?16:x=="b"?2:8,!w||w==T?D:U}),w&&(T=w,m=m.replace(i,"$1").replace(h,"0.$1")),E!=m))return new N(m,T);if(N.DEBUG)throw Error(c+"Not a"+(w?" base "+w:"")+" number: "+E);y.s=null}y.c=y.e=null}}();function ot(a,i,h,v){var p,y,E,d,w,T,m,U=a.c,D=k;if(U){t:{for(p=1,d=U[0];d>=10;d/=10,p++);if(y=i-p,y<0)y+=l,E=i,w=U[T=0],m=w/D[p-E-1]%10|0;else if(T=u((y+1)/l),T>=U.length)if(v){for(;U.length<=T;U.push(0));w=m=0,p=1,y%=l,E=y-l+1}else break t;else{for(w=d=U[T],p=1;d>=10;d/=10,p++);y%=l,E=y-l+p,m=E<0?0:w/D[p-E-1]%10|0}if(v=v||i<0||U[T+1]!=null||(E<0?w:w%D[p-E-1]),v=h<4?(m||v)&&(h==0||h==(a.s<0?3:2)):m>5||m==5&&(h==4||v||h==6&&(y>0?E>0?w/D[p-E]:0:U[T-1])%10&1||h==(a.s<0?8:7)),i<1||!U[0])return U.length=0,v?(i-=a.e+1,U[0]=D[(l-i%l)%l],a.e=-i||0):U[0]=a.e=0,a;if(y==0?(U.length=T,d=1,T--):(U.length=T+1,d=D[l-y],U[T]=E>0?f(w/D[p-E]%D[E])*d:0),v)for(;;)if(T==0){for(y=1,E=U[0];E>=10;E/=10,y++);for(E=U[0]+=d,d=1;E>=10;E/=10,d++);y!=d&&(a.e++,U[0]==s&&(U[0]=1));break}else{if(U[T]+=d,U[T]!=s)break;U[T--]=0,d=1}for(y=U.length;U[--y]===0;U.pop());}a.e>st?a.c=a.e=null:a.e<at&&(a.c=[a.e=0])}return a}function ft(a){var i,h=a.e;return h===null?a.toString():(i=L(a.c),i=h<=tt||h>=rt?Z(i,h):b(i,h,"0"),a.s<0?"-"+i:i)}return O.absoluteValue=O.abs=function(){var a=new N(this);return a.s<0&&(a.s=1),a},O.comparedTo=function(a,i){return K(this,new N(a,i))},O.decimalPlaces=O.dp=function(a,i){var h,v,p,y=this;if(a!=null)return j(a,0,R),i==null?i=F:j(i,0,8),ot(new N(y),a+y.e+1,i);if(!(h=y.c))return null;if(v=((p=h.length-1)-$(this.e/l))*l,p=h[p])for(;p%10==0;p/=10,v--);return v<0&&(v=0),v},O.dividedBy=O.div=function(a,i){return A(this,new N(a,i),H,F)},O.dividedToIntegerBy=O.idiv=function(a,i){return A(this,new N(a,i),0,1)},O.exponentiatedBy=O.pow=function(a,i){var h,v,p,y,E,d,w,T,m,U=this;if(a=new N(a),a.c&&!a.isInteger())throw Error(c+"Exponent not an integer: "+ft(a));if(i!=null&&(i=new N(i)),d=a.e>14,!U.c||!U.c[0]||U.c[0]==1&&!U.e&&U.c.length==1||!a.c||!a.c[0])return m=new N(Math.pow(+ft(U),d?a.s*(2-M(a)):+ft(a))),i?m.mod(i):m;if(w=a.s<0,i){if(i.c?!i.c[0]:!i.s)return new N(NaN);v=!w&&U.isInteger()&&i.isInteger(),v&&(U=U.mod(i))}else{if(a.e>9&&(U.e>0||U.e<-1||(U.e==0?U.c[0]>1||d&&U.c[1]>=24e7:U.c[0]<8e13||d&&U.c[0]<=9999975e7)))return y=U.s<0&&M(a)?-0:0,U.e>-1&&(y=1/y),new N(w?1/y:y);wt&&(y=u(wt/l+2))}for(d?(h=new N(.5),w&&(a.s=1),T=M(a)):(p=Math.abs(+ft(a)),T=p%2),m=new N(q);;){if(T){if(m=m.times(U),!m.c)break;y?m.c.length>y&&(m.c.length=y):v&&(m=m.mod(i))}if(p){if(p=f(p/2),p===0)break;T=p%2}else if(a=a.times(h),ot(a,a.e+1,1),a.e>14)T=M(a);else{if(p=+ft(a),p===0)break;T=p%2}U=U.times(U),y?U.c&&U.c.length>y&&(U.c.length=y):v&&(U=U.mod(i))}return v?m:(w&&(m=q.div(m)),i?m.mod(i):y?ot(m,wt,F,E):m)},O.integerValue=function(a){var i=new N(this);return a==null?a=F:j(a,0,8),ot(i,i.e+1,a)},O.isEqualTo=O.eq=function(a,i){return K(this,new N(a,i))===0},O.isFinite=function(){return!!this.c},O.isGreaterThan=O.gt=function(a,i){return K(this,new N(a,i))>0},O.isGreaterThanOrEqualTo=O.gte=function(a,i){return(i=K(this,new N(a,i)))===1||i===0},O.isInteger=function(){return!!this.c&&$(this.e/l)>this.c.length-2},O.isLessThan=O.lt=function(a,i){return K(this,new N(a,i))<0},O.isLessThanOrEqualTo=O.lte=function(a,i){return(i=K(this,new N(a,i)))===-1||i===0},O.isNaN=function(){return!this.s},O.isNegative=function(){return this.s<0},O.isPositive=function(){return this.s>0},O.isZero=function(){return!!this.c&&this.c[0]==0},O.minus=function(a,i){var h,v,p,y,E=this,d=E.s;if(a=new N(a,i),i=a.s,!d||!i)return new N(NaN);if(d!=i)return a.s=-i,E.plus(a);var w=E.e/l,T=a.e/l,m=E.c,U=a.c;if(!w||!T){if(!m||!U)return m?(a.s=-i,a):new N(U?E:NaN);if(!m[0]||!U[0])return U[0]?(a.s=-i,a):new N(m[0]?E:F==3?-0:0)}if(w=$(w),T=$(T),m=m.slice(),d=w-T){for((y=d<0)?(d=-d,p=m):(T=w,p=U),p.reverse(),i=d;i--;p.push(0));p.reverse()}else for(v=(y=(d=m.length)<(i=U.length))?d:i,d=i=0;i<v;i++)if(m[i]!=U[i]){y=m[i]<U[i];break}if(y&&(p=m,m=U,U=p,a.s=-a.s),i=(v=U.length)-(h=m.length),i>0)for(;i--;m[h++]=0);for(i=s-1;v>d;){if(m[--v]<U[v]){for(h=v;h&&!m[--h];m[h]=i);--m[h],m[v]+=s}m[v]-=U[v]}for(;m[0]==0;m.splice(0,1),--T);return m[0]?ee(a,m,T):(a.s=F==3?-1:1,a.c=[a.e=0],a)},O.modulo=O.mod=function(a,i){var h,v,p=this;return a=new N(a,i),!p.c||!a.s||a.c&&!a.c[0]?new N(NaN):!a.c||p.c&&!p.c[0]?new N(p):(Tt==9?(v=a.s,a.s=1,h=A(p,a,0,3),a.s=v,h.s*=v):h=A(p,a,0,Tt),a=p.minus(h.times(a)),!a.c[0]&&Tt==1&&(a.s=p.s),a)},O.multipliedBy=O.times=function(a,i){var h,v,p,y,E,d,w,T,m,U,D,x,W,Y,et,z=this,X=z.c,nt=(a=new N(a,i)).c;if(!X||!nt||!X[0]||!nt[0])return!z.s||!a.s||X&&!X[0]&&!nt||nt&&!nt[0]&&!X?a.c=a.e=a.s=null:(a.s*=z.s,!X||!nt?a.c=a.e=null:(a.c=[0],a.e=0)),a;for(v=$(z.e/l)+$(a.e/l),a.s*=z.s,w=X.length,U=nt.length,w<U&&(W=X,X=nt,nt=W,p=w,w=U,U=p),p=w+U,W=[];p--;W.push(0));for(Y=s,et=C,p=U;--p>=0;){for(h=0,D=nt[p]%et,x=nt[p]/et|0,E=w,y=p+E;y>p;)T=X[--E]%et,m=X[E]/et|0,d=x*T+m*D,T=D*T+d%et*et+W[y]+h,h=(T/Y|0)+(d/et|0)+x*m,W[y--]=T%Y;W[y]=h}return h?++v:W.splice(0,1),ee(a,W,v)},O.negated=function(){var a=new N(this);return a.s=-a.s||null,a},O.plus=function(a,i){var h,v=this,p=v.s;if(a=new N(a,i),i=a.s,!p||!i)return new N(NaN);if(p!=i)return a.s=-i,v.minus(a);var y=v.e/l,E=a.e/l,d=v.c,w=a.c;if(!y||!E){if(!d||!w)return new N(p/0);if(!d[0]||!w[0])return w[0]?a:new N(d[0]?v:p*0)}if(y=$(y),E=$(E),d=d.slice(),p=y-E){for(p>0?(E=y,h=w):(p=-p,h=d),h.reverse();p--;h.push(0));h.reverse()}for(p=d.length,i=w.length,p-i<0&&(h=w,w=d,d=h,i=p),p=0;i;)p=(d[--i]=d[i]+w[i]+p)/s|0,d[i]=s===d[i]?0:d[i]%s;return p&&(d=[p].concat(d),++E),ee(a,d,E)},O.precision=O.sd=function(a,i){var h,v,p,y=this;if(a!=null&&a!==!!a)return j(a,1,R),i==null?i=F:j(i,0,8),ot(new N(y),a,i);if(!(h=y.c))return null;if(p=h.length-1,v=p*l+1,p=h[p]){for(;p%10==0;p/=10,v--);for(p=h[0];p>=10;p/=10,v++);}return a&&y.e+1>v&&(v=y.e+1),v},O.shiftedBy=function(a){return j(a,-g,g),this.times("1e"+a)},O.squareRoot=O.sqrt=function(){var a,i,h,v,p,y=this,E=y.c,d=y.s,w=y.e,T=H+4,m=new N("0.5");if(d!==1||!E||!E[0])return new N(!d||d<0&&(!E||E[0])?NaN:E?y:1/0);if(d=Math.sqrt(+ft(y)),d==0||d==1/0?(i=L(E),(i.length+w)%2==0&&(i+="0"),d=Math.sqrt(+i),w=$((w+1)/2)-(w<0||w%2),d==1/0?i="5e"+w:(i=d.toExponential(),i=i.slice(0,i.indexOf("e")+1)+w),h=new N(i)):h=new N(d+""),h.c[0]){for(w=h.e,d=w+T,d<3&&(d=0);;)if(p=h,h=m.times(p.plus(A(y,p,T,1))),L(p.c).slice(0,d)===(i=L(h.c)).slice(0,d))if(h.e<w&&--d,i=i.slice(d-3,d+1),i=="9999"||!v&&i=="4999"){if(!v&&(ot(p,p.e+H+2,0),p.times(p).eq(y))){h=p;break}T+=4,d+=4,v=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(ot(h,h.e+H+2,1),a=!h.times(h).eq(y));break}}return ot(h,h.e+H+1,F,a)},O.toExponential=function(a,i){return a!=null&&(j(a,0,R),a++),te(this,a,i,1)},O.toFixed=function(a,i){return a!=null&&(j(a,0,R),a=a+this.e+1),te(this,a,i)},O.toFormat=function(a,i,h){var v,p=this;if(h==null)a!=null&&i&&typeof i=="object"?(h=i,i=null):a&&typeof a=="object"?(h=a,a=i=null):h=Yt;else if(typeof h!="object")throw Error(c+"Argument not an object: "+h);if(v=p.toFixed(a,i),p.c){var y,E=v.split("."),d=+h.groupSize,w=+h.secondaryGroupSize,T=h.groupSeparator||"",m=E[0],U=E[1],D=p.s<0,x=D?m.slice(1):m,W=x.length;if(w&&(y=d,d=w,w=y,W-=y),d>0&&W>0){for(y=W%d||d,m=x.substr(0,y);y<W;y+=d)m+=T+x.substr(y,d);w>0&&(m+=T+x.slice(y)),D&&(m="-"+m)}v=U?m+(h.decimalSeparator||"")+((w=+h.fractionGroupSize)?U.replace(new RegExp("\\d{"+w+"}\\B","g"),"$&"+(h.fractionGroupSeparator||"")):U):m}return(h.prefix||"")+v+(h.suffix||"")},O.toFraction=function(a){var i,h,v,p,y,E,d,w,T,m,U,D,x=this,W=x.c;if(a!=null&&(d=new N(a),!d.isInteger()&&(d.c||d.s!==1)||d.lt(q)))throw Error(c+"Argument "+(d.isInteger()?"out of range: ":"not an integer: ")+ft(d));if(!W)return new N(x);for(i=new N(q),T=h=new N(q),v=w=new N(q),D=L(W),y=i.e=D.length-x.e-1,i.c[0]=k[(E=y%l)<0?l+E:E],a=!a||d.comparedTo(i)>0?y>0?i:T:d,E=st,st=1/0,d=new N(D),w.c[0]=0;m=A(d,i,0,1),p=h.plus(m.times(v)),p.comparedTo(a)!=1;)h=v,v=p,T=w.plus(m.times(p=T)),w=p,i=d.minus(m.times(p=i)),d=p;return p=A(a.minus(h),v,0,1),w=w.plus(p.times(T)),h=h.plus(p.times(v)),w.s=T.s=x.s,y=y*2,U=A(T,v,y,F).minus(x).abs().comparedTo(A(w,h,y,F).minus(x).abs())<1?[T,v]:[w,h],st=E,U},O.toNumber=function(){return+ft(this)},O.toPrecision=function(a,i){return a!=null&&j(a,1,R),te(this,a,i,2)},O.toString=function(a){var i,h=this,v=h.s,p=h.e;return p===null?v?(i="Infinity",v<0&&(i="-"+i)):i="NaN":(a==null?i=p<=tt||p>=rt?Z(L(h.c),p):b(L(h.c),p,"0"):a===10&&Qt?(h=ot(new N(h),H+p+1,F),i=b(L(h.c),h.e,"0")):(j(a,2,bt.length,"Base"),i=S(b(L(h.c),p,"0"),10,a,v,!0)),v<0&&h.c[0]&&(i="-"+i)),i},O.valueOf=O.toJSON=function(){return ft(this)},O._isBigNumber=!0,_!=null&&N.set(_),N}function $(_){var A=_|0;return _>0||_===A?A:A-1}function L(_){for(var A,S,I=1,O=_.length,q=_[0]+"";I<O;){for(A=_[I++]+"",S=l-A.length;S--;A="0"+A);q+=A}for(O=q.length;q.charCodeAt(--O)===48;);return q.slice(0,O+1||1)}function K(_,A){var S,I,O=_.c,q=A.c,H=_.s,F=A.s,tt=_.e,rt=A.e;if(!H||!F)return null;if(S=O&&!O[0],I=q&&!q[0],S||I)return S?I?0:-F:H;if(H!=F)return H;if(S=H<0,I=tt==rt,!O||!q)return I?0:!O^S?1:-1;if(!I)return tt>rt^S?1:-1;for(F=(tt=O.length)<(rt=q.length)?tt:rt,H=0;H<F;H++)if(O[H]!=q[H])return O[H]>q[H]^S?1:-1;return tt==rt?0:tt>rt^S?1:-1}function j(_,A,S,I){if(_<A||_>S||_!==f(_))throw Error(c+(I||"Argument")+(typeof _=="number"?_<A||_>S?" out of range: ":" not an integer: ":" not a primitive number: ")+String(_))}function M(_){var A=_.c.length-1;return $(_.e/l)==A&&_.c[A]%2!=0}function Z(_,A){return(_.length>1?_.charAt(0)+"."+_.slice(1):_)+(A<0?"e":"e+")+A}function b(_,A,S){var I,O;if(A<0){for(O=S+".";++A;O+=S);_=O+_}else if(I=_.length,++A>I){for(O=S,A-=I;--A;O+=S);_+=O}else A<I&&(_=_.slice(0,A)+"."+_.slice(A));return _}e=B(),e.default=e.BigNumber=e,n.exports?n.exports=e:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=e)})(V)})(Sr);Object.defineProperty(ie,"__esModule",{value:!0});const Or=Wt;let Ur=class{constructor(){this.BigNum=(t,e)=>{let r=Or.BigNumber.clone({DECIMAL_PLACES:e});return new r(t)}}winstonToAr(t,{formatted:e=!1,decimals:r=12,trim:u=!0}={}){let f=this.stringToBigNum(t,r).shiftedBy(-12);return e?f.toFormat(r):f.toFixed(r)}arToWinston(t,{formatted:e=!1}={}){let r=this.stringToBigNum(t).shiftedBy(12);return e?r.toFormat():r.toFixed(0)}compare(t,e){let r=this.stringToBigNum(t),u=this.stringToBigNum(e);return r.comparedTo(u)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let r=this.stringToBigNum(t),u=this.stringToBigNum(e);return r.isLessThan(u)}isGreaterThan(t,e){let r=this.stringToBigNum(t),u=this.stringToBigNum(e);return r.isGreaterThan(u)}add(t,e){let r=this.stringToBigNum(t);return this.stringToBigNum(e),r.plus(e).toFixed(0)}sub(t,e){let r=this.stringToBigNum(t);return this.stringToBigNum(e),r.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}};ie.default=Ur;var oe={};Object.defineProperty(oe,"__esModule",{value:!0});let Rr=class{constructor(t){this.METHOD_GET="GET",this.METHOD_POST="POST",this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){const e=t.protocol||"http",r=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:r,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,Object.assign(Object.assign({},e),{method:this.METHOD_GET}))}async post(t,e,r){var u;const f=new Headers((r==null?void 0:r.headers)||{});return!((u=f.get("content-type"))===null||u===void 0)&&u.includes("application/json")||f.append("content-type","application/json"),f.append("accept","application/json, text/plain, */*"),await this.request(t,Object.assign(Object.assign({},r),{method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:f}))}async request(t,e){const r=new Headers((e==null?void 0:e.headers)||{}),u=`${this.config.protocol}://${this.config.host}:${this.config.port}`;t.startsWith("/")&&(t=t.slice(1)),this.config.network&&r.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${u}/${t}`);let f=await fetch(`${u}/${t}`,Object.assign(Object.assign({},e||{}),{headers:r}));this.config.logging&&this.config.logger(`Response:   ${f.url} - ${f.status}`);const c=f.headers.get("content-type"),o=f;if(c!=null&&c.startsWith("application/json"))o.data=await f.clone().json();else try{o.data=await f.clone().text()}catch{o.data=await f.clone().arrayBuffer()}return o}};oe.default=Rr;var ce={},G={};Object.defineProperty(G,"__esModule",{value:!0});G.b64UrlDecode=G.b64UrlEncode=G.bufferTob64Url=G.bufferTob64=G.b64UrlToBuffer=G.stringToB64Url=G.stringToBuffer=G.bufferToString=G.b64UrlToString=G.concatBuffers=void 0;const Ze=Xe;function Nr(n){let t=0;for(let u=0;u<n.length;u++)t+=n[u].byteLength;let e=new Uint8Array(t),r=0;e.set(new Uint8Array(n[0]),r),r+=n[0].byteLength;for(let u=1;u<n.length;u++)e.set(new Uint8Array(n[u]),r),r+=n[u].byteLength;return e}G.concatBuffers=Nr;function $r(n){let t=tr(n);return Ye(t)}G.b64UrlToString=$r;function Ye(n){return new TextDecoder("utf-8",{fatal:!0}).decode(n)}G.bufferToString=Ye;function Qe(n){return new TextEncoder().encode(n)}G.stringToBuffer=Qe;function Br(n){return rr(Qe(n))}G.stringToB64Url=Br;function tr(n){return new Uint8Array(Ze.toByteArray(ar(n)))}G.b64UrlToBuffer=tr;function er(n){return Ze.fromByteArray(new Uint8Array(n))}G.bufferTob64=er;function rr(n){return nr(er(n))}G.bufferTob64Url=rr;function nr(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}G.b64UrlEncode=nr;function ar(n){n=n.replace(/\-/g,"+").replace(/\_/g,"/");let t;return n.length%4==0?t=0:t=4-n.length%4,n.concat("=".repeat(t))}G.b64UrlDecode=ar;Object.defineProperty(ce,"__esModule",{value:!0});const yt=G;let Cr=class{constructor(){if(this.keyLength=4096,this.publicExponent=65537,this.hashAlgorithm="sha256",!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let u=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(u)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){const u={kty:"RSA",e:"AQAB",n:t},f=await this.jwkToPublicCryptoKey(u),c=await this.driver.digest("SHA-256",e),o=await this.driver.verify({name:"RSA-PSS",saltLength:0},f,r,e),s=await this.driver.verify({name:"RSA-PSS",saltLength:32},f,r,e),l=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((f.algorithm.modulusLength-1)/8)-c.byteLength-2},f,r,e);return o||s||l}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;const t=crypto==null?void 0:crypto.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(r=>typeof t[r]=="function")}async encrypt(t,e,r){const u=await this.driver.importKey("raw",typeof e=="string"?yt.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),f=await this.driver.deriveKey({name:"PBKDF2",salt:r?yt.stringToBuffer(r):yt.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},u,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),c=new Uint8Array(16);crypto.getRandomValues(c);const o=await this.driver.encrypt({name:"AES-CBC",iv:c},f,t);return yt.concatBuffers([c,o])}async decrypt(t,e,r){const u=await this.driver.importKey("raw",typeof e=="string"?yt.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),f=await this.driver.deriveKey({name:"PBKDF2",salt:r?yt.stringToBuffer(r):yt.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},u,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),c=t.slice(0,16),o=await this.driver.decrypt({name:"AES-CBC",iv:c},f,t.slice(16));return yt.concatBuffers([o])}};ce.default=Cr;var ue={};Object.defineProperty(ue,"__esModule",{value:!0});let Ir=class{constructor(t){this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}};ue.default=Ir;var Dt={},_t={};Object.defineProperty(_t,"__esModule",{value:!0});_t.getError=void 0;let Pr=class extends Error{constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.response=e.response}getType(){return this.type}};_t.default=Pr;function Dr(n){let t=n.data;if(typeof n.data=="string")try{t=JSON.parse(n.data)}catch{}if(n.data instanceof ArrayBuffer||n.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:n.statusText||"unknown"}_t.getError=Dr;var kt={},xt={},Ne;function xr(){if(Ne)return xt;Ne=1,Object.defineProperty(xt,"__esModule",{value:!0});const n=Gt();async function t(r){if(Array.isArray(r)){const c=n.default.utils.concatBuffers([n.default.utils.stringToBuffer("list"),n.default.utils.stringToBuffer(r.length.toString())]);return await e(r,await n.default.crypto.hash(c,"SHA-384"))}const u=n.default.utils.concatBuffers([n.default.utils.stringToBuffer("blob"),n.default.utils.stringToBuffer(r.byteLength.toString())]),f=n.default.utils.concatBuffers([await n.default.crypto.hash(u,"SHA-384"),await n.default.crypto.hash(r,"SHA-384")]);return await n.default.crypto.hash(f,"SHA-384")}xt.default=t;async function e(r,u){if(r.length<1)return u;const f=n.default.utils.concatBuffers([u,await t(r[0])]),c=await n.default.crypto.hash(f,"SHA-384");return await e(r.slice(1),c)}return xt}var ae={},$e;function sr(){return $e||($e=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.debug=n.validatePath=n.arrayCompare=n.bufferToInt=n.intToBuffer=n.arrayFlatten=n.generateProofs=n.buildLayers=n.generateTransactionChunks=n.generateTree=n.computeRootHash=n.generateLeaves=n.chunkData=n.MIN_CHUNK_SIZE=n.MAX_CHUNK_SIZE=void 0;const t=Gt(),e=G;n.MAX_CHUNK_SIZE=256*1024,n.MIN_CHUNK_SIZE=32*1024;const r=32,u=32;async function f(b){let _=[],A=b,S=0;for(;A.byteLength>=n.MAX_CHUNK_SIZE;){let I=n.MAX_CHUNK_SIZE,O=A.byteLength-n.MAX_CHUNK_SIZE;O>0&&O<n.MIN_CHUNK_SIZE&&(I=Math.ceil(A.byteLength/2));const q=A.slice(0,I),H=await t.default.crypto.hash(q);S+=q.byteLength,_.push({dataHash:H,minByteRange:S-q.byteLength,maxByteRange:S}),A=A.slice(I)}return _.push({dataHash:await t.default.crypto.hash(A),minByteRange:S,maxByteRange:S+A.byteLength}),_}n.chunkData=f;async function c(b){return Promise.all(b.map(async({dataHash:_,minByteRange:A,maxByteRange:S})=>({type:"leaf",id:await $(await Promise.all([$(_),$(L(S))])),dataHash:_,minByteRange:A,maxByteRange:S})))}n.generateLeaves=c;async function o(b){return(await s(b)).id}n.computeRootHash=o;async function s(b){return await g(await c(await f(b)))}n.generateTree=s;async function l(b){const _=await f(b),A=await c(_),S=await g(A),I=await k(S),O=_.slice(-1)[0];return O.maxByteRange-O.minByteRange===0&&(_.splice(_.length-1,1),I.splice(I.length-1,1)),{data_root:S.id,chunks:_,proofs:I}}n.generateTransactionChunks=l;async function g(b,_=0){if(b.length<2)return b[0];const A=[];for(let S=0;S<b.length;S+=2)A.push(await B(b[S],b[S+1]));return g(A,_+1)}n.buildLayers=g;function k(b){const _=C(b);return Array.isArray(_)?R(_):[_]}n.generateProofs=k;function C(b,_=new Uint8Array,A=0){if(b.type=="leaf")return{offset:b.maxByteRange-1,proof:(0,e.concatBuffers)([_,b.dataHash,L(b.maxByteRange)])};if(b.type=="branch"){const S=(0,e.concatBuffers)([_,b.leftChild.id,b.rightChild.id,L(b.byteRange)]);return[C(b.leftChild,S,A+1),C(b.rightChild,S,A+1)]}throw new Error("Unexpected node type")}function R(b){const _=[];return b.forEach(A=>{Array.isArray(A)?_.push(...R(A)):_.push(A)}),_}n.arrayFlatten=R;async function B(b,_){return _?{type:"branch",id:await $([await $(b.id),await $(_.id),await $(L(b.maxByteRange))]),byteRange:b.maxByteRange,maxByteRange:_.maxByteRange,leftChild:b,rightChild:_}:b}async function $(b){return Array.isArray(b)&&(b=t.default.utils.concatBuffers(b)),new Uint8Array(await t.default.crypto.hash(b))}function L(b){const _=new Uint8Array(r);for(var A=_.length-1;A>=0;A--){var S=b%256;_[A]=S,b=(b-S)/256}return _}n.intToBuffer=L;function K(b){let _=0;for(var A=0;A<b.length;A++)_*=256,_+=b[A];return _}n.bufferToInt=K;const j=(b,_)=>b.every((A,S)=>_[S]===A);n.arrayCompare=j;async function M(b,_,A,S,I){if(S<=0)return!1;if(_>=S)return M(b,0,S-1,S,I);if(_<0)return M(b,0,0,S,I);if(I.length==u+r){const at=I.slice(0,u),st=I.slice(at.length,at.length+r),ut=await $([await $(at),await $(st)]);return(0,n.arrayCompare)(b,ut)?{offset:S-1,leftBound:A,rightBound:S,chunkSize:S-A}:!1}const O=I.slice(0,u),q=I.slice(O.length,O.length+u),H=I.slice(O.length+q.length,O.length+q.length+r),F=K(H),tt=I.slice(O.length+q.length+H.length),rt=await $([await $(O),await $(q),await $(H)]);return(0,n.arrayCompare)(b,rt)?_<F?await M(O,_,A,Math.min(S,F),tt):await M(q,_,Math.max(A,F),S,tt):!1}n.validatePath=M;async function Z(b,_=""){if(b.byteLength<1)return _;const A=b.slice(0,u),S=b.slice(A.length,A.length+u),I=b.slice(A.length+S.length,A.length+S.length+r),O=K(I),q=b.slice(A.length+S.length+I.length),H=await $([await $(A),await $(S),await $(I)]),F=`${_}
${JSON.stringify(zt.Buffer.from(A))},${JSON.stringify(zt.Buffer.from(S))},${O} => ${JSON.stringify(H)}`;return Z(q,F)}n.debug=Z}(ae)),ae}var Be;function le(){if(Be)return kt;Be=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Tag=void 0;const n=G,t=xr(),e=sr();class r{get(o,s){if(!Object.getOwnPropertyNames(this).includes(o))throw new Error(`Field "${o}" is not a property of the Arweave Transaction class.`);return this[o]instanceof Uint8Array?s&&s.decode&&s.string?n.bufferToString(this[o]):s&&s.decode&&!s.string?this[o]:n.bufferTob64Url(this[o]):s&&s.decode==!0?s&&s.string?n.b64UrlToString(this[o]):n.b64UrlToBuffer(this[o]):this[o]}}class u extends r{constructor(o,s,l=!1){super(),this.name=o,this.value=s}}kt.Tag=u;class f extends r{constructor(o={}){super(),this.format=2,this.id="",this.last_tx="",this.owner="",this.tags=[],this.target="",this.quantity="0",this.data_size="0",this.data=new Uint8Array,this.data_root="",this.reward="0",this.signature="",Object.assign(this,o),typeof this.data=="string"&&(this.data=n.b64UrlToBuffer(this.data)),o.tags&&(this.tags=o.tags.map(s=>new u(s.name,s.value)))}addTag(o,s){this.tags.push(new u(n.stringToB64Url(o),n.stringToB64Url(s)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:n.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(o){this.owner=o}setSignature({id:o,owner:s,reward:l,tags:g,signature:k}){this.id=o,this.owner=s,l&&(this.reward=l),g&&(this.tags=g),this.signature=k}async prepareChunks(o){!this.chunks&&o.byteLength>0&&(this.chunks=await(0,e.generateTransactionChunks)(o),this.data_root=n.bufferTob64Url(this.chunks.data_root)),!this.chunks&&o.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(o,s){if(!this.chunks)throw new Error("Chunks have not been prepared");const l=this.chunks.proofs[o],g=this.chunks.chunks[o];return{data_root:this.data_root,data_size:this.data_size,data_path:n.bufferTob64Url(l.proof),offset:l.offset.toString(),chunk:n.bufferTob64Url(s.slice(g.minByteRange,g.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let o=this.tags.reduce((l,g)=>n.concatBuffers([l,g.get("name",{decode:!0,string:!1}),g.get("value",{decode:!0,string:!1})]),new Uint8Array);return n.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),n.stringToBuffer(this.quantity),n.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),o]);case 2:this.data_root||await this.prepareChunks(this.data);const s=this.tags.map(l=>[l.get("name",{decode:!0,string:!1}),l.get("value",{decode:!0,string:!1})]);return await(0,t.default)([n.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),n.stringToBuffer(this.quantity),n.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),s,n.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}}return kt.default=f,kt}var Ut={},Ce;function Lr(){if(Ce)return Ut;Ce=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.TransactionUploader=void 0;const n=le(),t=G,e=_t,r=sr(),u=1,f=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],c=1e3*40;class o{get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(l,g){if(this.api=l,this.chunkIndex=0,this.txPosted=!1,this.lastRequestTimeEnd=0,this.totalErrors=0,this.lastResponseStatus=0,this.lastResponseError="",!g.id)throw new Error("Transaction is not signed");if(!g.chunks)throw new Error("Transaction chunks not prepared");this.data=g.data,this.transaction=new n.default(Object.assign({},g,{data:new Uint8Array(0)}))}async uploadChunk(l){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let g=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+c-Date.now(),c);if(g>0&&(g=g-g*Math.random()*.3,await new Promise(B=>setTimeout(B,g))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}l&&(this.chunkIndex=l);const k=this.transaction.getChunk(l||this.chunkIndex,this.data);if(!await(0,r.validatePath)(this.transaction.chunks.data_root,parseInt(k.offset),0,parseInt(k.data_size),t.b64UrlToBuffer(k.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);const R=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(B=>(console.error(B.message),{status:-1,data:{error:B.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=R.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,e.getError)(R),f.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(l,g,k){if(!g||typeof g.chunkIndex!="number"||typeof g.transaction!="object")throw new Error("Serialized object does not match expected format.");var C=new n.default(g.transaction);C.chunks||await C.prepareChunks(k);const R=new o(l,C);if(R.chunkIndex=g.chunkIndex,R.lastRequestTimeEnd=g.lastRequestTimeEnd,R.lastResponseError=g.lastResponseError,R.lastResponseStatus=g.lastResponseStatus,R.txPosted=g.txPosted,R.data=k,R.transaction.data_root!==g.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return R}static async fromTransactionId(l,g){const k=await l.get(`tx/${g}`);if(k.status!==200)throw new Error(`Tx ${g} not found: ${k.status}`);const C=k.data;return C.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:C}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=u){this.transaction.data=this.data;const k=await this.api.post("tx",this.transaction).catch(C=>(console.error(C),{status:-1,data:{error:C.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=k.status,this.transaction.data=new Uint8Array(0),k.status>=200&&k.status<300){this.txPosted=!0,this.chunkIndex=u;return}throw this.lastResponseError=(0,e.getError)(k),new Error(`Unable to upload transaction: ${k.status}, ${this.lastResponseError}`)}const g=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=g.status,!(g.status>=200&&g.status<300))throw this.lastResponseError=(0,e.getError)(g),new Error(`Unable to upload transaction: ${g.status}, ${this.lastResponseError}`);this.txPosted=!0}}return Ut.TransactionUploader=o,Ut}var Ie;function Mr(){if(Ie)return Dt;Ie=1;var n=V&&V.__await||function(o){return this instanceof n?(this.v=o,this):new n(o)},t=V&&V.__asyncGenerator||function(o,s,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=l.apply(o,s||[]),k,C=[];return k={},R("next"),R("throw"),R("return"),k[Symbol.asyncIterator]=function(){return this},k;function R(M){g[M]&&(k[M]=function(Z){return new Promise(function(b,_){C.push([M,Z,b,_])>1||B(M,Z)})})}function B(M,Z){try{$(g[M](Z))}catch(b){j(C[0][3],b)}}function $(M){M.value instanceof n?Promise.resolve(M.value.v).then(L,K):j(C[0][2],M)}function L(M){B("next",M)}function K(M){B("throw",M)}function j(M,Z){M(Z),C.shift(),C.length&&B(C[0][0],C[0][1])}};Object.defineProperty(Dt,"__esModule",{value:!0});const e=_t,r=le(),u=G,f=Lr();class c{constructor(s,l,g){this.api=s,this.crypto=l,this.chunks=g}getTransactionAnchor(){return this.api.get("tx_anchor").then(s=>s.data)}getPrice(s,l){let g=l?`price/${s}/${l}`:`price/${s}`;return this.api.get(g).then(k=>k.data)}async get(s){const l=await this.api.get(`tx/${s}`);if(l.status==200){const g=parseInt(l.data.data_size);if(l.data.format>=2&&g>0&&g<=1024*1024*12){const k=await this.getData(s);return new r.default(Object.assign(Object.assign({},l.data),{data:k}))}return new r.default(Object.assign(Object.assign({},l.data),{format:l.data.format||1}))}throw l.status==404?new e.default("TX_NOT_FOUND"):l.status==410?new e.default("TX_FAILED"):new e.default("TX_INVALID")}fromRaw(s){return new r.default(s)}async search(s,l){return this.api.post("arql",{op:"equals",expr1:s,expr2:l}).then(g=>g.data?g.data:[])}getStatus(s){return this.api.get(`tx/${s}/status`).then(l=>l.status==200?{status:200,confirmed:l.data}:{status:l.status,confirmed:null})}async getData(s,l){let g;try{g=await this.chunks.downloadChunkedData(s)}catch(k){console.error(`Error while trying to download chunked data for ${s}`),console.error(k)}if(!g){console.warn(`Falling back to gateway cache for ${s}`);try{g=(await this.api.get(`/${s}`)).data}catch(k){console.error(`Error while trying to download contiguous data from gateway cache for ${s}`),console.error(k)}}if(!g)throw new Error(`${s} was not found!`);return l&&l.decode&&!l.string?g:l&&l.decode&&l.string?u.bufferToString(g):u.bufferTob64Url(g)}async sign(s,l,g){if(!l&&typeof arweaveWallet!="object")throw new Error("A new Arweave transaction must provide the jwk parameter.");if(!l||l==="use_wallet"){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}const k=await arweaveWallet.sign(s,g);s.setSignature({id:k.id,owner:k.owner,reward:k.reward,tags:k.tags,signature:k.signature})}else{s.setOwner(l.n);let k=await s.getSignatureData(),C=await this.crypto.sign(l,k,g),R=await this.crypto.hash(C);s.setSignature({id:u.bufferTob64Url(R),owner:l.n,signature:u.bufferTob64Url(C)})}}async verify(s){const l=await s.getSignatureData(),g=s.get("signature",{decode:!0,string:!1}),k=u.bufferTob64Url(await this.crypto.hash(g));if(s.id!==k)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(s.owner,l,g)}async post(s){if(typeof s=="string"?s=new r.default(JSON.parse(s)):typeof s.readInt32BE=="function"?s=new r.default(JSON.parse(s.toString())):typeof s=="object"&&!(s instanceof r.default)&&(s=new r.default(s)),!(s instanceof r.default))throw new Error("Must be Transaction object");s.chunks||await s.prepareChunks(s.data);const l=await this.getUploader(s,s.data);try{for(;!l.isComplete;)await l.uploadChunk()}catch(g){if(l.lastResponseStatus>0)return{status:l.lastResponseStatus,statusText:l.lastResponseError,data:{error:l.lastResponseError}};throw g}return{status:200,statusText:"OK",data:{}}}async getUploader(s,l){let g;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),s instanceof r.default){if(l||(l=s.data),!(l instanceof Uint8Array))throw new Error("Data format is invalid");s.chunks||await s.prepareChunks(l),g=new f.TransactionUploader(this.api,s),(!g.data||g.data.length===0)&&(g.data=l)}else{if(typeof s=="string"&&(s=await f.TransactionUploader.fromTransactionId(this.api,s)),!l||!(l instanceof Uint8Array))throw new Error("Must provide data when resuming upload");g=await f.TransactionUploader.fromSerialized(this.api,s,l)}return g}upload(s,l){return t(this,arguments,function*(){const k=yield n(this.getUploader(s,l));for(;!k.isComplete;)yield n(k.uploadChunk()),yield yield n(k);return yield n(k)})}}return Dt.default=c,Dt}var he={};Object.defineProperty(he,"__esModule",{value:!0});const Pe=G;let qr=class{constructor(t,e){this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Pe.bufferTob64Url(await this.crypto.hash(Pe.b64UrlToBuffer(t)))}};he.default=qr;var $t={};Object.defineProperty($t,"__esModule",{value:!0});$t.SiloResource=void 0;const De=G;let jr=class{constructor(t,e,r){this.api=t,this.crypto=e,this.transactions=r}async get(t){if(!t)throw new Error("No Silo URI specified");const e=await this.parseUri(t),r=await this.transactions.search("Silo-Name",e.getAccessKey());if(r.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);const u=await this.transactions.get(r[0]);if(!u)throw new Error(`No data could be found for the Silo URI: ${t}`);const f=u.get("data",{decode:!0,string:!1});return this.crypto.decrypt(f,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");const r=await this.parseUri(e),u=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(u,r.getEncryptionKey())}async parseUri(t){const e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");const r=e[1],u=Math.pow(2,parseInt(e[2])),f=await this.hash(De.stringToBuffer(r),u),c=De.bufferTob64(f.slice(0,15)),o=await this.hash(f.slice(16,31),1);return new ir(t,c,o)}async hash(t,e){let r=await this.crypto.hash(t);for(let u=0;u<e-1;u++)r=await this.crypto.hash(r);return r}};$t.default=jr;let ir=class{constructor(t,e,r){this.uri=t,this.accessKey=e,this.encryptionKey=r}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};$t.SiloResource=ir;var fe={};Object.defineProperty(fe,"__esModule",{value:!0});const xe=_t,Hr=G;let Kr=class{constructor(t){this.api=t}async getTransactionOffset(t){const e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,xe.getError)(e)}`)}async getChunk(t){const e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,xe.getError)(e)}`)}async getChunkData(t){const e=await this.getChunk(t);return Hr.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){const e=await this.getTransactionOffset(t),r=parseInt(e.size),f=parseInt(e.offset)-r+1,c=new Uint8Array(r);let o=0;for(;o<r;){this.api.config.logging&&console.log(`[chunk] ${o}/${r}`);let s;try{s=await this.getChunkData(f+o)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${f+o}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(s)c.set(s,o),o+=s.length;else throw new Error(`Couldn't complete data download at ${o}/${r}`)}return c}};fe.default=Kr;var de={};Object.defineProperty(de,"__esModule",{value:!0});const Fr=_t;let or=class cr{constructor(t,e){this.api=t,this.network=e}async get(t){const e=await this.api.get(`${cr.ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new Fr.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){const{current:t}=await this.network.getInfo();return await this.get(t)}};de.default=or;or.ENDPOINT="block/hash/";var Le;function Gt(){if(Le)return Pt;Le=1,Object.defineProperty(Pt,"__esModule",{value:!0});const n=ie,t=oe,e=ce,r=ue,u=Mr(),f=he,c=le(),o=G,s=$t,l=fe,g=de;class k{constructor(R){this.api=new t.default(R),this.wallets=new f.default(this.api,k.crypto),this.chunks=new l.default(this.api),this.transactions=new u.default(this.api,k.crypto,this.chunks),this.silo=new s.default(this.api,this.crypto,this.transactions),this.network=new r.default(this.api),this.blocks=new g.default(this.api,this.network),this.ar=new n.default}get crypto(){return k.crypto}get utils(){return k.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(R,B){const $={};if(Object.assign($,R),!R.data&&!(R.target&&R.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(R.owner==null&&B&&B!=="use_wallet"&&($.owner=B.n),R.last_tx==null&&($.last_tx=await this.transactions.getTransactionAnchor()),typeof R.data=="string"&&(R.data=o.stringToBuffer(R.data)),R.data instanceof ArrayBuffer&&(R.data=new Uint8Array(R.data)),R.data&&!(R.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(R.reward==null){const K=R.data?R.data.byteLength:0;$.reward=await this.transactions.getPrice(K,$.target)}$.data_root="",$.data_size=R.data?R.data.byteLength.toString():"0",$.data=R.data||new Uint8Array(0);const L=new c.default($);return await L.getSignatureData(),L}async createSiloTransaction(R,B,$){const L={};if(Object.assign(L,R),!R.data)throw new Error("Silo transactions must have a 'data' value");if(!$)throw new Error("No Silo URI specified.");if(R.target||R.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(R.owner==null){if(!B||!B.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");L.owner=B.n}R.last_tx==null&&(L.last_tx=await this.transactions.getTransactionAnchor());const K=await this.silo.parseUri($);if(typeof R.data=="string"){const M=await this.crypto.encrypt(o.stringToBuffer(R.data),K.getEncryptionKey());L.reward=await this.transactions.getPrice(M.byteLength),L.data=o.bufferTob64Url(M)}if(R.data instanceof Uint8Array){const M=await this.crypto.encrypt(R.data,K.getEncryptionKey());L.reward=await this.transactions.getPrice(M.byteLength),L.data=o.bufferTob64Url(M)}const j=new c.default(L);return j.addTag("Silo-Name",K.getAccessKey()),j.addTag("Silo-Version","0.1.0"),j}arql(R){return this.api.post("/arql",R).then(B=>B.data||[])}}return Pt.default=k,k.crypto=new e.default,k.utils=o,Pt}(function(n){var t=V&&V.__createBinding||(Object.create?function(u,f,c,o){o===void 0&&(o=c);var s=Object.getOwnPropertyDescriptor(f,c);(!s||("get"in s?!f.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return f[c]}}),Object.defineProperty(u,o,s)}:function(u,f,c,o){o===void 0&&(o=c),u[o]=f[c]}),e=V&&V.__exportStar||function(u,f){for(var c in u)c!=="default"&&!Object.prototype.hasOwnProperty.call(f,c)&&t(f,u,c)};Object.defineProperty(n,"__esModule",{value:!0});const r=Gt();r.default.init=function(u={}){function f(){const g={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return g;const k=location.protocol.replace(":",""),C=location.hostname,R=location.port?parseInt(location.port):k=="https"?443:80;return["localhost","127.0.0.1"].includes(C)||k=="file"?g:{host:C,port:R,protocol:k}}const c=f(),o=u.protocol||c.protocol,s=u.host||c.host,l=u.port||c.port;return new r.default(Object.assign(Object.assign({},u),{host:s,protocol:o,port:l}))},typeof globalThis=="object"?globalThis.Arweave=r.default:typeof self=="object"&&(self.Arweave=r.default),e(Gt(),n),n.default=r.default})(Ve);const Fn=kr(Ve);var ur={},lr={},Lt={},ge={};Object.defineProperty(ge,"__esModule",{value:!0});const zr=Wt;class Wr{constructor(){P(this,"BigNum");this.BigNum=(t,e)=>{let r=zr.BigNumber.clone({DECIMAL_PLACES:e});return new r(t)}}winstonToAr(t,{formatted:e=!1,decimals:r=12,trim:u=!0}={}){let f=this.stringToBigNum(t,r).shiftedBy(-12);return e?f.toFormat(r):f.toFixed(r)}arToWinston(t,{formatted:e=!1}={}){let r=this.stringToBigNum(t).shiftedBy(12);return e?r.toFormat():r.toFixed(0)}compare(t,e){let r=this.stringToBigNum(t),u=this.stringToBigNum(e);return r.comparedTo(u)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let r=this.stringToBigNum(t),u=this.stringToBigNum(e);return r.isLessThan(u)}isGreaterThan(t,e){let r=this.stringToBigNum(t),u=this.stringToBigNum(e);return r.isGreaterThan(u)}add(t,e){let r=this.stringToBigNum(t);return this.stringToBigNum(e),r.plus(e).toFixed(0)}sub(t,e){let r=this.stringToBigNum(t);return this.stringToBigNum(e),r.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}}ge.default=Wr;var pe={};Object.defineProperty(pe,"__esModule",{value:!0});class Gr{constructor(t){P(this,"METHOD_GET","GET");P(this,"METHOD_POST","POST");P(this,"config");this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){const e=t.protocol||"http",r=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:r,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,{...e,method:this.METHOD_GET})}async post(t,e,r){var f;const u=new Headers((r==null?void 0:r.headers)||{});return(f=u.get("content-type"))!=null&&f.includes("application/json")||u.append("content-type","application/json"),u.append("accept","application/json, text/plain, */*"),await this.request(t,{...r,method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:u})}async request(t,e){const r=new Headers((e==null?void 0:e.headers)||{}),u=`${this.config.protocol}://${this.config.host}:${this.config.port}`,f=e==null?void 0:e.responseType;e==null||delete e.responseType,t.startsWith("/")&&(t=t.slice(1)),this.config.network&&r.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${u}/${t}`);let c=await fetch(`${u}/${t}`,{...e||{},headers:r});this.config.logging&&this.config.logger(`Response:   ${c.url} - ${c.status}`);const o=c.headers.get("content-type"),s=c;if(f==="arraybuffer")s.data=await c.arrayBuffer();else if(f==="text")s.data=await c.text();else if(f==="webstream")s.data=Jr(c.body);else if(o!=null&&o.startsWith("application/json"))try{await c.clone().json(),s.data=await c.json()}catch{s.data=await c.text()}else s.data=await c.text();return s}}pe.default=Gr;const Jr=n=>{const t=n;return typeof t[Symbol.asyncIterator]>"u"?(t[Symbol.asyncIterator]=Xr(n),t):n},Xr=function(n){return async function*(){const e=n.getReader();try{const{done:r,value:u}=await e.read();if(r)return;yield u}finally{e.releaseLock()}}};var we={},J={};Object.defineProperty(J,"__esModule",{value:!0});J.b64UrlDecode=J.b64UrlEncode=J.bufferTob64Url=J.bufferTob64=J.b64UrlToBuffer=J.stringToB64Url=J.stringToBuffer=J.bufferToString=J.b64UrlToString=J.concatBuffers=void 0;const hr=Xe;function Vr(n){let t=0;for(let u=0;u<n.length;u++)t+=n[u].byteLength;let e=new Uint8Array(t),r=0;e.set(new Uint8Array(n[0]),r),r+=n[0].byteLength;for(let u=1;u<n.length;u++)e.set(new Uint8Array(n[u]),r),r+=n[u].byteLength;return e}J.concatBuffers=Vr;function Zr(n){let t=gr(n);return fr(t)}J.b64UrlToString=Zr;function fr(n){return new TextDecoder("utf-8",{fatal:!0}).decode(n)}J.bufferToString=fr;function dr(n){return new TextEncoder().encode(n)}J.stringToBuffer=dr;function Yr(n){return wr(dr(n))}J.stringToB64Url=Yr;function gr(n){return new Uint8Array(hr.toByteArray(mr(n)))}J.b64UrlToBuffer=gr;function pr(n){return hr.fromByteArray(new Uint8Array(n))}J.bufferTob64=pr;function wr(n){return yr(pr(n))}J.bufferTob64Url=wr;function yr(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}J.b64UrlEncode=yr;function mr(n){n=n.replace(/\-/g,"+").replace(/\_/g,"/");let t;return n.length%4==0?t=0:t=4-n.length%4,n.concat("=".repeat(t))}J.b64UrlDecode=mr;Object.defineProperty(we,"__esModule",{value:!0});const mt=J;class Qr{constructor(){P(this,"keyLength",4096);P(this,"publicExponent",65537);P(this,"hashAlgorithm","sha256");P(this,"driver");if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let u=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(u)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){const u={kty:"RSA",e:"AQAB",n:t},f=await this.jwkToPublicCryptoKey(u),c=await this.driver.digest("SHA-256",e),o=await this.driver.verify({name:"RSA-PSS",saltLength:0},f,r,e),s=await this.driver.verify({name:"RSA-PSS",saltLength:32},f,r,e),l=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((f.algorithm.modulusLength-1)/8)-c.byteLength-2},f,r,e);return o||s||l}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;const t=crypto==null?void 0:crypto.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(r=>typeof t[r]=="function")}async encrypt(t,e,r){const u=await this.driver.importKey("raw",typeof e=="string"?mt.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),f=await this.driver.deriveKey({name:"PBKDF2",salt:r?mt.stringToBuffer(r):mt.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},u,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),c=new Uint8Array(16);crypto.getRandomValues(c);const o=await this.driver.encrypt({name:"AES-CBC",iv:c},f,t);return mt.concatBuffers([c,o])}async decrypt(t,e,r){const u=await this.driver.importKey("raw",typeof e=="string"?mt.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),f=await this.driver.deriveKey({name:"PBKDF2",salt:r?mt.stringToBuffer(r):mt.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},u,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),c=t.slice(0,16),o=await this.driver.decrypt({name:"AES-CBC",iv:c},f,t.slice(16));return mt.concatBuffers([o])}}we.default=Qr;var ye={};Object.defineProperty(ye,"__esModule",{value:!0});class tn{constructor(t){P(this,"api");this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}}ye.default=tn;var Mt={},vt={};Object.defineProperty(vt,"__esModule",{value:!0});vt.getError=void 0;class en extends Error{constructor(e,r={}){var t=(...args)=>{super(...args);P(this,"type");P(this,"response")};r.message?t(r.message):t(),this.type=e,this.response=r.response}getType(){return this.type}}vt.default=en;function rn(n){let t=n.data;if(typeof n.data=="string")try{t=JSON.parse(n.data)}catch{}if(n.data instanceof ArrayBuffer||n.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:n.statusText||"unknown"}vt.getError=rn;var St={},qt={},Me;function nn(){if(Me)return qt;Me=1,Object.defineProperty(qt,"__esModule",{value:!0});const n=Jt();async function t(r){if(Array.isArray(r)){const c=n.default.utils.concatBuffers([n.default.utils.stringToBuffer("list"),n.default.utils.stringToBuffer(r.length.toString())]);return await e(r,await n.default.crypto.hash(c,"SHA-384"))}const u=n.default.utils.concatBuffers([n.default.utils.stringToBuffer("blob"),n.default.utils.stringToBuffer(r.byteLength.toString())]),f=n.default.utils.concatBuffers([await n.default.crypto.hash(u,"SHA-384"),await n.default.crypto.hash(r,"SHA-384")]);return await n.default.crypto.hash(f,"SHA-384")}qt.default=t;async function e(r,u){if(r.length<1)return u;const f=n.default.utils.concatBuffers([u,await t(r[0])]),c=await n.default.crypto.hash(f,"SHA-384");return await e(r.slice(1),c)}return qt}var se={},qe;function _r(){return qe||(qe=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.debug=n.validatePath=n.arrayCompare=n.bufferToInt=n.intToBuffer=n.arrayFlatten=n.generateProofs=n.buildLayers=n.generateTransactionChunks=n.generateTree=n.computeRootHash=n.generateLeaves=n.chunkData=n.MIN_CHUNK_SIZE=n.MAX_CHUNK_SIZE=void 0;const t=Jt(),e=J;n.MAX_CHUNK_SIZE=256*1024,n.MIN_CHUNK_SIZE=32*1024;const r=32,u=32;async function f(b){let _=[],A=b,S=0;for(;A.byteLength>=n.MAX_CHUNK_SIZE;){let I=n.MAX_CHUNK_SIZE,O=A.byteLength-n.MAX_CHUNK_SIZE;O>0&&O<n.MIN_CHUNK_SIZE&&(I=Math.ceil(A.byteLength/2));const q=A.slice(0,I),H=await t.default.crypto.hash(q);S+=q.byteLength,_.push({dataHash:H,minByteRange:S-q.byteLength,maxByteRange:S}),A=A.slice(I)}return _.push({dataHash:await t.default.crypto.hash(A),minByteRange:S,maxByteRange:S+A.byteLength}),_}n.chunkData=f;async function c(b){return Promise.all(b.map(async({dataHash:_,minByteRange:A,maxByteRange:S})=>({type:"leaf",id:await $(await Promise.all([$(_),$(L(S))])),dataHash:_,minByteRange:A,maxByteRange:S})))}n.generateLeaves=c;async function o(b){return(await s(b)).id}n.computeRootHash=o;async function s(b){return await g(await c(await f(b)))}n.generateTree=s;async function l(b){const _=await f(b),A=await c(_),S=await g(A),I=await k(S),O=_.slice(-1)[0];return O.maxByteRange-O.minByteRange===0&&(_.splice(_.length-1,1),I.splice(I.length-1,1)),{data_root:S.id,chunks:_,proofs:I}}n.generateTransactionChunks=l;async function g(b,_=0){if(b.length<2)return b[0];const A=[];for(let S=0;S<b.length;S+=2)A.push(await B(b[S],b[S+1]));return g(A,_+1)}n.buildLayers=g;function k(b){const _=C(b);return Array.isArray(_)?R(_):[_]}n.generateProofs=k;function C(b,_=new Uint8Array,A=0){if(b.type=="leaf")return{offset:b.maxByteRange-1,proof:(0,e.concatBuffers)([_,b.dataHash,L(b.maxByteRange)])};if(b.type=="branch"){const S=(0,e.concatBuffers)([_,b.leftChild.id,b.rightChild.id,L(b.byteRange)]);return[C(b.leftChild,S,A+1),C(b.rightChild,S,A+1)]}throw new Error("Unexpected node type")}function R(b){const _=[];return b.forEach(A=>{Array.isArray(A)?_.push(...R(A)):_.push(A)}),_}n.arrayFlatten=R;async function B(b,_){return _?{type:"branch",id:await $([await $(b.id),await $(_.id),await $(L(b.maxByteRange))]),byteRange:b.maxByteRange,maxByteRange:_.maxByteRange,leftChild:b,rightChild:_}:b}async function $(b){return Array.isArray(b)&&(b=t.default.utils.concatBuffers(b)),new Uint8Array(await t.default.crypto.hash(b))}function L(b){const _=new Uint8Array(r);for(var A=_.length-1;A>=0;A--){var S=b%256;_[A]=S,b=(b-S)/256}return _}n.intToBuffer=L;function K(b){let _=0;for(var A=0;A<b.length;A++)_*=256,_+=b[A];return _}n.bufferToInt=K;const j=(b,_)=>b.every((A,S)=>_[S]===A);n.arrayCompare=j;async function M(b,_,A,S,I){if(S<=0)return!1;if(_>=S)return M(b,0,S-1,S,I);if(_<0)return M(b,0,0,S,I);if(I.length==u+r){const at=I.slice(0,u),st=I.slice(at.length,at.length+r),ut=await $([await $(at),await $(st)]);return(0,n.arrayCompare)(b,ut)?{offset:S-1,leftBound:A,rightBound:S,chunkSize:S-A}:!1}const O=I.slice(0,u),q=I.slice(O.length,O.length+u),H=I.slice(O.length+q.length,O.length+q.length+r),F=K(H),tt=I.slice(O.length+q.length+H.length),rt=await $([await $(O),await $(q),await $(H)]);return(0,n.arrayCompare)(b,rt)?_<F?await M(O,_,A,Math.min(S,F),tt):await M(q,_,Math.max(A,F),S,tt):!1}n.validatePath=M;async function Z(b,_=""){if(b.byteLength<1)return _;const A=b.slice(0,u),S=b.slice(A.length,A.length+u),I=b.slice(A.length+S.length,A.length+S.length+r),O=K(I),q=b.slice(A.length+S.length+I.length),H=await $([await $(A),await $(S),await $(I)]),F=`${_}
${JSON.stringify(zt.Buffer.from(A))},${JSON.stringify(zt.Buffer.from(S))},${O} => ${JSON.stringify(H)}`;return Z(q,F)}n.debug=Z}(se)),se}var je;function me(){if(je)return St;je=1,Object.defineProperty(St,"__esModule",{value:!0}),St.Tag=void 0;const n=J,t=nn(),e=_r();class r{get(o,s){if(!Object.getOwnPropertyNames(this).includes(o))throw new Error(`Field "${o}" is not a property of the Arweave Transaction class.`);return this[o]instanceof Uint8Array?s&&s.decode&&s.string?n.bufferToString(this[o]):s&&s.decode&&!s.string?this[o]:n.bufferTob64Url(this[o]):s&&s.decode==!0?s&&s.string?n.b64UrlToString(this[o]):n.b64UrlToBuffer(this[o]):this[o]}}class u extends r{constructor(s,l,g=!1){super();P(this,"name");P(this,"value");this.name=s,this.value=l}}St.Tag=u;class f extends r{constructor(s={}){super();P(this,"format",2);P(this,"id","");P(this,"last_tx","");P(this,"owner","");P(this,"tags",[]);P(this,"target","");P(this,"quantity","0");P(this,"data_size","0");P(this,"data",new Uint8Array);P(this,"data_root","");P(this,"reward","0");P(this,"signature","");P(this,"chunks");Object.assign(this,s),typeof this.data=="string"&&(this.data=n.b64UrlToBuffer(this.data)),s.tags&&(this.tags=s.tags.map(l=>new u(l.name,l.value)))}addTag(s,l){this.tags.push(new u(n.stringToB64Url(s),n.stringToB64Url(l)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:n.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(s){this.owner=s}setSignature({id:s,owner:l,reward:g,tags:k,signature:C}){this.id=s,this.owner=l,g&&(this.reward=g),k&&(this.tags=k),this.signature=C}async prepareChunks(s){!this.chunks&&s.byteLength>0&&(this.chunks=await(0,e.generateTransactionChunks)(s),this.data_root=n.bufferTob64Url(this.chunks.data_root)),!this.chunks&&s.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(s,l){if(!this.chunks)throw new Error("Chunks have not been prepared");const g=this.chunks.proofs[s],k=this.chunks.chunks[s];return{data_root:this.data_root,data_size:this.data_size,data_path:n.bufferTob64Url(g.proof),offset:g.offset.toString(),chunk:n.bufferTob64Url(l.slice(k.minByteRange,k.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let s=this.tags.reduce((g,k)=>n.concatBuffers([g,k.get("name",{decode:!0,string:!1}),k.get("value",{decode:!0,string:!1})]),new Uint8Array);return n.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),n.stringToBuffer(this.quantity),n.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),s]);case 2:this.data_root||await this.prepareChunks(this.data);const l=this.tags.map(g=>[g.get("name",{decode:!0,string:!1}),g.get("value",{decode:!0,string:!1})]);return await(0,t.default)([n.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),n.stringToBuffer(this.quantity),n.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),l,n.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}}return St.default=f,St}var Rt={},He;function an(){if(He)return Rt;He=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.TransactionUploader=void 0;const n=me(),t=J,e=vt,r=_r(),u=1,f=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],c=1e3*40;class o{constructor(l,g){P(this,"api");P(this,"chunkIndex",0);P(this,"txPosted",!1);P(this,"transaction");P(this,"lastRequestTimeEnd",0);P(this,"totalErrors",0);P(this,"data");P(this,"lastResponseStatus",0);P(this,"lastResponseError","");if(this.api=l,!g.id)throw new Error("Transaction is not signed");if(!g.chunks)throw new Error("Transaction chunks not prepared");this.data=g.data,this.transaction=new n.default(Object.assign({},g,{data:new Uint8Array(0)}))}get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}async uploadChunk(l){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let g=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+c-Date.now(),c);if(g>0&&(g=g-g*Math.random()*.3,await new Promise(B=>setTimeout(B,g))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}l&&(this.chunkIndex=l);const k=this.transaction.getChunk(l||this.chunkIndex,this.data);if(!await(0,r.validatePath)(this.transaction.chunks.data_root,parseInt(k.offset),0,parseInt(k.data_size),t.b64UrlToBuffer(k.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);const R=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(B=>(console.error(B.message),{status:-1,data:{error:B.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=R.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,e.getError)(R),f.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(l,g,k){if(!g||typeof g.chunkIndex!="number"||typeof g.transaction!="object")throw new Error("Serialized object does not match expected format.");var C=new n.default(g.transaction);C.chunks||await C.prepareChunks(k);const R=new o(l,C);if(R.chunkIndex=g.chunkIndex,R.lastRequestTimeEnd=g.lastRequestTimeEnd,R.lastResponseError=g.lastResponseError,R.lastResponseStatus=g.lastResponseStatus,R.txPosted=g.txPosted,R.data=k,R.transaction.data_root!==g.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return R}static async fromTransactionId(l,g){const k=await l.get(`tx/${g}`);if(k.status!==200)throw new Error(`Tx ${g} not found: ${k.status}`);const C=k.data;return C.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:C}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=u){this.transaction.data=this.data;const k=await this.api.post("tx",this.transaction).catch(C=>(console.error(C),{status:-1,data:{error:C.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=k.status,this.transaction.data=new Uint8Array(0),k.status>=200&&k.status<300){this.txPosted=!0,this.chunkIndex=u;return}throw this.lastResponseError=(0,e.getError)(k),new Error(`Unable to upload transaction: ${k.status}, ${this.lastResponseError}`)}const g=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=g.status,!(g.status>=200&&g.status<300))throw this.lastResponseError=(0,e.getError)(g),new Error(`Unable to upload transaction: ${g.status}, ${this.lastResponseError}`);this.txPosted=!0}}return Rt.TransactionUploader=o,Rt}var Ke;function sn(){if(Ke)return Mt;Ke=1,Object.defineProperty(Mt,"__esModule",{value:!0});const n=vt,t=me(),e=J,r=an();class u{constructor(c,o,s){P(this,"api");P(this,"crypto");P(this,"chunks");this.api=c,this.crypto=o,this.chunks=s}getTransactionAnchor(){return this.api.get("tx_anchor").then(c=>c.data)}getPrice(c,o){let s=o?`price/${c}/${o}`:`price/${c}`;return this.api.get(s).then(l=>l.data)}async get(c){const o=await this.api.get(`tx/${c}`);if(o.status==200){const s=parseInt(o.data.data_size);if(o.data.format>=2&&s>0&&s<=1024*1024*12){const l=await this.getData(c);return new t.default({...o.data,data:l})}return new t.default({...o.data,format:o.data.format||1})}throw o.status==404?new n.default("TX_NOT_FOUND"):o.status==410?new n.default("TX_FAILED"):new n.default("TX_INVALID")}fromRaw(c){return new t.default(c)}async search(c,o){return this.api.post("arql",{op:"equals",expr1:c,expr2:o}).then(s=>s.data?s.data:[])}getStatus(c){return this.api.get(`tx/${c}/status`).then(o=>o.status==200?{status:200,confirmed:o.data}:{status:o.status,confirmed:null})}async getData(c,o){let s;try{s=await this.chunks.downloadChunkedData(c)}catch(l){console.error(`Error while trying to download chunked data for ${c}`),console.error(l)}if(!s){console.warn(`Falling back to gateway cache for ${c}`);try{s=(await this.api.get(`/${c}`,{responseType:"arraybuffer"})).data}catch(l){console.error(`Error while trying to download contiguous data from gateway cache for ${c}`),console.error(l)}}if(!s)throw new Error(`${c} was not found!`);return o&&o.decode&&!o.string?s:o&&o.decode&&o.string?e.bufferToString(s):e.bufferTob64Url(s)}async sign(c,o,s){if(!o&&typeof arweaveWallet!="object")throw new Error("A new Arweave transaction must provide the jwk parameter.");if(!o||o==="use_wallet"){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}const l=await arweaveWallet.sign(c,s);c.setSignature({id:l.id,owner:l.owner,reward:l.reward,tags:l.tags,signature:l.signature})}else{c.setOwner(o.n);let l=await c.getSignatureData(),g=await this.crypto.sign(o,l,s),k=await this.crypto.hash(g);c.setSignature({id:e.bufferTob64Url(k),owner:o.n,signature:e.bufferTob64Url(g)})}}async verify(c){const o=await c.getSignatureData(),s=c.get("signature",{decode:!0,string:!1}),l=e.bufferTob64Url(await this.crypto.hash(s));if(c.id!==l)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(c.owner,o,s)}async post(c){if(typeof c=="string"?c=new t.default(JSON.parse(c)):typeof c.readInt32BE=="function"?c=new t.default(JSON.parse(c.toString())):typeof c=="object"&&!(c instanceof t.default)&&(c=new t.default(c)),!(c instanceof t.default))throw new Error("Must be Transaction object");c.chunks||await c.prepareChunks(c.data);const o=await this.getUploader(c,c.data);try{for(;!o.isComplete;)await o.uploadChunk()}catch(s){if(o.lastResponseStatus>0)return{status:o.lastResponseStatus,statusText:o.lastResponseError,data:{error:o.lastResponseError}};throw s}return{status:200,statusText:"OK",data:{}}}async getUploader(c,o){let s;if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),c instanceof t.default){if(o||(o=c.data),!(o instanceof Uint8Array))throw new Error("Data format is invalid");c.chunks||await c.prepareChunks(o),s=new r.TransactionUploader(this.api,c),(!s.data||s.data.length===0)&&(s.data=o)}else{if(typeof c=="string"&&(c=await r.TransactionUploader.fromTransactionId(this.api,c)),!o||!(o instanceof Uint8Array))throw new Error("Must provide data when resuming upload");s=await r.TransactionUploader.fromSerialized(this.api,c,o)}return s}async*upload(c,o){const s=await this.getUploader(c,o);for(;!s.isComplete;)await s.uploadChunk(),yield s;return s}}return Mt.default=u,Mt}var _e={};Object.defineProperty(_e,"__esModule",{value:!0});const Fe=J;class on{constructor(t,e){P(this,"api");P(this,"crypto");this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Fe.bufferTob64Url(await this.crypto.hash(Fe.b64UrlToBuffer(t)))}}_e.default=on;var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.SiloResource=void 0;const ze=J;class cn{constructor(t,e,r){P(this,"api");P(this,"crypto");P(this,"transactions");this.api=t,this.crypto=e,this.transactions=r}async get(t){if(!t)throw new Error("No Silo URI specified");const e=await this.parseUri(t),r=await this.transactions.search("Silo-Name",e.getAccessKey());if(r.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);const u=await this.transactions.get(r[0]);if(!u)throw new Error(`No data could be found for the Silo URI: ${t}`);const f=u.get("data",{decode:!0,string:!1});return this.crypto.decrypt(f,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");const r=await this.parseUri(e),u=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(u,r.getEncryptionKey())}async parseUri(t){const e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");const r=e[1],u=Math.pow(2,parseInt(e[2])),f=await this.hash(ze.stringToBuffer(r),u),c=ze.bufferTob64(f.slice(0,15)),o=await this.hash(f.slice(16,31),1);return new vr(t,c,o)}async hash(t,e){let r=await this.crypto.hash(t);for(let u=0;u<e-1;u++)r=await this.crypto.hash(r);return r}}Bt.default=cn;class vr{constructor(t,e,r){P(this,"uri");P(this,"accessKey");P(this,"encryptionKey");this.uri=t,this.accessKey=e,this.encryptionKey=r}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}}Bt.SiloResource=vr;var ve={};Object.defineProperty(ve,"__esModule",{value:!0});const We=vt,un=J;class ln{constructor(t){P(this,"api");this.api=t}async getTransactionOffset(t){const e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,We.getError)(e)}`)}async getChunk(t){const e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,We.getError)(e)}`)}async getChunkData(t){const e=await this.getChunk(t);return un.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){const e=await this.getTransactionOffset(t),r=parseInt(e.size),f=parseInt(e.offset)-r+1,c=new Uint8Array(r);let o=0;for(;o<r;){this.api.config.logging&&console.log(`[chunk] ${o}/${r}`);let s;try{s=await this.getChunkData(f+o)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${f+o}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(s)c.set(s,o),o+=s.length;else throw new Error(`Couldn't complete data download at ${o}/${r}`)}return c}}ve.default=ln;var Te={};Object.defineProperty(Te,"__esModule",{value:!0});const hn=vt,Ue=class{constructor(t,e){P(this,"api");P(this,"network");this.api=t,this.network=e}async get(t){const e=await this.api.get(`${Ue.ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new hn.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){const{current:t}=await this.network.getInfo();return await this.get(t)}};let Ft=Ue;P(Ft,"ENDPOINT","block/hash/");Te.default=Ft;var Ge;function Jt(){if(Ge)return Lt;Ge=1,Object.defineProperty(Lt,"__esModule",{value:!0});const n=ge,t=pe,e=we,r=ye,u=sn(),f=_e,c=me(),o=J,s=Bt,l=ve,g=Te,C=class{constructor(B){P(this,"api");P(this,"wallets");P(this,"transactions");P(this,"network");P(this,"blocks");P(this,"ar");P(this,"silo");P(this,"chunks");this.api=new t.default(B),this.wallets=new f.default(this.api,C.crypto),this.chunks=new l.default(this.api),this.transactions=new u.default(this.api,C.crypto,this.chunks),this.silo=new s.default(this.api,this.crypto,this.transactions),this.network=new r.default(this.api),this.blocks=new g.default(this.api,this.network),this.ar=new n.default}get crypto(){return C.crypto}get utils(){return C.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(B,$){const L={};if(Object.assign(L,B),!B.data&&!(B.target&&B.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(B.owner==null&&$&&$!=="use_wallet"&&(L.owner=$.n),B.last_tx==null&&(L.last_tx=await this.transactions.getTransactionAnchor()),typeof B.data=="string"&&(B.data=o.stringToBuffer(B.data)),B.data instanceof ArrayBuffer&&(B.data=new Uint8Array(B.data)),B.data&&!(B.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(B.reward==null){const j=B.data?B.data.byteLength:0;L.reward=await this.transactions.getPrice(j,L.target)}L.data_root="",L.data_size=B.data?B.data.byteLength.toString():"0",L.data=B.data||new Uint8Array(0);const K=new c.default(L);return await K.getSignatureData(),K}async createSiloTransaction(B,$,L){const K={};if(Object.assign(K,B),!B.data)throw new Error("Silo transactions must have a 'data' value");if(!L)throw new Error("No Silo URI specified.");if(B.target||B.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(B.owner==null){if(!$||!$.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");K.owner=$.n}B.last_tx==null&&(K.last_tx=await this.transactions.getTransactionAnchor());const j=await this.silo.parseUri(L);if(typeof B.data=="string"){const Z=await this.crypto.encrypt(o.stringToBuffer(B.data),j.getEncryptionKey());K.reward=await this.transactions.getPrice(Z.byteLength),K.data=o.bufferTob64Url(Z)}if(B.data instanceof Uint8Array){const Z=await this.crypto.encrypt(B.data,j.getEncryptionKey());K.reward=await this.transactions.getPrice(Z.byteLength),K.data=o.bufferTob64Url(Z)}const M=new c.default(K);return M.addTag("Silo-Name",j.getAccessKey()),M.addTag("Silo-Version","0.1.0"),M}arql(B){return this.api.post("/arql",B).then($=>$.data||[])}};let k=C;return P(k,"init"),P(k,"crypto",new e.default),P(k,"utils",o),Lt.default=k,Lt}var Xt={};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.getDefaultConfig=void 0;const fn=(n,t)=>{const e=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,r=t.split("."),u=r[r.length-1],f=["localhost","[::1]"];return f.includes(t)||n=="file"||f.includes(u)||!!t.match(e)||!!u.match(e)},dn=n=>{const t=n.charAt(0)==="[",e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!n.match(e)||t},gn=(n,t)=>{if(fn(n,t))return{protocol:"https",host:"arweave.net",port:443};if(!dn(t)){let e=t.split(".");if(e.length>=3){e.shift();const r=e.join(".");return{protocol:n,host:r}}}return{protocol:n,host:t}};Xt.getDefaultConfig=gn;(function(n){var t=V&&V.__createBinding||(Object.create?function(f,c,o,s){s===void 0&&(s=o);var l=Object.getOwnPropertyDescriptor(c,o);(!l||("get"in l?!c.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return c[o]}}),Object.defineProperty(f,s,l)}:function(f,c,o,s){s===void 0&&(s=o),f[s]=c[o]}),e=V&&V.__exportStar||function(f,c){for(var o in f)o!=="default"&&!Object.prototype.hasOwnProperty.call(c,o)&&t(c,f,o)};Object.defineProperty(n,"__esModule",{value:!0});const r=Jt(),u=Xt;r.default.init=function(f={}){const c={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new r.default({...f,...c});const o=location.protocol.replace(":",""),s=location.hostname,l=location.port?parseInt(location.port):o=="https"?443:80,g=(0,u.getDefaultConfig)(o,s),k=f.protocol||g.protocol,C=f.host||g.host,R=f.port||g.port||l;return new r.default({...f,host:C,protocol:k,port:R})},typeof globalThis=="object"?globalThis.Arweave=r.default:typeof self=="object"&&(self.Arweave=r.default),e(Jt(),n),n.default=r.default})(lr);var be={},Ae={},Vt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.log=n.Log=n.LOGS=void 0;var t;(function(r){r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.ARWEAVE=2]="ARWEAVE"})(t=n.LOGS||(n.LOGS={}));class e{constructor(){this.logs=t.ARWEAVE}init(u=t.ARWEAVE,f){return this.logs=u,this.arweave=f,this}show(u,f="log"){(this.logs===t.YES||this.logs===t.ARWEAVE&&this.arweave.getConfig().api.logging)&&console[f](u)}}n.Log=e,n.log=new e})(Vt);Object.defineProperty(Ae,"__esModule",{value:!0});const jt=Vt;class pn{constructor(t){this._id=t.id,this._timestamp=t.timestamp,this._height=t.height,this._previous=t.previous}get id(){return this._id||jt.log.show("ID wasn't defined, make sure you have selected to return it."),this._id}get timestamp(){return this._timestamp||jt.log.show("Timestamp wasn't defined, make sure you have selected to return it."),this._timestamp}get height(){return this._height||jt.log.show("Height wasn't defined, make sure you have selected to return it."),this._height}get previous(){return this._previous||jt.log.show("Previous wasn't defined, make sure you have selected to return it."),this._previous}}Ae.default=pn;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});const lt=Vt;class wn{get id(){return this._id||lt.log.show("ID wasn't defined, make sure you have selected to return it."),this._id}get anchor(){return this._anchor||lt.log.show("Anchor wasn't defined, make sure you have selected to return it."),this._anchor}get signature(){return this._signature||lt.log.show("Signature wasn't defined, make sure you have selected to return it."),this._signature}get recipient(){return this._recipient||lt.log.show("Recipient wasn't defined, make sure you have selected to return it."),this._recipient}get owner(){return this._owner||lt.log.show("Owner wasn't defined, make sure you have selected to return it."),this._owner}get fee(){return this._fee||lt.log.show("Fee wasn't defined, make sure you have selected to return it."),this._fee}get quantity(){return this._quantity||lt.log.show("Quantity wasn't defined, make sure you have selected to return it."),this._quantity}get data(){return this._data||lt.log.show("Data wasn't defined, make sure you have selected to return it."),this._data}get tags(){return this._tags||lt.log.show("Tags wasn't defined, make sure you have selected to return it."),this._tags}get block(){return this._block||lt.log.show("Block wasn't defined, make sure you have selected to return it."),this._block}get parent(){return(!this._parent||!this._parent.id)&&lt.log.show("Parent wasn't defined, make sure you have selected to return it."),this._parent}constructor(t,e){this._id=t.id,this._anchor=t.anchor,this._signature=t.signature,this._recipient=t.recipient,this._owner=t.owner,this._fee=t.fee,this._quantity=t.quantity,this._data=t.data,this._tags=t.tags,this._block=t.block,t.parent&&t.parent.id&&(this._parent=t.parent),this.arweave=e}}Ee.default=wn;var At=V&&V.__awaiter||function(n,t,e,r){function u(f){return f instanceof e?f:new e(function(c){c(f)})}return new(e||(e=Promise))(function(f,c){function o(g){try{l(r.next(g))}catch(k){c(k)}}function s(g){try{l(r.throw(g))}catch(k){c(k)}}function l(g){g.done?f(g.value):u(g.value).then(o,s)}l((r=r.apply(n,t||[])).next())})},Tr=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(be,"__esModule",{value:!0});const Ht=Tr(Ae),Kt=Tr(Ee),dt=Vt;class yn{constructor(t,e=dt.LOGS.ARWEAVE){this.reqType="transactions",this.options={},this.after="",this.afterRegex=/after: *"([^"]*)"/gi,this.emptyLinesRegex=/^\s*[\r\n]/gm,this.fields=["id","anchor","signature","recipient","owner","owner.address","owner.key","fee","fee.winston","fee.ar","quantity","quantity.winston","quantity.ar","data","data.size","data.type","tags","tags.name","tags.value","block","block.id","block.timestamp","block.height","block.previous","parent","parent.id"],this.includes=new Set,this.arweave=t,dt.log.init(e,t),this.includes=new Set(this.fields)}getCursor(){return this.after}search(t="transactions"){return this.reqType=t,this.options={},this.after="",this}id(t){return this.checkSearchType(),this.options.id=t,this.options.ids=[t],this}ids(t){return this.checkSearchType(),this.options.ids=t,this.options.id=t[0],this}appName(t){return this.checkSearchType(),this.tag("App-Name",[t]),this}type(t){return this.checkSearchType(),this.tag("Content-Type",[t]),this}tags(t){this.checkSearchType();const e=[];for(const u of t){const f=typeof u.values=="string"?[u.values]:u.values;e.push({name:u.name,values:f})}const r=this.options.tags&&this.options.tags.length?this.options.tags:[];return this.options.tags=[...e,...r],this}tag(t,e){return this.checkSearchType(),this.options.tags||(this.options.tags=[]),typeof e=="string"&&(e=[e]),this.options.tags.push({name:t,values:e}),this}from(t){return this.checkSearchType(),typeof t=="string"&&(t=[t]),this.options.owners=t,this}to(t){return this.checkSearchType(),typeof t=="string"&&(t=[t]),this.options.recipients=t,this}min(t){return this.checkSearchType(),this.options.block||(this.options.block={}),this.options.block.min=t,this}max(t){return this.checkSearchType(),this.options.block||(this.options.block={}),this.options.block.max=t,this}limit(t){return this.checkSearchType(),t<1?(console.warn("Limit cannot be less than 1, setting it to 1."),t=1):t>100&&console.warn("Arweave GQL won't return more than 100 entries at once."),this.options.first=t,this}sort(t){return this.options.sort=t,this}cursor(t){return this.checkSearchType(),this.options.after=t,this}only(t){if(this.includes=new Set,typeof t=="string"&&this.fields.indexOf(t)!==-1)return this.includes.add(t),this.validateIncludes(),this;const e=[];for(const r of t)this.fields.indexOf(r)!==-1&&e.push(r);return e.length&&(this.includes=new Set(e)),this.validateIncludes(),this}exclude(t){if(this.includes=new Set(this.fields),typeof t=="string")return this.includes.delete(t),this.validateIncludes(),this;for(const e of t)this.includes.delete(e);return this.validateIncludes(),this}find(t={}){return At(this,void 0,void 0,function*(){this.checkSearchType();for(const r of Object.keys(t))this.options[r]=t[r];this.options.first||(this.options.first=10);const e=this.construct();return this.run(e)})}findOne(t={}){return At(this,void 0,void 0,function*(){this.checkSearchType();for(const u of Object.keys(t))this.options[u]=t[u];this.options.first=1;const e=this.construct(),r=yield this.run(e);return r.length?r[0]:null})}findAll(t={}){return At(this,void 0,void 0,function*(){this.checkSearchType();for(const r of Object.keys(t))this.options[r]=t[r];this.options.first=100;const e=this.construct();return this.runAll(e)})}next(){return At(this,void 0,void 0,function*(){if(!this.after||!this.after.length){dt.log.show("next(): Nothing more to search.");return}const t=this.construct().replace(this.afterRegex,`after: "${this.after}"`),e=yield this.run(t);return this.options.first===1?e.length?e[0]:null:e})}run(t){return At(this,void 0,void 0,function*(){dt.log.show("Running query:"),dt.log.show(t);const e=yield this.get(t);if(!e)return[];if(e.transaction)return[new Kt.default(e.transaction,this.arweave)];if(e.block)return[new Ht.default(e.block)];if(e.transactions){const r=e.transactions.edges;return r&&r.length?this.after=r[r.length-1].cursor:this.after="",r.map(u=>new Kt.default(u.node,this.arweave))}else if(e.blocks){const r=e.blocks.edges;return r&&r.length?this.after=r[r.length-1].cursor:this.after="",r.map(u=>new Ht.default(u.node))}})}runAll(t){return At(this,void 0,void 0,function*(){let e=!0,r=[],u=this.options.after||"",f=!0;for(;e;){dt.log.show("Running query:"),dt.log.show(t);const c=yield this.get(t);if(!c)return[];if(c.transaction)return[new Kt.default(c.transaction,this.arweave)];if(c.block)return[new Ht.default(c.block)];if(c.transactions){const o=c.transactions;o.edges&&o.edges.length&&(r=r.concat(o.edges),u=o.edges[o.edges.length-1].cursor,t=t.replace(this.afterRegex,`after: "${u}"`)),e=o.pageInfo.hasNextPage}else if(c.blocks){f=!1;const o=c.blocks;o.edges&&o.edges.length&&(r=r.concat(o.edges),u=o.edges[o.edges.length-1].cursor,t=t.replace(this.afterRegex,`after: "${u}"`)),e=o.pageInfo.hasNextPage}}return f?r.map(c=>new Kt.default(c.node,this.arweave)):r.map(c=>new Ht.default(c.node))})}checkSearchType(){if(!this.reqType||this.reqType!=="transaction"&&this.reqType!=="block"&&this.reqType!=="transactions"&&this.reqType!=="blocks")throw new Error('Invalid search type. Must provide one and it must be either "transaction", "transactions", "block" or "blocks"')}get(t){return At(this,void 0,void 0,function*(){const e=yield this.arweave.api.post("graphql",{query:t},{headers:{"content-type":"application/json"}});return dt.log.show("Returned result: "),dt.log.show(e.data.data),e.data.data})}construct(){this.reqType==="transactions"||this.reqType==="blocks"?(delete this.options.id,this.reqType==="transactions"?delete this.options.height:(delete this.options.owners,delete this.options.recipients,delete this.options.tags,delete this.options.block),this.options.after||(this.options.after="")):this.options={id:this.options.id};let t=JSON.stringify(this.options,null,2).replace(/"([^"]+)":/gm,"$1: ").replace('"HEIGHT_DESC"',"HEIGHT_DESC").replace('"HEIGHT_ASC"',"HEIGHT_ASC");t=t.substring(1,t.length-1);let e="";if(this.reqType==="transaction"||this.reqType==="transactions"){let r="";this.includes.has("owner")&&(r=`owner {
          ${this.includes.has("owner.address")?"address":""}
          ${this.includes.has("owner.key")?"key":""}
        }`);let u="";this.includes.has("fee")&&(u=`fee {
          ${this.includes.has("fee.winston")?"winston":""}
          ${this.includes.has("fee.ar")?"ar":""}
        }`);let f="";this.includes.has("quantity")&&(f=`quantity {
          ${this.includes.has("quantity.winston")?"winston":""}
          ${this.includes.has("quantity.ar")?"ar":""}
        }`);let c="";this.includes.has("data")&&(c=`data {
          ${this.includes.has("data.size")?"size":""}
          ${this.includes.has("data.type")?"type":""}
        }`);let o="";this.includes.has("tags")&&(o=`tags {
          ${this.includes.has("tags.name")?"name":""}
          ${this.includes.has("tags.value")?"value":""}
        }`);let s="";this.includes.has("block")&&(s=`block {
          ${this.includes.has("block.id")?"id":""}
          ${this.includes.has("block.timestamp")?"timestamp":""}
          ${this.includes.has("block.height")?"height":""}
          ${this.includes.has("block.previous")?"previous":""}
        }`);let l="";(this.includes.has("parent")||this.includes.has("parent.id"))&&(l=`parent {
          id
        }`),e=`
      ${this.includes.has("id")?"id":""}
      ${this.includes.has("anchor")?"anchor":""}
      ${this.includes.has("signature")?"signature":""}
      ${this.includes.has("recipient")?"recipient":""}
      ${r}
      ${u}
      ${f}
      ${c}
      ${o}
      ${s}
      ${l}
      `,e=e.replace(this.emptyLinesRegex,"").trim(),e.length||(e=`
        id
        anchor
        signature
        recipient
        owner {
          address
          key
        }
        fee {
          winston
          ar
        }
        quantity {
          winston
          ar
        }
        data {
          size
          type
        }
        tags {
          name
          value
        }
        block {
          id
          timestamp
          height
          previous
        }
        parent {
          id
        }`)}else e=`
      ${this.includes.has("block.id")?"id":""}
      ${this.includes.has("block.timestamp")?"timestamp":""}
      ${this.includes.has("block.height")?"height":""}
      ${this.includes.has("block.previous")?"previous":""}
      `,e=e.replace(this.emptyLinesRegex,"").trim(),e.length||(e=`
        id
        timestamp
        height
        previous`);if((this.reqType==="transactions"||this.reqType==="blocks")&&(e=`
      pageInfo {
        hasNextPage
      }
      edges { 
        cursor
        node { 
          ${e}
        } 
      }`),!this.reqType||!t)throw new Error("Invalid options. You need to first set your options!");return`query {
      ${this.reqType}(
        ${t}
      ){
        ${e}
      }
    }`.replace(/(\r\n|\n|\r)/gm,"")}validateIncludes(){this.includes.has("owner")&&!this.includes.has("owner.address")&&!this.includes.has("owner.key")&&(this.includes.add("owner.address"),this.includes.add("owner.key")),this.includes.has("fee")&&!this.includes.has("fee.winston")&&!this.includes.has("fee.ar")&&(this.includes.add("fee.winston"),this.includes.add("fee.ar")),this.includes.has("quantity")&&!this.includes.has("quantity.winston")&&!this.includes.has("quantity.ar")&&(this.includes.add("quantity.winston"),this.includes.add("quantity.ar")),this.includes.has("data")&&!this.includes.has("data.size")&&!this.includes.has("data.type")&&(this.includes.add("data.size"),this.includes.add("data.type")),this.includes.has("tags")&&!this.includes.has("tags.name")&&!this.includes.has("tags.value")&&(this.includes.add("tags.name"),this.includes.add("tags.value")),this.includes.has("block")&&!this.includes.has("block.timestamp")&&!this.includes.has("block.height")&&!this.includes.has("block.previous")&&(this.includes.add("block.id"),this.includes.add("block.timestamp"),this.includes.add("block.height"),this.includes.add("block.previous")),!this.includes.has("owner")&&(this.includes.has("owner.address")||this.includes.has("owner.key"))&&this.includes.add("owner"),!this.includes.has("fee")&&(this.includes.has("fee.winston")||this.includes.has("fee.ar"))&&this.includes.add("fee"),!this.includes.has("quantity")&&(this.includes.has("quantity.winston")||this.includes.has("quantity.ar"))&&this.includes.add("quantity"),!this.includes.has("data")&&(this.includes.has("data.size")||this.includes.has("data.type"))&&this.includes.add("data"),!this.includes.has("tags")&&(this.includes.has("tags.name")||this.includes.has("tags.value"))&&this.includes.add("tags"),!this.includes.has("block")&&(this.includes.has("block.timestamp")||this.includes.has("block.height")||this.includes.has("block.previous"))&&this.includes.add("block")}}be.default=yn;var ke={},Se={},Ct={},pt={};Object.defineProperty(pt,"__esModule",{value:!0});pt.PROTOCOL_NAME=pt.DEFAULT_BANNER_URI=pt.DEFAULT_AVATAR_URI=void 0;pt.DEFAULT_AVATAR_URI="ar://OrG-ZG2WN3wdcwvpjz1ihPe4MI24QBJUpsJGIdL85wA";pt.DEFAULT_BANNER_URI="ar://a0ieiziq2JkYhWamlrUCHxrGYnHWUAMcONxRmfkWt-k";pt.PROTOCOL_NAME=["Account-0.2","Account-0.3"];Object.defineProperty(Ct,"__esModule",{value:!0});const gt=pt;class mn{constructor(t){this.gatewayConfig=t}getURLfromURI(t){let e;const r=this.gatewayConfig;return/^[a-zA-Z0-9\-_]{43}$/.test(t)?`${r.protocol}://${r.host}:${r.port}/${t}`:(e=t.match(/^ar:\/\/([a-zA-Z0-9\-_]{43})$/))?`${r.protocol}://${r.host}:${r.port}/${e[1]}`:/^https?:\/\/.+$/.test(t)?t:`${r.protocol}://${r.host}:${r.port}/${gt.DEFAULT_AVATAR_URI}`}getUniqueHandle(t,e){return e&&typeof e=="string"?`@${e}#${t.slice(0,3)}${t.slice(t.length-3)}`:`${t.slice(0,5)}...${t.slice(t.length-5)}`}isEncodedAccount(t){return t.handle!==void 0&&t.handle.length>0}isProfile(t){return t.handleName!==void 0&&t.handleName.length>0&&t.links!==void 0}getDefaultAccount(t){return{txid:null,addr:t,handle:this.getUniqueHandle(t),profile:{handleName:"",avatar:gt.DEFAULT_AVATAR_URI,avatarURL:this.getURLfromURI(gt.DEFAULT_AVATAR_URI),banner:gt.DEFAULT_BANNER_URI,bannerURL:this.getURLfromURI(gt.DEFAULT_BANNER_URI),name:"",bio:"",email:"",links:{},wallets:{}}}}encode(t){let e={handle:t.handleName};return t.avatar&&(e=Object.assign(Object.assign({},e),{avatar:t.avatar})),t.banner&&(e=Object.assign(Object.assign({},e),{banner:t.banner})),t.name&&(e=Object.assign(Object.assign({},e),{name:t.name})),t.bio&&(e=Object.assign(Object.assign({},e),{bio:t.bio})),t.email&&(e=Object.assign(Object.assign({},e),{email:t.email})),t.links&&(e=Object.assign(Object.assign({},e),{links:t.links})),t.wallets&&(e=Object.assign(Object.assign({},e),{wallets:t.wallets})),e}decode(t,e,r){return this.isEncodedAccount(r)?{txid:t,addr:e,handle:this.getUniqueHandle(e,r.handle),profile:{handleName:r.handle?r.handle:"",avatar:r.avatar?r.avatar:gt.DEFAULT_AVATAR_URI,avatarURL:r.avatar?this.getURLfromURI(r.avatar):this.getURLfromURI(gt.DEFAULT_AVATAR_URI),banner:r.banner?r.banner:gt.DEFAULT_BANNER_URI,bannerURL:r.banner?this.getURLfromURI(r.banner):this.getURLfromURI(gt.DEFAULT_BANNER_URI),name:r.name?r.name:"",bio:r.bio?r.bio:"",email:r.email?r.email:"",links:r.links?r.links:{},wallets:r.wallets?r.wallets:{}}}:this.getDefaultAccount(e)}}Ct.default=mn;var _n=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Se,"__esModule",{value:!0});const vn=_n(Ct);class Tn{constructor(t,e,r){this.expirationTime=e,this.size=t,this.data=new vn.default(r),localStorage.getItem("arweave-account")||localStorage.setItem("arweave-account","[]")}get(t){var e;const u=(e=JSON.parse(localStorage.getItem("arweave-account")).find(f=>f.addr===t&&Date.now()<f.timestamp+this.expirationTime))===null||e===void 0?void 0:e.account;if(u)return u;if(u===null)return this.data.getDefaultAccount(t)}find(t){var e;return(e=JSON.parse(localStorage.getItem("arweave-account")).find(u=>{var f;return((f=u.account)===null||f===void 0?void 0:f.handle)===t&&Date.now()<u.timestamp+this.expirationTime}))===null||e===void 0?void 0:e.account}hydrate(t,e){const r={timestamp:Date.now(),addr:t,account:e||null},u=JSON.parse(localStorage.getItem("arweave-account")),f=u.findIndex(c=>c.addr===r.addr);f!==-1?u.splice(f,1,r):(u.unshift(r),u.length>this.size&&u.pop()),localStorage.setItem("arweave-account",JSON.stringify(u))}reset(){localStorage.setItem("arweave-account","[]")}dump(){return localStorage.getItem("arweave-account")}}Se.default=Tn;var Oe={},bn=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Oe,"__esModule",{value:!0});const An=bn(Ct);class En{constructor(t,e,r){this.store=new Map,this.expirationTime=e,this.size=t,this.data=new An.default(r)}get(t){var e;const r=this.store.get(t);if(r&&Date.now()<r.timestamp+this.expirationTime){const u=(e=this.store.get(t))===null||e===void 0?void 0:e.account;if(u)return u;if(u===null)return this.data.getDefaultAccount(t)}}find(t){var e,r;for(const[u,f]of this.store){const c=(r=(e=f.account)===null||e===void 0?void 0:e.profile)===null||r===void 0?void 0:r.handleName;if(t===c&&Date.now()<f.timestamp+this.expirationTime)return f.account}}hydrate(t,e){const r={timestamp:Date.now(),addr:t,account:e||null};this.store.set(r.addr,r),this.store.size>=this.size&&this.store.delete(this.store.keys().next().value)}reset(){this.store.clear()}dump(){return this.store}}Oe.default=En;var br=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ke,"__esModule",{value:!0});const kn=br(Se),Sn=br(Oe);class On{constructor(t,e,r,u){if(this.select={web:()=>new kn.default(this.size,this.expirationTime,this.gatewayConfig),node:()=>new Sn.default(this.size,this.expirationTime,this.gatewayConfig)},this.get=f=>this.cacheObj.get(f),this.find=f=>this.cacheObj.find(f),this.hydrate=(f,c)=>this.cacheObj.hydrate(f,c),this.reset=()=>this.cacheObj.reset(),this.dump=()=>this.cacheObj.dump(),this.size=e,this.expirationTime=r,this.gatewayConfig=u,typeof t=="object")this.cacheObj=t;else if(this.select[t])this.cacheObj=this.select[t]();else throw new Error(`Cache for the '${t}' environment is not implemented.`)}}ke.default=On;var Et=V&&V.__awaiter||function(n,t,e,r){function u(f){return f instanceof e?f:new e(function(c){c(f)})}return new(e||(e=Promise))(function(f,c){function o(g){try{l(r.next(g))}catch(k){c(k)}}function s(g){try{l(r.throw(g))}catch(k){c(k)}}function l(g){g.done?f(g.value):u(g.value).then(o,s)}l((r=r.apply(n,t||[])).next())})},Zt=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ur,"__esModule",{value:!0});const Un=Zt(lr),Rn=Zt(be),Je=Zt(ke),Nn=Zt(Ct),Nt=pt;class $n{constructor({cacheIsActivated:t=!0,cacheSize:e=100,cacheTime:r=6e4,gateway:u={host:"arweave.net",port:443,protocol:"https",timeout:2e4,logging:!1}}={}){this.walletAddr=null,this.debug={resetCache:()=>{var f;(f=this.cache)===null||f===void 0||f.reset()},printCache:()=>{var f;const c=new Date;console.log(` > Cache content at ${c.toISOString().replace(/T/," ").replace(/\..+/,"")}
`),console.log((f=this.cache)===null||f===void 0?void 0:f.dump())}},this.arweave=Un.default.init(u),this.ardb=new Rn.default(this.arweave),this.data=new Nn.default(u),t?typeof window<"u"?this.cache=new Je.default("web",e,r,u):this.cache=new Je.default("node",e,r,u):this.cache=null}connect(t="use_wallet"){return Et(this,void 0,void 0,function*(){this.walletAddr=yield this.arweave.wallets.getAddress(t)})}updateProfile(t){var e;return Et(this,void 0,void 0,function*(){if(!this.walletAddr)throw Error("Method connect() should be called before updateProfile().");if(!this.data.isProfile(t))throw Error(`Object "${JSON.stringify(t)}" doesn't match with the shape of a T_profile object.
Typescript tip: import { T_profile } from 'arweave-account'`);const r=this.data.encode(t),u=JSON.stringify(r),f=yield this.arweave.createTransaction({data:u});f.addTag("Protocol-Name",Nt.PROTOCOL_NAME[Nt.PROTOCOL_NAME.length-1]),f.addTag("handle",t.handleName);let c=f;try{if(window.arweaveWallet)c=yield window.arweaveWallet.dispatch(f);else throw"no window.arweaveWallet"}catch{try{yield this.arweave.transactions.sign(f),yield this.arweave.transactions.post(f)}catch(s){throw s}}if(r){const o=this.data.decode(f.id,this.walletAddr,r);(e=this.cache)===null||e===void 0||e.hydrate(this.walletAddr,o)}return c})}get(t){var e,r;return Et(this,void 0,void 0,function*(){if(t=t.trim(),!/^[a-zA-Z0-9\-_]{43}$/.test(t))throw"Invalid wallet address argument";const u=(e=this.cache)===null||e===void 0?void 0:e.get(t);if(u)return u;{const f=yield this.ardb.search("transactions").tag("Protocol-Name",Nt.PROTOCOL_NAME).from(t).limit(1).find(),c=f[0]?f[0].id:null,o=c?(yield this.arweave.api.get(c).catch(()=>({data:null}))).data:{data:null};try{const s=this.data.decode(c,t,JSON.parse(o));return(r=this.cache)===null||r===void 0||r.hydrate(t,s),s}catch{return this.data.getDefaultAccount(t)}}})}search(t){return Et(this,void 0,void 0,function*(){const r=(yield this.ardb.search("transactions").tag("Protocol-Name",Nt.PROTOCOL_NAME).tag("handle",t).limit(100).find()).map(f=>Et(this,void 0,void 0,function*(){var c;const o=f.id,s="owner"in f?f.owner.address:"anonymous",l=(yield this.arweave.api.get(o).catch(()=>({data:null}))).data;try{const g=this.data.decode(o,s,JSON.parse(l));return(c=this.cache)===null||c===void 0||c.hydrate(s,g),g}catch{return this.data.getDefaultAccount(s)}}));return(yield Promise.all(r)).filter((f,c,o)=>f!==null&&o.findIndex(s=>(s==null?void 0:s.addr)===(f==null?void 0:f.addr))===c)})}find(t){var e;return Et(this,void 0,void 0,function*(){if(t=t.trim(),!/^(.+)#[a-zA-Z0-9\-\_]{6}$/.test(t))return null;const r=(e=this.cache)===null||e===void 0?void 0:e.find(t);if(r!==void 0)return r;{const f=(yield this.ardb.search("transactions").tag("Protocol-Name",Nt.PROTOCOL_NAME).tag("handle",t.slice(0,-7)).limit(100).find()).map(l=>Et(this,void 0,void 0,function*(){var g;const k=l.id,C="owner"in l?l.owner.address:"anonymous",R=(yield this.arweave.api.get(k).catch(()=>({data:null}))).data;try{const B=this.data.decode(k,C,JSON.parse(R));return(g=this.cache)===null||g===void 0||g.hydrate(C,B),B}catch{return this.data.getDefaultAccount(C)}})),o=(yield Promise.all(f)).filter(l=>l!==void 0);return o.forEach(l=>{var g;(g=this.cache)===null||g===void 0||g.hydrate(l.addr,l)}),o.find(l=>l.handle.includes(t))||null}})}}var zn=ur.default=$n;export{Fn as A,zn as _,Wt as b,V as c,In as g,G as u,Ve as w};
