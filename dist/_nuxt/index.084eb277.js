var Or=Object.defineProperty;var Ur=(r,t,e)=>t in r?Or(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var P=(r,t,e)=>(Ur(r,typeof t!="symbol"?t+"":t,e),e);var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rr(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function zn(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var c=[null];c.push.apply(c,arguments);var l=Function.bind.apply(t,c);return new l}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var c=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,c.get?c:{enumerable:!0,get:function(){return r[n]}})}),e}var Qe={},Mt={},le={},Xt={},Nr={get exports(){return Xt},set exports(r){Xt=r}};(function(r){(function(t){var e,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,c=Math.ceil,l=Math.floor,o="[BigNumber Error] ",u=o+"Number primitive has more than 15 significant digits: ",s=1e14,h=14,g=9007199254740991,k=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],C=1e7,R=1e9;function $(v){var b,S,I,O=N.prototype={constructor:N,toString:null,valueOf:null},q=new N(1),H=20,F=4,tt=-7,rt=21,at=-1e7,st=1e7,lt=!1,bt=1,mt=0,ee={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},Et="0123456789abcdefghijklmnopqrstuvwxyz",re=!0;function N(a,i){var f,_,p,y,E,d,w,T,m=this;if(!(m instanceof N))return new N(a,i);if(i==null){if(a&&a._isBigNumber===!0){m.s=a.s,!a.c||a.e>st?m.c=m.e=null:a.e<at?m.c=[m.e=0]:(m.e=a.e,m.c=a.c.slice());return}if((d=typeof a=="number")&&a*0==0){if(m.s=1/a<0?(a=-a,-1):1,a===~~a){for(y=0,E=a;E>=10;E/=10,y++);y>st?m.c=m.e=null:(m.e=y,m.c=[a]);return}T=String(a)}else{if(!n.test(T=String(a)))return I(m,T,d);m.s=T.charCodeAt(0)==45?(T=T.slice(1),-1):1}(y=T.indexOf("."))>-1&&(T=T.replace(".","")),(E=T.search(/e/i))>0?(y<0&&(y=E),y+=+T.slice(E+1),T=T.substring(0,E)):y<0&&(y=T.length)}else{if(j(i,2,Et.length,"Base"),i==10&&re)return m=new N(a),ot(m,H+m.e+1,F);if(T=String(a),d=typeof a=="number"){if(a*0!=0)return I(m,T,d,i);if(m.s=1/a<0?(T=T.slice(1),-1):1,N.DEBUG&&T.replace(/^0\.0*|\./,"").length>15)throw Error(u+a)}else m.s=T.charCodeAt(0)===45?(T=T.slice(1),-1):1;for(f=Et.slice(0,i),y=E=0,w=T.length;E<w;E++)if(f.indexOf(_=T.charAt(E))<0){if(_=="."){if(E>y){y=w;continue}}else if(!p&&(T==T.toUpperCase()&&(T=T.toLowerCase())||T==T.toLowerCase()&&(T=T.toUpperCase()))){p=!0,E=-1,y=0;continue}return I(m,String(a),d,i)}d=!1,T=S(T,i,10,m.s),(y=T.indexOf("."))>-1?T=T.replace(".",""):y=T.length}for(E=0;T.charCodeAt(E)===48;E++);for(w=T.length;T.charCodeAt(--w)===48;);if(T=T.slice(E,++w)){if(w-=E,d&&N.DEBUG&&w>15&&(a>g||a!==l(a)))throw Error(u+m.s*a);if((y=y-E-1)>st)m.c=m.e=null;else if(y<at)m.c=[m.e=0];else{if(m.e=y,m.c=[],E=(y+1)%h,y<0&&(E+=h),E<w){for(E&&m.c.push(+T.slice(0,E)),w-=h;E<w;)m.c.push(+T.slice(E,E+=h));E=h-(T=T.slice(E)).length}else E-=w;for(;E--;T+="0");m.c.push(+T)}}else m.c=[m.e=0]}N.clone=$,N.ROUND_UP=0,N.ROUND_DOWN=1,N.ROUND_CEIL=2,N.ROUND_FLOOR=3,N.ROUND_HALF_UP=4,N.ROUND_HALF_DOWN=5,N.ROUND_HALF_EVEN=6,N.ROUND_HALF_CEIL=7,N.ROUND_HALF_FLOOR=8,N.EUCLID=9,N.config=N.set=function(a){var i,f;if(a!=null)if(typeof a=="object"){if(a.hasOwnProperty(i="DECIMAL_PLACES")&&(f=a[i],j(f,0,R,i),H=f),a.hasOwnProperty(i="ROUNDING_MODE")&&(f=a[i],j(f,0,8,i),F=f),a.hasOwnProperty(i="EXPONENTIAL_AT")&&(f=a[i],f&&f.pop?(j(f[0],-R,0,i),j(f[1],0,R,i),tt=f[0],rt=f[1]):(j(f,-R,R,i),tt=-(rt=f<0?-f:f))),a.hasOwnProperty(i="RANGE"))if(f=a[i],f&&f.pop)j(f[0],-R,-1,i),j(f[1],1,R,i),at=f[0],st=f[1];else if(j(f,-R,R,i),f)at=-(st=f<0?-f:f);else throw Error(o+i+" cannot be zero: "+f);if(a.hasOwnProperty(i="CRYPTO"))if(f=a[i],f===!!f)if(f)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))lt=f;else throw lt=!f,Error(o+"crypto unavailable");else lt=f;else throw Error(o+i+" not true or false: "+f);if(a.hasOwnProperty(i="MODULO_MODE")&&(f=a[i],j(f,0,9,i),bt=f),a.hasOwnProperty(i="POW_PRECISION")&&(f=a[i],j(f,0,R,i),mt=f),a.hasOwnProperty(i="FORMAT"))if(f=a[i],typeof f=="object")ee=f;else throw Error(o+i+" not an object: "+f);if(a.hasOwnProperty(i="ALPHABET"))if(f=a[i],typeof f=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(f))re=f.slice(0,10)=="0123456789",Et=f;else throw Error(o+i+" invalid: "+f)}else throw Error(o+"Object expected: "+a);return{DECIMAL_PLACES:H,ROUNDING_MODE:F,EXPONENTIAL_AT:[tt,rt],RANGE:[at,st],CRYPTO:lt,MODULO_MODE:bt,POW_PRECISION:mt,FORMAT:ee,ALPHABET:Et}},N.isBigNumber=function(a){if(!a||a._isBigNumber!==!0)return!1;if(!N.DEBUG)return!0;var i,f,_=a.c,p=a.e,y=a.s;t:if({}.toString.call(_)=="[object Array]"){if((y===1||y===-1)&&p>=-R&&p<=R&&p===l(p)){if(_[0]===0){if(p===0&&_.length===1)return!0;break t}if(i=(p+1)%h,i<1&&(i+=h),String(_[0]).length==i){for(i=0;i<_.length;i++)if(f=_[i],f<0||f>=s||f!==l(f))break t;if(f!==0)return!0}}}else if(_===null&&p===null&&(y===null||y===1||y===-1))return!0;throw Error(o+"Invalid BigNumber: "+a)},N.maximum=N.max=function(){return Ce(arguments,O.lt)},N.minimum=N.min=function(){return Ce(arguments,O.gt)},N.random=function(){var a=9007199254740992,i=Math.random()*a&2097151?function(){return l(Math.random()*a)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(f){var _,p,y,E,d,w=0,T=[],m=new N(q);if(f==null?f=H:j(f,0,R),E=c(f/h),lt)if(crypto.getRandomValues){for(_=crypto.getRandomValues(new Uint32Array(E*=2));w<E;)d=_[w]*131072+(_[w+1]>>>11),d>=9e15?(p=crypto.getRandomValues(new Uint32Array(2)),_[w]=p[0],_[w+1]=p[1]):(T.push(d%1e14),w+=2);w=E/2}else if(crypto.randomBytes){for(_=crypto.randomBytes(E*=7);w<E;)d=(_[w]&31)*281474976710656+_[w+1]*1099511627776+_[w+2]*4294967296+_[w+3]*16777216+(_[w+4]<<16)+(_[w+5]<<8)+_[w+6],d>=9e15?crypto.randomBytes(7).copy(_,w):(T.push(d%1e14),w+=7);w=E/7}else throw lt=!1,Error(o+"crypto unavailable");if(!lt)for(;w<E;)d=i(),d<9e15&&(T[w++]=d%1e14);for(E=T[--w],f%=h,E&&f&&(d=k[h-f],T[w]=l(E/d)*d);T[w]===0;T.pop(),w--);if(w<0)T=[y=0];else{for(y=-1;T[0]===0;T.splice(0,1),y-=h);for(w=1,d=T[0];d>=10;d/=10,w++);w<h&&(y-=h-w)}return m.e=y,m.c=T,m}}(),N.sum=function(){for(var a=1,i=arguments,f=new N(i[0]);a<i.length;)f=f.plus(i[a++]);return f},S=function(){var a="0123456789";function i(f,_,p,y){for(var E,d=[0],w,T=0,m=f.length;T<m;){for(w=d.length;w--;d[w]*=_);for(d[0]+=y.indexOf(f.charAt(T++)),E=0;E<d.length;E++)d[E]>p-1&&(d[E+1]==null&&(d[E+1]=0),d[E+1]+=d[E]/p|0,d[E]%=p)}return d.reverse()}return function(f,_,p,y,E){var d,w,T,m,U,x,D,W,Y=f.indexOf("."),et=H,z=F;for(Y>=0&&(m=mt,mt=0,f=f.replace(".",""),W=new N(_),x=W.pow(f.length-Y),mt=m,W.c=i(A(L(x.c),x.e,"0"),10,p,a),W.e=W.c.length),D=i(f,_,p,E?(d=Et,a):(d=a,Et)),T=m=D.length;D[--m]==0;D.pop());if(!D[0])return d.charAt(0);if(Y<0?--T:(x.c=D,x.e=T,x.s=y,x=b(x,W,et,z,p),D=x.c,U=x.r,T=x.e),w=T+et+1,Y=D[w],m=p/2,U=U||w<0||D[w+1]!=null,U=z<4?(Y!=null||U)&&(z==0||z==(x.s<0?3:2)):Y>m||Y==m&&(z==4||U||z==6&&D[w-1]&1||z==(x.s<0?8:7)),w<1||!D[0])f=U?A(d.charAt(1),-et,d.charAt(0)):d.charAt(0);else{if(D.length=w,U)for(--p;++D[--w]>p;)D[w]=0,w||(++T,D=[1].concat(D));for(m=D.length;!D[--m];);for(Y=0,f="";Y<=m;f+=d.charAt(D[Y++]));f=A(f,T,d.charAt(0))}return f}}(),b=function(){function a(_,p,y){var E,d,w,T,m=0,U=_.length,x=p%C,D=p/C|0;for(_=_.slice();U--;)w=_[U]%C,T=_[U]/C|0,E=D*w+T*x,d=x*w+E%C*C+m,m=(d/y|0)+(E/C|0)+D*T,_[U]=d%y;return m&&(_=[m].concat(_)),_}function i(_,p,y,E){var d,w;if(y!=E)w=y>E?1:-1;else for(d=w=0;d<y;d++)if(_[d]!=p[d]){w=_[d]>p[d]?1:-1;break}return w}function f(_,p,y,E){for(var d=0;y--;)_[y]-=d,d=_[y]<p[y]?1:0,_[y]=d*E+_[y]-p[y];for(;!_[0]&&_.length>1;_.splice(0,1));}return function(_,p,y,E,d){var w,T,m,U,x,D,W,Y,et,z,X,nt,Lt,se,ie,ft,Nt,ct=_.s==p.s?1:-1,it=_.c,Q=p.c;if(!it||!it[0]||!Q||!Q[0])return new N(!_.s||!p.s||(it?Q&&it[0]==Q[0]:!Q)?NaN:it&&it[0]==0||!Q?ct*0:ct/0);for(Y=new N(ct),et=Y.c=[],T=_.e-p.e,ct=y+T+1,d||(d=s,T=B(_.e/h)-B(p.e/h),ct=ct/h|0),m=0;Q[m]==(it[m]||0);m++);if(Q[m]>(it[m]||0)&&T--,ct<0)et.push(1),U=!0;else{for(se=it.length,ft=Q.length,m=0,ct+=2,x=l(d/(Q[0]+1)),x>1&&(Q=a(Q,x,d),it=a(it,x,d),ft=Q.length,se=it.length),Lt=ft,z=it.slice(0,ft),X=z.length;X<ft;z[X++]=0);Nt=Q.slice(),Nt=[0].concat(Nt),ie=Q[0],Q[1]>=d/2&&ie++;do{if(x=0,w=i(Q,z,ft,X),w<0){if(nt=z[0],ft!=X&&(nt=nt*d+(z[1]||0)),x=l(nt/ie),x>1)for(x>=d&&(x=d-1),D=a(Q,x,d),W=D.length,X=z.length;i(D,z,W,X)==1;)x--,f(D,ft<W?Nt:Q,W,d),W=D.length,w=1;else x==0&&(w=x=1),D=Q.slice(),W=D.length;if(W<X&&(D=[0].concat(D)),f(z,D,X,d),X=z.length,w==-1)for(;i(Q,z,ft,X)<1;)x++,f(z,ft<X?Nt:Q,X,d),X=z.length}else w===0&&(x++,z=[0]);et[m++]=x,z[0]?z[X++]=it[Lt]||0:(z=[it[Lt]],X=1)}while((Lt++<se||z[0]!=null)&&ct--);U=z[0]!=null,et[0]||et.splice(0,1)}if(d==s){for(m=1,ct=et[0];ct>=10;ct/=10,m++);ot(Y,y+(Y.e=m+T*h-1)+1,E,U)}else Y.e=T,Y.r=+U;return Y}}();function ne(a,i,f,_){var p,y,E,d,w;if(f==null?f=F:j(f,0,8),!a.c)return a.toString();if(p=a.c[0],E=a.e,i==null)w=L(a.c),w=_==1||_==2&&(E<=tt||E>=rt)?Z(w,E):A(w,E,"0");else if(a=ot(new N(a),i,f),y=a.e,w=L(a.c),d=w.length,_==1||_==2&&(i<=y||y<=tt)){for(;d<i;w+="0",d++);w=Z(w,y)}else if(i-=E,w=A(w,y,"0"),y+1>d){if(--i>0)for(w+=".";i--;w+="0");}else if(i+=y-d,i>0)for(y+1==d&&(w+=".");i--;w+="0");return a.s<0&&p?"-"+w:w}function Ce(a,i){for(var f,_=1,p=new N(a[0]);_<a.length;_++)if(f=new N(a[_]),f.s)i.call(p,f)&&(p=f);else{p=f;break}return p}function ae(a,i,f){for(var _=1,p=i.length;!i[--p];i.pop());for(p=i[0];p>=10;p/=10,_++);return(f=_+f*h-1)>st?a.c=a.e=null:f<at?a.c=[a.e=0]:(a.e=f,a.c=i),a}I=function(){var a=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,f=/^\.([^.]+)$/,_=/^-?(Infinity|NaN)$/,p=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(y,E,d,w){var T,m=d?E:E.replace(p,"");if(_.test(m))y.s=isNaN(m)?null:m<0?-1:1;else{if(!d&&(m=m.replace(a,function(U,x,D){return T=(D=D.toLowerCase())=="x"?16:D=="b"?2:8,!w||w==T?x:U}),w&&(T=w,m=m.replace(i,"$1").replace(f,"0.$1")),E!=m))return new N(m,T);if(N.DEBUG)throw Error(o+"Not a"+(w?" base "+w:"")+" number: "+E);y.s=null}y.c=y.e=null}}();function ot(a,i,f,_){var p,y,E,d,w,T,m,U=a.c,x=k;if(U){t:{for(p=1,d=U[0];d>=10;d/=10,p++);if(y=i-p,y<0)y+=h,E=i,w=U[T=0],m=w/x[p-E-1]%10|0;else if(T=c((y+1)/h),T>=U.length)if(_){for(;U.length<=T;U.push(0));w=m=0,p=1,y%=h,E=y-h+1}else break t;else{for(w=d=U[T],p=1;d>=10;d/=10,p++);y%=h,E=y-h+p,m=E<0?0:w/x[p-E-1]%10|0}if(_=_||i<0||U[T+1]!=null||(E<0?w:w%x[p-E-1]),_=f<4?(m||_)&&(f==0||f==(a.s<0?3:2)):m>5||m==5&&(f==4||_||f==6&&(y>0?E>0?w/x[p-E]:0:U[T-1])%10&1||f==(a.s<0?8:7)),i<1||!U[0])return U.length=0,_?(i-=a.e+1,U[0]=x[(h-i%h)%h],a.e=-i||0):U[0]=a.e=0,a;if(y==0?(U.length=T,d=1,T--):(U.length=T+1,d=x[h-y],U[T]=E>0?l(w/x[p-E]%x[E])*d:0),_)for(;;)if(T==0){for(y=1,E=U[0];E>=10;E/=10,y++);for(E=U[0]+=d,d=1;E>=10;E/=10,d++);y!=d&&(a.e++,U[0]==s&&(U[0]=1));break}else{if(U[T]+=d,U[T]!=s)break;U[T--]=0,d=1}for(y=U.length;U[--y]===0;U.pop());}a.e>st?a.c=a.e=null:a.e<at&&(a.c=[a.e=0])}return a}function gt(a){var i,f=a.e;return f===null?a.toString():(i=L(a.c),i=f<=tt||f>=rt?Z(i,f):A(i,f,"0"),a.s<0?"-"+i:i)}return O.absoluteValue=O.abs=function(){var a=new N(this);return a.s<0&&(a.s=1),a},O.comparedTo=function(a,i){return K(this,new N(a,i))},O.decimalPlaces=O.dp=function(a,i){var f,_,p,y=this;if(a!=null)return j(a,0,R),i==null?i=F:j(i,0,8),ot(new N(y),a+y.e+1,i);if(!(f=y.c))return null;if(_=((p=f.length-1)-B(this.e/h))*h,p=f[p])for(;p%10==0;p/=10,_--);return _<0&&(_=0),_},O.dividedBy=O.div=function(a,i){return b(this,new N(a,i),H,F)},O.dividedToIntegerBy=O.idiv=function(a,i){return b(this,new N(a,i),0,1)},O.exponentiatedBy=O.pow=function(a,i){var f,_,p,y,E,d,w,T,m,U=this;if(a=new N(a),a.c&&!a.isInteger())throw Error(o+"Exponent not an integer: "+gt(a));if(i!=null&&(i=new N(i)),d=a.e>14,!U.c||!U.c[0]||U.c[0]==1&&!U.e&&U.c.length==1||!a.c||!a.c[0])return m=new N(Math.pow(+gt(U),d?a.s*(2-M(a)):+gt(a))),i?m.mod(i):m;if(w=a.s<0,i){if(i.c?!i.c[0]:!i.s)return new N(NaN);_=!w&&U.isInteger()&&i.isInteger(),_&&(U=U.mod(i))}else{if(a.e>9&&(U.e>0||U.e<-1||(U.e==0?U.c[0]>1||d&&U.c[1]>=24e7:U.c[0]<8e13||d&&U.c[0]<=9999975e7)))return y=U.s<0&&M(a)?-0:0,U.e>-1&&(y=1/y),new N(w?1/y:y);mt&&(y=c(mt/h+2))}for(d?(f=new N(.5),w&&(a.s=1),T=M(a)):(p=Math.abs(+gt(a)),T=p%2),m=new N(q);;){if(T){if(m=m.times(U),!m.c)break;y?m.c.length>y&&(m.c.length=y):_&&(m=m.mod(i))}if(p){if(p=l(p/2),p===0)break;T=p%2}else if(a=a.times(f),ot(a,a.e+1,1),a.e>14)T=M(a);else{if(p=+gt(a),p===0)break;T=p%2}U=U.times(U),y?U.c&&U.c.length>y&&(U.c.length=y):_&&(U=U.mod(i))}return _?m:(w&&(m=q.div(m)),i?m.mod(i):y?ot(m,mt,F,E):m)},O.integerValue=function(a){var i=new N(this);return a==null?a=F:j(a,0,8),ot(i,i.e+1,a)},O.isEqualTo=O.eq=function(a,i){return K(this,new N(a,i))===0},O.isFinite=function(){return!!this.c},O.isGreaterThan=O.gt=function(a,i){return K(this,new N(a,i))>0},O.isGreaterThanOrEqualTo=O.gte=function(a,i){return(i=K(this,new N(a,i)))===1||i===0},O.isInteger=function(){return!!this.c&&B(this.e/h)>this.c.length-2},O.isLessThan=O.lt=function(a,i){return K(this,new N(a,i))<0},O.isLessThanOrEqualTo=O.lte=function(a,i){return(i=K(this,new N(a,i)))===-1||i===0},O.isNaN=function(){return!this.s},O.isNegative=function(){return this.s<0},O.isPositive=function(){return this.s>0},O.isZero=function(){return!!this.c&&this.c[0]==0},O.minus=function(a,i){var f,_,p,y,E=this,d=E.s;if(a=new N(a,i),i=a.s,!d||!i)return new N(NaN);if(d!=i)return a.s=-i,E.plus(a);var w=E.e/h,T=a.e/h,m=E.c,U=a.c;if(!w||!T){if(!m||!U)return m?(a.s=-i,a):new N(U?E:NaN);if(!m[0]||!U[0])return U[0]?(a.s=-i,a):new N(m[0]?E:F==3?-0:0)}if(w=B(w),T=B(T),m=m.slice(),d=w-T){for((y=d<0)?(d=-d,p=m):(T=w,p=U),p.reverse(),i=d;i--;p.push(0));p.reverse()}else for(_=(y=(d=m.length)<(i=U.length))?d:i,d=i=0;i<_;i++)if(m[i]!=U[i]){y=m[i]<U[i];break}if(y&&(p=m,m=U,U=p,a.s=-a.s),i=(_=U.length)-(f=m.length),i>0)for(;i--;m[f++]=0);for(i=s-1;_>d;){if(m[--_]<U[_]){for(f=_;f&&!m[--f];m[f]=i);--m[f],m[_]+=s}m[_]-=U[_]}for(;m[0]==0;m.splice(0,1),--T);return m[0]?ae(a,m,T):(a.s=F==3?-1:1,a.c=[a.e=0],a)},O.modulo=O.mod=function(a,i){var f,_,p=this;return a=new N(a,i),!p.c||!a.s||a.c&&!a.c[0]?new N(NaN):!a.c||p.c&&!p.c[0]?new N(p):(bt==9?(_=a.s,a.s=1,f=b(p,a,0,3),a.s=_,f.s*=_):f=b(p,a,0,bt),a=p.minus(f.times(a)),!a.c[0]&&bt==1&&(a.s=p.s),a)},O.multipliedBy=O.times=function(a,i){var f,_,p,y,E,d,w,T,m,U,x,D,W,Y,et,z=this,X=z.c,nt=(a=new N(a,i)).c;if(!X||!nt||!X[0]||!nt[0])return!z.s||!a.s||X&&!X[0]&&!nt||nt&&!nt[0]&&!X?a.c=a.e=a.s=null:(a.s*=z.s,!X||!nt?a.c=a.e=null:(a.c=[0],a.e=0)),a;for(_=B(z.e/h)+B(a.e/h),a.s*=z.s,w=X.length,U=nt.length,w<U&&(W=X,X=nt,nt=W,p=w,w=U,U=p),p=w+U,W=[];p--;W.push(0));for(Y=s,et=C,p=U;--p>=0;){for(f=0,x=nt[p]%et,D=nt[p]/et|0,E=w,y=p+E;y>p;)T=X[--E]%et,m=X[E]/et|0,d=D*T+m*x,T=x*T+d%et*et+W[y]+f,f=(T/Y|0)+(d/et|0)+D*m,W[y--]=T%Y;W[y]=f}return f?++_:W.splice(0,1),ae(a,W,_)},O.negated=function(){var a=new N(this);return a.s=-a.s||null,a},O.plus=function(a,i){var f,_=this,p=_.s;if(a=new N(a,i),i=a.s,!p||!i)return new N(NaN);if(p!=i)return a.s=-i,_.minus(a);var y=_.e/h,E=a.e/h,d=_.c,w=a.c;if(!y||!E){if(!d||!w)return new N(p/0);if(!d[0]||!w[0])return w[0]?a:new N(d[0]?_:p*0)}if(y=B(y),E=B(E),d=d.slice(),p=y-E){for(p>0?(E=y,f=w):(p=-p,f=d),f.reverse();p--;f.push(0));f.reverse()}for(p=d.length,i=w.length,p-i<0&&(f=w,w=d,d=f,i=p),p=0;i;)p=(d[--i]=d[i]+w[i]+p)/s|0,d[i]=s===d[i]?0:d[i]%s;return p&&(d=[p].concat(d),++E),ae(a,d,E)},O.precision=O.sd=function(a,i){var f,_,p,y=this;if(a!=null&&a!==!!a)return j(a,1,R),i==null?i=F:j(i,0,8),ot(new N(y),a,i);if(!(f=y.c))return null;if(p=f.length-1,_=p*h+1,p=f[p]){for(;p%10==0;p/=10,_--);for(p=f[0];p>=10;p/=10,_++);}return a&&y.e+1>_&&(_=y.e+1),_},O.shiftedBy=function(a){return j(a,-g,g),this.times("1e"+a)},O.squareRoot=O.sqrt=function(){var a,i,f,_,p,y=this,E=y.c,d=y.s,w=y.e,T=H+4,m=new N("0.5");if(d!==1||!E||!E[0])return new N(!d||d<0&&(!E||E[0])?NaN:E?y:1/0);if(d=Math.sqrt(+gt(y)),d==0||d==1/0?(i=L(E),(i.length+w)%2==0&&(i+="0"),d=Math.sqrt(+i),w=B((w+1)/2)-(w<0||w%2),d==1/0?i="5e"+w:(i=d.toExponential(),i=i.slice(0,i.indexOf("e")+1)+w),f=new N(i)):f=new N(d+""),f.c[0]){for(w=f.e,d=w+T,d<3&&(d=0);;)if(p=f,f=m.times(p.plus(b(y,p,T,1))),L(p.c).slice(0,d)===(i=L(f.c)).slice(0,d))if(f.e<w&&--d,i=i.slice(d-3,d+1),i=="9999"||!_&&i=="4999"){if(!_&&(ot(p,p.e+H+2,0),p.times(p).eq(y))){f=p;break}T+=4,d+=4,_=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(ot(f,f.e+H+2,1),a=!f.times(f).eq(y));break}}return ot(f,f.e+H+1,F,a)},O.toExponential=function(a,i){return a!=null&&(j(a,0,R),a++),ne(this,a,i,1)},O.toFixed=function(a,i){return a!=null&&(j(a,0,R),a=a+this.e+1),ne(this,a,i)},O.toFormat=function(a,i,f){var _,p=this;if(f==null)a!=null&&i&&typeof i=="object"?(f=i,i=null):a&&typeof a=="object"?(f=a,a=i=null):f=ee;else if(typeof f!="object")throw Error(o+"Argument not an object: "+f);if(_=p.toFixed(a,i),p.c){var y,E=_.split("."),d=+f.groupSize,w=+f.secondaryGroupSize,T=f.groupSeparator||"",m=E[0],U=E[1],x=p.s<0,D=x?m.slice(1):m,W=D.length;if(w&&(y=d,d=w,w=y,W-=y),d>0&&W>0){for(y=W%d||d,m=D.substr(0,y);y<W;y+=d)m+=T+D.substr(y,d);w>0&&(m+=T+D.slice(y)),x&&(m="-"+m)}_=U?m+(f.decimalSeparator||"")+((w=+f.fractionGroupSize)?U.replace(new RegExp("\\d{"+w+"}\\B","g"),"$&"+(f.fractionGroupSeparator||"")):U):m}return(f.prefix||"")+_+(f.suffix||"")},O.toFraction=function(a){var i,f,_,p,y,E,d,w,T,m,U,x,D=this,W=D.c;if(a!=null&&(d=new N(a),!d.isInteger()&&(d.c||d.s!==1)||d.lt(q)))throw Error(o+"Argument "+(d.isInteger()?"out of range: ":"not an integer: ")+gt(d));if(!W)return new N(D);for(i=new N(q),T=f=new N(q),_=w=new N(q),x=L(W),y=i.e=x.length-D.e-1,i.c[0]=k[(E=y%h)<0?h+E:E],a=!a||d.comparedTo(i)>0?y>0?i:T:d,E=st,st=1/0,d=new N(x),w.c[0]=0;m=b(d,i,0,1),p=f.plus(m.times(_)),p.comparedTo(a)!=1;)f=_,_=p,T=w.plus(m.times(p=T)),w=p,i=d.minus(m.times(p=i)),d=p;return p=b(a.minus(f),_,0,1),w=w.plus(p.times(T)),f=f.plus(p.times(_)),w.s=T.s=D.s,y=y*2,U=b(T,_,y,F).minus(D).abs().comparedTo(b(w,f,y,F).minus(D).abs())<1?[T,_]:[w,f],st=E,U},O.toNumber=function(){return+gt(this)},O.toPrecision=function(a,i){return a!=null&&j(a,1,R),ne(this,a,i,2)},O.toString=function(a){var i,f=this,_=f.s,p=f.e;return p===null?_?(i="Infinity",_<0&&(i="-"+i)):i="NaN":(a==null?i=p<=tt||p>=rt?Z(L(f.c),p):A(L(f.c),p,"0"):a===10&&re?(f=ot(new N(f),H+p+1,F),i=A(L(f.c),f.e,"0")):(j(a,2,Et.length,"Base"),i=S(A(L(f.c),p,"0"),10,a,_,!0)),_<0&&f.c[0]&&(i="-"+i)),i},O.valueOf=O.toJSON=function(){return gt(this)},O._isBigNumber=!0,v!=null&&N.set(v),N}function B(v){var b=v|0;return v>0||v===b?b:b-1}function L(v){for(var b,S,I=1,O=v.length,q=v[0]+"";I<O;){for(b=v[I++]+"",S=h-b.length;S--;b="0"+b);q+=b}for(O=q.length;q.charCodeAt(--O)===48;);return q.slice(0,O+1||1)}function K(v,b){var S,I,O=v.c,q=b.c,H=v.s,F=b.s,tt=v.e,rt=b.e;if(!H||!F)return null;if(S=O&&!O[0],I=q&&!q[0],S||I)return S?I?0:-F:H;if(H!=F)return H;if(S=H<0,I=tt==rt,!O||!q)return I?0:!O^S?1:-1;if(!I)return tt>rt^S?1:-1;for(F=(tt=O.length)<(rt=q.length)?tt:rt,H=0;H<F;H++)if(O[H]!=q[H])return O[H]>q[H]^S?1:-1;return tt==rt?0:tt>rt^S?1:-1}function j(v,b,S,I){if(v<b||v>S||v!==l(v))throw Error(o+(I||"Argument")+(typeof v=="number"?v<b||v>S?" out of range: ":" not an integer: ":" not a primitive number: ")+String(v))}function M(v){var b=v.c.length-1;return B(v.e/h)==b&&v.c[b]%2!=0}function Z(v,b){return(v.length>1?v.charAt(0)+"."+v.slice(1):v)+(b<0?"e":"e+")+b}function A(v,b,S){var I,O;if(b<0){for(O=S+".";++b;O+=S);v=O+v}else if(I=v.length,++b>I){for(O=S,b-=I;--b;O+=S);v+=O}else b<I&&(v=v.slice(0,b)+"."+v.slice(b));return v}e=$(),e.default=e.BigNumber=e,r.exports?r.exports=e:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=e)})(V)})(Nr);Object.defineProperty(le,"__esModule",{value:!0});const Br=Xt;let $r=class{constructor(){this.BigNum=(t,e)=>{let n=Br.BigNumber.clone({DECIMAL_PLACES:e});return new n(t)}}winstonToAr(t,{formatted:e=!1,decimals:n=12,trim:c=!0}={}){let l=this.stringToBigNum(t,n).shiftedBy(-12);return e?l.toFormat(n):l.toFixed(n)}arToWinston(t,{formatted:e=!1}={}){let n=this.stringToBigNum(t).shiftedBy(12);return e?n.toFormat():n.toFixed(0)}compare(t,e){let n=this.stringToBigNum(t),c=this.stringToBigNum(e);return n.comparedTo(c)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let n=this.stringToBigNum(t),c=this.stringToBigNum(e);return n.isLessThan(c)}isGreaterThan(t,e){let n=this.stringToBigNum(t),c=this.stringToBigNum(e);return n.isGreaterThan(c)}add(t,e){let n=this.stringToBigNum(t);return this.stringToBigNum(e),n.plus(e).toFixed(0)}sub(t,e){let n=this.stringToBigNum(t);return this.stringToBigNum(e),n.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}};le.default=$r;var he={};Object.defineProperty(he,"__esModule",{value:!0});let Cr=class{constructor(t){this.METHOD_GET="GET",this.METHOD_POST="POST",this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){const e=t.protocol||"http",n=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:n,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,Object.assign(Object.assign({},e),{method:this.METHOD_GET}))}async post(t,e,n){var c;const l=new Headers((n==null?void 0:n.headers)||{});return!((c=l.get("content-type"))===null||c===void 0)&&c.includes("application/json")||l.append("content-type","application/json"),l.append("accept","application/json, text/plain, */*"),await this.request(t,Object.assign(Object.assign({},n),{method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:l}))}async request(t,e){const n=new Headers((e==null?void 0:e.headers)||{}),c=`${this.config.protocol}://${this.config.host}:${this.config.port}`;t.startsWith("/")&&(t=t.slice(1)),this.config.network&&n.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${c}/${t}`);let l=await fetch(`${c}/${t}`,Object.assign(Object.assign({},e||{}),{headers:n}));this.config.logging&&this.config.logger(`Response:   ${l.url} - ${l.status}`);const o=l.headers.get("content-type"),u=l;if(o!=null&&o.startsWith("application/json"))u.data=await l.clone().json();else try{u.data=await l.clone().text()}catch{u.data=await l.clone().arrayBuffer()}return u}};he.default=Cr;var fe={},G={},It={};It.byteLength=xr;It.toByteArray=Lr;It.fromByteArray=jr;var dt=[],ut=[],Ir=typeof Uint8Array<"u"?Uint8Array:Array,oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ot=0,Pr=oe.length;Ot<Pr;++Ot)dt[Ot]=oe[Ot],ut[oe.charCodeAt(Ot)]=Ot;ut["-".charCodeAt(0)]=62;ut["_".charCodeAt(0)]=63;function tr(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=r.indexOf("=");e===-1&&(e=t);var n=e===t?0:4-e%4;return[e,n]}function xr(r){var t=tr(r),e=t[0],n=t[1];return(e+n)*3/4-n}function Dr(r,t,e){return(t+e)*3/4-e}function Lr(r){var t,e=tr(r),n=e[0],c=e[1],l=new Ir(Dr(r,n,c)),o=0,u=c>0?n-4:n,s;for(s=0;s<u;s+=4)t=ut[r.charCodeAt(s)]<<18|ut[r.charCodeAt(s+1)]<<12|ut[r.charCodeAt(s+2)]<<6|ut[r.charCodeAt(s+3)],l[o++]=t>>16&255,l[o++]=t>>8&255,l[o++]=t&255;return c===2&&(t=ut[r.charCodeAt(s)]<<2|ut[r.charCodeAt(s+1)]>>4,l[o++]=t&255),c===1&&(t=ut[r.charCodeAt(s)]<<10|ut[r.charCodeAt(s+1)]<<4|ut[r.charCodeAt(s+2)]>>2,l[o++]=t>>8&255,l[o++]=t&255),l}function Mr(r){return dt[r>>18&63]+dt[r>>12&63]+dt[r>>6&63]+dt[r&63]}function qr(r,t,e){for(var n,c=[],l=t;l<e;l+=3)n=(r[l]<<16&16711680)+(r[l+1]<<8&65280)+(r[l+2]&255),c.push(Mr(n));return c.join("")}function jr(r){for(var t,e=r.length,n=e%3,c=[],l=16383,o=0,u=e-n;o<u;o+=l)c.push(qr(r,o,o+l>u?u:o+l));return n===1?(t=r[e-1],c.push(dt[t>>2]+dt[t<<4&63]+"==")):n===2&&(t=(r[e-2]<<8)+r[e-1],c.push(dt[t>>10]+dt[t>>4&63]+dt[t<<2&63]+"=")),c.join("")}Object.defineProperty(G,"__esModule",{value:!0});G.b64UrlDecode=G.b64UrlEncode=G.bufferTob64Url=G.bufferTob64=G.b64UrlToBuffer=G.stringToB64Url=G.stringToBuffer=G.bufferToString=G.b64UrlToString=G.concatBuffers=void 0;const er=It;function Hr(r){let t=0;for(let c=0;c<r.length;c++)t+=r[c].byteLength;let e=new Uint8Array(t),n=0;e.set(new Uint8Array(r[0]),n),n+=r[0].byteLength;for(let c=1;c<r.length;c++)e.set(new Uint8Array(r[c]),n),n+=r[c].byteLength;return e}G.concatBuffers=Hr;function Kr(r){let t=ar(r);return rr(t)}G.b64UrlToString=Kr;function rr(r){return new TextDecoder("utf-8",{fatal:!0}).decode(r)}G.bufferToString=rr;function nr(r){return new TextEncoder().encode(r)}G.stringToBuffer=nr;function Fr(r){return ir(nr(r))}G.stringToB64Url=Fr;function ar(r){return new Uint8Array(er.toByteArray(cr(r)))}G.b64UrlToBuffer=ar;function sr(r){return er.fromByteArray(new Uint8Array(r))}G.bufferTob64=sr;function ir(r){return or(sr(r))}G.bufferTob64Url=ir;function or(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}G.b64UrlEncode=or;function cr(r){r=r.replace(/\-/g,"+").replace(/\_/g,"/");let t;return r.length%4==0?t=0:t=4-r.length%4,r.concat("=".repeat(t))}G.b64UrlDecode=cr;Object.defineProperty(fe,"__esModule",{value:!0});const vt=G;let zr=class{constructor(){if(this.keyLength=4096,this.publicExponent=65537,this.hashAlgorithm="sha256",!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:n}={}){let c=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(c)}async hash(t,e="SHA-256"){let n=await this.driver.digest(e,t);return new Uint8Array(n)}async verify(t,e,n){const c={kty:"RSA",e:"AQAB",n:t},l=await this.jwkToPublicCryptoKey(c),o=await this.driver.digest("SHA-256",e),u=await this.driver.verify({name:"RSA-PSS",saltLength:0},l,n,e),s=await this.driver.verify({name:"RSA-PSS",saltLength:32},l,n,e),h=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((l.algorithm.modulusLength-1)/8)-o.byteLength-2},l,n,e);return u||s||h}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;const t=crypto==null?void 0:crypto.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(n=>typeof t[n]=="function")}async encrypt(t,e,n){const c=await this.driver.importKey("raw",typeof e=="string"?vt.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),l=await this.driver.deriveKey({name:"PBKDF2",salt:n?vt.stringToBuffer(n):vt.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},c,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=new Uint8Array(16);crypto.getRandomValues(o);const u=await this.driver.encrypt({name:"AES-CBC",iv:o},l,t);return vt.concatBuffers([o,u])}async decrypt(t,e,n){const c=await this.driver.importKey("raw",typeof e=="string"?vt.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),l=await this.driver.deriveKey({name:"PBKDF2",salt:n?vt.stringToBuffer(n):vt.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},c,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=t.slice(0,16),u=await this.driver.decrypt({name:"AES-CBC",iv:o},l,t.slice(16));return vt.concatBuffers([u])}};fe.default=zr;var de={};Object.defineProperty(de,"__esModule",{value:!0});let Wr=class{constructor(t){this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}};de.default=Wr;var qt={},Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.getError=void 0;let Gr=class extends Error{constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.response=e.response}getType(){return this.type}};Tt.default=Gr;function Jr(r){let t=r.data;if(typeof r.data=="string")try{t=JSON.parse(r.data)}catch{}if(r.data instanceof ArrayBuffer||r.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:r.statusText||"unknown"}Tt.getError=Jr;var Ut={},jt={},Ie;function Xr(){if(Ie)return jt;Ie=1,Object.defineProperty(jt,"__esModule",{value:!0});const r=Vt();async function t(n){if(Array.isArray(n)){const o=r.default.utils.concatBuffers([r.default.utils.stringToBuffer("list"),r.default.utils.stringToBuffer(n.length.toString())]);return await e(n,await r.default.crypto.hash(o,"SHA-384"))}const c=r.default.utils.concatBuffers([r.default.utils.stringToBuffer("blob"),r.default.utils.stringToBuffer(n.byteLength.toString())]),l=r.default.utils.concatBuffers([await r.default.crypto.hash(c,"SHA-384"),await r.default.crypto.hash(n,"SHA-384")]);return await r.default.crypto.hash(l,"SHA-384")}jt.default=t;async function e(n,c){if(n.length<1)return c;const l=r.default.utils.concatBuffers([c,await t(n[0])]),o=await r.default.crypto.hash(l,"SHA-384");return await e(n.slice(1),o)}return jt}var ce={},Pe;function ur(){return Pe||(Pe=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.debug=r.validatePath=r.arrayCompare=r.bufferToInt=r.intToBuffer=r.arrayFlatten=r.generateProofs=r.buildLayers=r.generateTransactionChunks=r.generateTree=r.computeRootHash=r.generateLeaves=r.chunkData=r.MIN_CHUNK_SIZE=r.MAX_CHUNK_SIZE=void 0;const t=Vt(),e=G;r.MAX_CHUNK_SIZE=256*1024,r.MIN_CHUNK_SIZE=32*1024;const n=32,c=32;async function l(A){let v=[],b=A,S=0;for(;b.byteLength>=r.MAX_CHUNK_SIZE;){let I=r.MAX_CHUNK_SIZE,O=b.byteLength-r.MAX_CHUNK_SIZE;O>0&&O<r.MIN_CHUNK_SIZE&&(I=Math.ceil(b.byteLength/2));const q=b.slice(0,I),H=await t.default.crypto.hash(q);S+=q.byteLength,v.push({dataHash:H,minByteRange:S-q.byteLength,maxByteRange:S}),b=b.slice(I)}return v.push({dataHash:await t.default.crypto.hash(b),minByteRange:S,maxByteRange:S+b.byteLength}),v}r.chunkData=l;async function o(A){return Promise.all(A.map(async({dataHash:v,minByteRange:b,maxByteRange:S})=>({type:"leaf",id:await B(await Promise.all([B(v),B(L(S))])),dataHash:v,minByteRange:b,maxByteRange:S})))}r.generateLeaves=o;async function u(A){return(await s(A)).id}r.computeRootHash=u;async function s(A){return await g(await o(await l(A)))}r.generateTree=s;async function h(A){const v=await l(A),b=await o(v),S=await g(b),I=await k(S),O=v.slice(-1)[0];return O.maxByteRange-O.minByteRange===0&&(v.splice(v.length-1,1),I.splice(I.length-1,1)),{data_root:S.id,chunks:v,proofs:I}}r.generateTransactionChunks=h;async function g(A,v=0){if(A.length<2)return A[0];const b=[];for(let S=0;S<A.length;S+=2)b.push(await $(A[S],A[S+1]));return g(b,v+1)}r.buildLayers=g;function k(A){const v=C(A);return Array.isArray(v)?R(v):[v]}r.generateProofs=k;function C(A,v=new Uint8Array,b=0){if(A.type=="leaf")return{offset:A.maxByteRange-1,proof:(0,e.concatBuffers)([v,A.dataHash,L(A.maxByteRange)])};if(A.type=="branch"){const S=(0,e.concatBuffers)([v,A.leftChild.id,A.rightChild.id,L(A.byteRange)]);return[C(A.leftChild,S,b+1),C(A.rightChild,S,b+1)]}throw new Error("Unexpected node type")}function R(A){const v=[];return A.forEach(b=>{Array.isArray(b)?v.push(...R(b)):v.push(b)}),v}r.arrayFlatten=R;async function $(A,v){return v?{type:"branch",id:await B([await B(A.id),await B(v.id),await B(L(A.maxByteRange))]),byteRange:A.maxByteRange,maxByteRange:v.maxByteRange,leftChild:A,rightChild:v}:A}async function B(A){return Array.isArray(A)&&(A=t.default.utils.concatBuffers(A)),new Uint8Array(await t.default.crypto.hash(A))}function L(A){const v=new Uint8Array(n);for(var b=v.length-1;b>=0;b--){var S=A%256;v[b]=S,A=(A-S)/256}return v}r.intToBuffer=L;function K(A){let v=0;for(var b=0;b<A.length;b++)v*=256,v+=A[b];return v}r.bufferToInt=K;const j=(A,v)=>A.every((b,S)=>v[S]===b);r.arrayCompare=j;async function M(A,v,b,S,I){if(S<=0)return!1;if(v>=S)return M(A,0,S-1,S,I);if(v<0)return M(A,0,0,S,I);if(I.length==c+n){const at=I.slice(0,c),st=I.slice(at.length,at.length+n),lt=await B([await B(at),await B(st)]);return(0,r.arrayCompare)(A,lt)?{offset:S-1,leftBound:b,rightBound:S,chunkSize:S-b}:!1}const O=I.slice(0,c),q=I.slice(O.length,O.length+c),H=I.slice(O.length+q.length,O.length+q.length+n),F=K(H),tt=I.slice(O.length+q.length+H.length),rt=await B([await B(O),await B(q),await B(H)]);return(0,r.arrayCompare)(A,rt)?v<F?await M(O,v,b,Math.min(S,F),tt):await M(q,v,Math.max(b,F),S,tt):!1}r.validatePath=M;async function Z(A,v=""){if(A.byteLength<1)return v;const b=A.slice(0,c),S=A.slice(b.length,b.length+c),I=A.slice(b.length+S.length,b.length+S.length+n),O=K(I),q=A.slice(b.length+S.length+I.length),H=await B([await B(b),await B(S),await B(I)]),F=`${v}
${JSON.stringify(Buffer.from(b))},${JSON.stringify(Buffer.from(S))},${O} => ${JSON.stringify(H)}`;return Z(q,F)}r.debug=Z}(ce)),ce}var xe;function ge(){if(xe)return Ut;xe=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Tag=void 0;const r=G,t=Xr(),e=ur();class n{get(u,s){if(!Object.getOwnPropertyNames(this).includes(u))throw new Error(`Field "${u}" is not a property of the Arweave Transaction class.`);return this[u]instanceof Uint8Array?s&&s.decode&&s.string?r.bufferToString(this[u]):s&&s.decode&&!s.string?this[u]:r.bufferTob64Url(this[u]):s&&s.decode==!0?s&&s.string?r.b64UrlToString(this[u]):r.b64UrlToBuffer(this[u]):this[u]}}class c extends n{constructor(u,s,h=!1){super(),this.name=u,this.value=s}}Ut.Tag=c;class l extends n{constructor(u={}){super(),this.format=2,this.id="",this.last_tx="",this.owner="",this.tags=[],this.target="",this.quantity="0",this.data_size="0",this.data=new Uint8Array,this.data_root="",this.reward="0",this.signature="",Object.assign(this,u),typeof this.data=="string"&&(this.data=r.b64UrlToBuffer(this.data)),u.tags&&(this.tags=u.tags.map(s=>new c(s.name,s.value)))}addTag(u,s){this.tags.push(new c(r.stringToB64Url(u),r.stringToB64Url(s)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:r.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(u){this.owner=u}setSignature({id:u,owner:s,reward:h,tags:g,signature:k}){this.id=u,this.owner=s,h&&(this.reward=h),g&&(this.tags=g),this.signature=k}async prepareChunks(u){!this.chunks&&u.byteLength>0&&(this.chunks=await(0,e.generateTransactionChunks)(u),this.data_root=r.bufferTob64Url(this.chunks.data_root)),!this.chunks&&u.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(u,s){if(!this.chunks)throw new Error("Chunks have not been prepared");const h=this.chunks.proofs[u],g=this.chunks.chunks[u];return{data_root:this.data_root,data_size:this.data_size,data_path:r.bufferTob64Url(h.proof),offset:h.offset.toString(),chunk:r.bufferTob64Url(s.slice(g.minByteRange,g.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let u=this.tags.reduce((h,g)=>r.concatBuffers([h,g.get("name",{decode:!0,string:!1}),g.get("value",{decode:!0,string:!1})]),new Uint8Array);return r.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),r.stringToBuffer(this.quantity),r.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),u]);case 2:this.data_root||await this.prepareChunks(this.data);const s=this.tags.map(h=>[h.get("name",{decode:!0,string:!1}),h.get("value",{decode:!0,string:!1})]);return await(0,t.default)([r.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),r.stringToBuffer(this.quantity),r.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),s,r.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}}return Ut.default=l,Ut}var Bt={},De;function Vr(){if(De)return Bt;De=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.TransactionUploader=void 0;const r=ge(),t=G,e=Tt,n=ur(),c=1,l=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],o=1e3*40;class u{get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(h,g){if(this.api=h,this.chunkIndex=0,this.txPosted=!1,this.lastRequestTimeEnd=0,this.totalErrors=0,this.lastResponseStatus=0,this.lastResponseError="",!g.id)throw new Error("Transaction is not signed");if(!g.chunks)throw new Error("Transaction chunks not prepared");this.data=g.data,this.transaction=new r.default(Object.assign({},g,{data:new Uint8Array(0)}))}async uploadChunk(h){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let g=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+o-Date.now(),o);if(g>0&&(g=g-g*Math.random()*.3,await new Promise($=>setTimeout($,g))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}h&&(this.chunkIndex=h);const k=this.transaction.getChunk(h||this.chunkIndex,this.data);if(!await(0,n.validatePath)(this.transaction.chunks.data_root,parseInt(k.offset),0,parseInt(k.data_size),t.b64UrlToBuffer(k.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);const R=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch($=>(console.error($.message),{status:-1,data:{error:$.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=R.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,e.getError)(R),l.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(h,g,k){if(!g||typeof g.chunkIndex!="number"||typeof g.transaction!="object")throw new Error("Serialized object does not match expected format.");var C=new r.default(g.transaction);C.chunks||await C.prepareChunks(k);const R=new u(h,C);if(R.chunkIndex=g.chunkIndex,R.lastRequestTimeEnd=g.lastRequestTimeEnd,R.lastResponseError=g.lastResponseError,R.lastResponseStatus=g.lastResponseStatus,R.txPosted=g.txPosted,R.data=k,R.transaction.data_root!==g.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return R}static async fromTransactionId(h,g){const k=await h.get(`tx/${g}`);if(k.status!==200)throw new Error(`Tx ${g} not found: ${k.status}`);const C=k.data;return C.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:C}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=c){this.transaction.data=this.data;const k=await this.api.post("tx",this.transaction).catch(C=>(console.error(C),{status:-1,data:{error:C.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=k.status,this.transaction.data=new Uint8Array(0),k.status>=200&&k.status<300){this.txPosted=!0,this.chunkIndex=c;return}throw this.lastResponseError=(0,e.getError)(k),new Error(`Unable to upload transaction: ${k.status}, ${this.lastResponseError}`)}const g=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=g.status,!(g.status>=200&&g.status<300))throw this.lastResponseError=(0,e.getError)(g),new Error(`Unable to upload transaction: ${g.status}, ${this.lastResponseError}`);this.txPosted=!0}}return Bt.TransactionUploader=u,Bt}var Le;function Zr(){if(Le)return qt;Le=1;var r=V&&V.__await||function(u){return this instanceof r?(this.v=u,this):new r(u)},t=V&&V.__asyncGenerator||function(u,s,h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=h.apply(u,s||[]),k,C=[];return k={},R("next"),R("throw"),R("return"),k[Symbol.asyncIterator]=function(){return this},k;function R(M){g[M]&&(k[M]=function(Z){return new Promise(function(A,v){C.push([M,Z,A,v])>1||$(M,Z)})})}function $(M,Z){try{B(g[M](Z))}catch(A){j(C[0][3],A)}}function B(M){M.value instanceof r?Promise.resolve(M.value.v).then(L,K):j(C[0][2],M)}function L(M){$("next",M)}function K(M){$("throw",M)}function j(M,Z){M(Z),C.shift(),C.length&&$(C[0][0],C[0][1])}};Object.defineProperty(qt,"__esModule",{value:!0});const e=Tt,n=ge(),c=G,l=Vr();class o{constructor(s,h,g){this.api=s,this.crypto=h,this.chunks=g}getTransactionAnchor(){return this.api.get("tx_anchor").then(s=>s.data)}getPrice(s,h){let g=h?`price/${s}/${h}`:`price/${s}`;return this.api.get(g).then(k=>k.data)}async get(s){const h=await this.api.get(`tx/${s}`);if(h.status==200){const g=parseInt(h.data.data_size);if(h.data.format>=2&&g>0&&g<=1024*1024*12){const k=await this.getData(s);return new n.default(Object.assign(Object.assign({},h.data),{data:k}))}return new n.default(Object.assign(Object.assign({},h.data),{format:h.data.format||1}))}throw h.status==404?new e.default("TX_NOT_FOUND"):h.status==410?new e.default("TX_FAILED"):new e.default("TX_INVALID")}fromRaw(s){return new n.default(s)}async search(s,h){return this.api.post("arql",{op:"equals",expr1:s,expr2:h}).then(g=>g.data?g.data:[])}getStatus(s){return this.api.get(`tx/${s}/status`).then(h=>h.status==200?{status:200,confirmed:h.data}:{status:h.status,confirmed:null})}async getData(s,h){let g;try{g=await this.chunks.downloadChunkedData(s)}catch(k){console.error(`Error while trying to download chunked data for ${s}`),console.error(k)}if(!g){console.warn(`Falling back to gateway cache for ${s}`);try{g=(await this.api.get(`/${s}`)).data}catch(k){console.error(`Error while trying to download contiguous data from gateway cache for ${s}`),console.error(k)}}if(!g)throw new Error(`${s} was not found!`);return h&&h.decode&&!h.string?g:h&&h.decode&&h.string?c.bufferToString(g):c.bufferTob64Url(g)}async sign(s,h,g){if(!h&&typeof arweaveWallet!="object")throw new Error("A new Arweave transaction must provide the jwk parameter.");if(!h||h==="use_wallet"){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}const k=await arweaveWallet.sign(s,g);s.setSignature({id:k.id,owner:k.owner,reward:k.reward,tags:k.tags,signature:k.signature})}else{s.setOwner(h.n);let k=await s.getSignatureData(),C=await this.crypto.sign(h,k,g),R=await this.crypto.hash(C);s.setSignature({id:c.bufferTob64Url(R),owner:h.n,signature:c.bufferTob64Url(C)})}}async verify(s){const h=await s.getSignatureData(),g=s.get("signature",{decode:!0,string:!1}),k=c.bufferTob64Url(await this.crypto.hash(g));if(s.id!==k)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(s.owner,h,g)}async post(s){if(typeof s=="string"?s=new n.default(JSON.parse(s)):typeof s.readInt32BE=="function"?s=new n.default(JSON.parse(s.toString())):typeof s=="object"&&!(s instanceof n.default)&&(s=new n.default(s)),!(s instanceof n.default))throw new Error("Must be Transaction object");s.chunks||await s.prepareChunks(s.data);const h=await this.getUploader(s,s.data);try{for(;!h.isComplete;)await h.uploadChunk()}catch(g){if(h.lastResponseStatus>0)return{status:h.lastResponseStatus,statusText:h.lastResponseError,data:{error:h.lastResponseError}};throw g}return{status:200,statusText:"OK",data:{}}}async getUploader(s,h){let g;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),s instanceof n.default){if(h||(h=s.data),!(h instanceof Uint8Array))throw new Error("Data format is invalid");s.chunks||await s.prepareChunks(h),g=new l.TransactionUploader(this.api,s),(!g.data||g.data.length===0)&&(g.data=h)}else{if(typeof s=="string"&&(s=await l.TransactionUploader.fromTransactionId(this.api,s)),!h||!(h instanceof Uint8Array))throw new Error("Must provide data when resuming upload");g=await l.TransactionUploader.fromSerialized(this.api,s,h)}return g}upload(s,h){return t(this,arguments,function*(){const k=yield r(this.getUploader(s,h));for(;!k.isComplete;)yield r(k.uploadChunk()),yield yield r(k);return yield r(k)})}}return qt.default=o,qt}var pe={};Object.defineProperty(pe,"__esModule",{value:!0});const Me=G;let Yr=class{constructor(t,e){this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Me.bufferTob64Url(await this.crypto.hash(Me.b64UrlToBuffer(t)))}};pe.default=Yr;var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.SiloResource=void 0;const qe=G;let Qr=class{constructor(t,e,n){this.api=t,this.crypto=e,this.transactions=n}async get(t){if(!t)throw new Error("No Silo URI specified");const e=await this.parseUri(t),n=await this.transactions.search("Silo-Name",e.getAccessKey());if(n.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);const c=await this.transactions.get(n[0]);if(!c)throw new Error(`No data could be found for the Silo URI: ${t}`);const l=c.get("data",{decode:!0,string:!1});return this.crypto.decrypt(l,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");const n=await this.parseUri(e),c=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(c,n.getEncryptionKey())}async parseUri(t){const e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");const n=e[1],c=Math.pow(2,parseInt(e[2])),l=await this.hash(qe.stringToBuffer(n),c),o=qe.bufferTob64(l.slice(0,15)),u=await this.hash(l.slice(16,31),1);return new lr(t,o,u)}async hash(t,e){let n=await this.crypto.hash(t);for(let c=0;c<e-1;c++)n=await this.crypto.hash(n);return n}};Pt.default=Qr;let lr=class{constructor(t,e,n){this.uri=t,this.accessKey=e,this.encryptionKey=n}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};Pt.SiloResource=lr;var we={};Object.defineProperty(we,"__esModule",{value:!0});const je=Tt,tn=G;let en=class{constructor(t){this.api=t}async getTransactionOffset(t){const e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,je.getError)(e)}`)}async getChunk(t){const e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,je.getError)(e)}`)}async getChunkData(t){const e=await this.getChunk(t);return tn.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){const e=await this.getTransactionOffset(t),n=parseInt(e.size),l=parseInt(e.offset)-n+1,o=new Uint8Array(n);let u=0;for(;u<n;){this.api.config.logging&&console.log(`[chunk] ${u}/${n}`);let s;try{s=await this.getChunkData(l+u)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${l+u}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(s)o.set(s,u),u+=s.length;else throw new Error(`Couldn't complete data download at ${u}/${n}`)}return o}};we.default=en;var ye={};Object.defineProperty(ye,"__esModule",{value:!0});const rn=Tt;let hr=class fr{constructor(t,e){this.api=t,this.network=e}async get(t){const e=await this.api.get(`${fr.ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new rn.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){const{current:t}=await this.network.getInfo();return await this.get(t)}};ye.default=hr;hr.ENDPOINT="block/hash/";var He;function Vt(){if(He)return Mt;He=1,Object.defineProperty(Mt,"__esModule",{value:!0});const r=le,t=he,e=fe,n=de,c=Zr(),l=pe,o=ge(),u=G,s=Pt,h=we,g=ye;class k{constructor(R){this.api=new t.default(R),this.wallets=new l.default(this.api,k.crypto),this.chunks=new h.default(this.api),this.transactions=new c.default(this.api,k.crypto,this.chunks),this.silo=new s.default(this.api,this.crypto,this.transactions),this.network=new n.default(this.api),this.blocks=new g.default(this.api,this.network),this.ar=new r.default}get crypto(){return k.crypto}get utils(){return k.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(R,$){const B={};if(Object.assign(B,R),!R.data&&!(R.target&&R.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(R.owner==null&&$&&$!=="use_wallet"&&(B.owner=$.n),R.last_tx==null&&(B.last_tx=await this.transactions.getTransactionAnchor()),typeof R.data=="string"&&(R.data=u.stringToBuffer(R.data)),R.data instanceof ArrayBuffer&&(R.data=new Uint8Array(R.data)),R.data&&!(R.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(R.reward==null){const K=R.data?R.data.byteLength:0;B.reward=await this.transactions.getPrice(K,B.target)}B.data_root="",B.data_size=R.data?R.data.byteLength.toString():"0",B.data=R.data||new Uint8Array(0);const L=new o.default(B);return await L.getSignatureData(),L}async createSiloTransaction(R,$,B){const L={};if(Object.assign(L,R),!R.data)throw new Error("Silo transactions must have a 'data' value");if(!B)throw new Error("No Silo URI specified.");if(R.target||R.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(R.owner==null){if(!$||!$.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");L.owner=$.n}R.last_tx==null&&(L.last_tx=await this.transactions.getTransactionAnchor());const K=await this.silo.parseUri(B);if(typeof R.data=="string"){const M=await this.crypto.encrypt(u.stringToBuffer(R.data),K.getEncryptionKey());L.reward=await this.transactions.getPrice(M.byteLength),L.data=u.bufferTob64Url(M)}if(R.data instanceof Uint8Array){const M=await this.crypto.encrypt(R.data,K.getEncryptionKey());L.reward=await this.transactions.getPrice(M.byteLength),L.data=u.bufferTob64Url(M)}const j=new o.default(L);return j.addTag("Silo-Name",K.getAccessKey()),j.addTag("Silo-Version","0.1.0"),j}arql(R){return this.api.post("/arql",R).then($=>$.data||[])}}return Mt.default=k,k.crypto=new e.default,k.utils=u,Mt}(function(r){var t=V&&V.__createBinding||(Object.create?function(c,l,o,u){u===void 0&&(u=o);var s=Object.getOwnPropertyDescriptor(l,o);(!s||("get"in s?!l.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return l[o]}}),Object.defineProperty(c,u,s)}:function(c,l,o,u){u===void 0&&(u=o),c[u]=l[o]}),e=V&&V.__exportStar||function(c,l){for(var o in c)o!=="default"&&!Object.prototype.hasOwnProperty.call(l,o)&&t(l,c,o)};Object.defineProperty(r,"__esModule",{value:!0});const n=Vt();n.default.init=function(c={}){function l(){const g={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return g;const k=location.protocol.replace(":",""),C=location.hostname,R=location.port?parseInt(location.port):k=="https"?443:80;return["localhost","127.0.0.1"].includes(C)||k=="file"?g:{host:C,port:R,protocol:k}}const o=l(),u=c.protocol||o.protocol,s=c.host||o.host,h=c.port||o.port;return new n.default(Object.assign(Object.assign({},c),{host:s,protocol:u,port:h}))},typeof globalThis=="object"?globalThis.Arweave=n.default:typeof self=="object"&&(self.Arweave=n.default),e(Vt(),r),r.default=n.default})(Qe);const ea=Rr(Qe);var dr={},gr={},Ht={},me={};Object.defineProperty(me,"__esModule",{value:!0});const nn=Xt;class an{constructor(){P(this,"BigNum");this.BigNum=(t,e)=>{let n=nn.BigNumber.clone({DECIMAL_PLACES:e});return new n(t)}}winstonToAr(t,{formatted:e=!1,decimals:n=12,trim:c=!0}={}){let l=this.stringToBigNum(t,n).shiftedBy(-12);return e?l.toFormat(n):l.toFixed(n)}arToWinston(t,{formatted:e=!1}={}){let n=this.stringToBigNum(t).shiftedBy(12);return e?n.toFormat():n.toFixed(0)}compare(t,e){let n=this.stringToBigNum(t),c=this.stringToBigNum(e);return n.comparedTo(c)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let n=this.stringToBigNum(t),c=this.stringToBigNum(e);return n.isLessThan(c)}isGreaterThan(t,e){let n=this.stringToBigNum(t),c=this.stringToBigNum(e);return n.isGreaterThan(c)}add(t,e){let n=this.stringToBigNum(t);return this.stringToBigNum(e),n.plus(e).toFixed(0)}sub(t,e){let n=this.stringToBigNum(t);return this.stringToBigNum(e),n.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}}me.default=an;var ve={};Object.defineProperty(ve,"__esModule",{value:!0});class sn{constructor(t){P(this,"METHOD_GET","GET");P(this,"METHOD_POST","POST");P(this,"config");this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){const e=t.protocol||"http",n=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:n,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,{...e,method:this.METHOD_GET})}async post(t,e,n){var l;const c=new Headers((n==null?void 0:n.headers)||{});return(l=c.get("content-type"))!=null&&l.includes("application/json")||c.append("content-type","application/json"),c.append("accept","application/json, text/plain, */*"),await this.request(t,{...n,method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:c})}async request(t,e){const n=new Headers((e==null?void 0:e.headers)||{}),c=`${this.config.protocol}://${this.config.host}:${this.config.port}`,l=e==null?void 0:e.responseType;e==null||delete e.responseType,t.startsWith("/")&&(t=t.slice(1)),this.config.network&&n.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${c}/${t}`);let o=await fetch(`${c}/${t}`,{...e||{},headers:n});this.config.logging&&this.config.logger(`Response:   ${o.url} - ${o.status}`);const u=o.headers.get("content-type"),s=o;if(l==="arraybuffer")s.data=await o.arrayBuffer();else if(l==="text")s.data=await o.text();else if(l==="webstream")s.data=on(o.body);else if(u!=null&&u.startsWith("application/json"))try{await o.clone().json(),s.data=await o.json()}catch{s.data=await o.text()}else s.data=await o.text();return s}}ve.default=sn;const on=r=>{const t=r;return typeof t[Symbol.asyncIterator]>"u"?(t[Symbol.asyncIterator]=cn(r),t):r},cn=function(r){return async function*(){const e=r.getReader();try{const{done:n,value:c}=await e.read();if(n)return;yield c}finally{e.releaseLock()}}};var _e={},J={};Object.defineProperty(J,"__esModule",{value:!0});J.b64UrlDecode=J.b64UrlEncode=J.bufferTob64Url=J.bufferTob64=J.b64UrlToBuffer=J.stringToB64Url=J.stringToBuffer=J.bufferToString=J.b64UrlToString=J.concatBuffers=void 0;const pr=It;function un(r){let t=0;for(let c=0;c<r.length;c++)t+=r[c].byteLength;let e=new Uint8Array(t),n=0;e.set(new Uint8Array(r[0]),n),n+=r[0].byteLength;for(let c=1;c<r.length;c++)e.set(new Uint8Array(r[c]),n),n+=r[c].byteLength;return e}J.concatBuffers=un;function ln(r){let t=mr(r);return wr(t)}J.b64UrlToString=ln;function wr(r){return new TextDecoder("utf-8",{fatal:!0}).decode(r)}J.bufferToString=wr;function yr(r){return new TextEncoder().encode(r)}J.stringToBuffer=yr;function hn(r){return _r(yr(r))}J.stringToB64Url=hn;function mr(r){return new Uint8Array(pr.toByteArray(Ar(r)))}J.b64UrlToBuffer=mr;function vr(r){return pr.fromByteArray(new Uint8Array(r))}J.bufferTob64=vr;function _r(r){return Tr(vr(r))}J.bufferTob64Url=_r;function Tr(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}J.b64UrlEncode=Tr;function Ar(r){r=r.replace(/\-/g,"+").replace(/\_/g,"/");let t;return r.length%4==0?t=0:t=4-r.length%4,r.concat("=".repeat(t))}J.b64UrlDecode=Ar;Object.defineProperty(_e,"__esModule",{value:!0});const _t=J;class fn{constructor(){P(this,"keyLength",4096);P(this,"publicExponent",65537);P(this,"hashAlgorithm","sha256");P(this,"driver");if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:n}={}){let c=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(c)}async hash(t,e="SHA-256"){let n=await this.driver.digest(e,t);return new Uint8Array(n)}async verify(t,e,n){const c={kty:"RSA",e:"AQAB",n:t},l=await this.jwkToPublicCryptoKey(c),o=await this.driver.digest("SHA-256",e),u=await this.driver.verify({name:"RSA-PSS",saltLength:0},l,n,e),s=await this.driver.verify({name:"RSA-PSS",saltLength:32},l,n,e),h=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((l.algorithm.modulusLength-1)/8)-o.byteLength-2},l,n,e);return u||s||h}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;const t=crypto==null?void 0:crypto.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(n=>typeof t[n]=="function")}async encrypt(t,e,n){const c=await this.driver.importKey("raw",typeof e=="string"?_t.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),l=await this.driver.deriveKey({name:"PBKDF2",salt:n?_t.stringToBuffer(n):_t.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},c,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=new Uint8Array(16);crypto.getRandomValues(o);const u=await this.driver.encrypt({name:"AES-CBC",iv:o},l,t);return _t.concatBuffers([o,u])}async decrypt(t,e,n){const c=await this.driver.importKey("raw",typeof e=="string"?_t.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),l=await this.driver.deriveKey({name:"PBKDF2",salt:n?_t.stringToBuffer(n):_t.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},c,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=t.slice(0,16),u=await this.driver.decrypt({name:"AES-CBC",iv:o},l,t.slice(16));return _t.concatBuffers([u])}}_e.default=fn;var Te={};Object.defineProperty(Te,"__esModule",{value:!0});class dn{constructor(t){P(this,"api");this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}}Te.default=dn;var Kt={},At={};Object.defineProperty(At,"__esModule",{value:!0});At.getError=void 0;class gn extends Error{constructor(e,n={}){var t=(...args)=>{super(...args);P(this,"type");P(this,"response")};n.message?t(n.message):t(),this.type=e,this.response=n.response}getType(){return this.type}}At.default=gn;function pn(r){let t=r.data;if(typeof r.data=="string")try{t=JSON.parse(r.data)}catch{}if(r.data instanceof ArrayBuffer||r.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:r.statusText||"unknown"}At.getError=pn;var Rt={},Ft={},Ke;function wn(){if(Ke)return Ft;Ke=1,Object.defineProperty(Ft,"__esModule",{value:!0});const r=Zt();async function t(n){if(Array.isArray(n)){const o=r.default.utils.concatBuffers([r.default.utils.stringToBuffer("list"),r.default.utils.stringToBuffer(n.length.toString())]);return await e(n,await r.default.crypto.hash(o,"SHA-384"))}const c=r.default.utils.concatBuffers([r.default.utils.stringToBuffer("blob"),r.default.utils.stringToBuffer(n.byteLength.toString())]),l=r.default.utils.concatBuffers([await r.default.crypto.hash(c,"SHA-384"),await r.default.crypto.hash(n,"SHA-384")]);return await r.default.crypto.hash(l,"SHA-384")}Ft.default=t;async function e(n,c){if(n.length<1)return c;const l=r.default.utils.concatBuffers([c,await t(n[0])]),o=await r.default.crypto.hash(l,"SHA-384");return await e(n.slice(1),o)}return Ft}var ue={},Fe;function br(){return Fe||(Fe=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.debug=r.validatePath=r.arrayCompare=r.bufferToInt=r.intToBuffer=r.arrayFlatten=r.generateProofs=r.buildLayers=r.generateTransactionChunks=r.generateTree=r.computeRootHash=r.generateLeaves=r.chunkData=r.MIN_CHUNK_SIZE=r.MAX_CHUNK_SIZE=void 0;const t=Zt(),e=J;r.MAX_CHUNK_SIZE=256*1024,r.MIN_CHUNK_SIZE=32*1024;const n=32,c=32;async function l(A){let v=[],b=A,S=0;for(;b.byteLength>=r.MAX_CHUNK_SIZE;){let I=r.MAX_CHUNK_SIZE,O=b.byteLength-r.MAX_CHUNK_SIZE;O>0&&O<r.MIN_CHUNK_SIZE&&(I=Math.ceil(b.byteLength/2));const q=b.slice(0,I),H=await t.default.crypto.hash(q);S+=q.byteLength,v.push({dataHash:H,minByteRange:S-q.byteLength,maxByteRange:S}),b=b.slice(I)}return v.push({dataHash:await t.default.crypto.hash(b),minByteRange:S,maxByteRange:S+b.byteLength}),v}r.chunkData=l;async function o(A){return Promise.all(A.map(async({dataHash:v,minByteRange:b,maxByteRange:S})=>({type:"leaf",id:await B(await Promise.all([B(v),B(L(S))])),dataHash:v,minByteRange:b,maxByteRange:S})))}r.generateLeaves=o;async function u(A){return(await s(A)).id}r.computeRootHash=u;async function s(A){return await g(await o(await l(A)))}r.generateTree=s;async function h(A){const v=await l(A),b=await o(v),S=await g(b),I=await k(S),O=v.slice(-1)[0];return O.maxByteRange-O.minByteRange===0&&(v.splice(v.length-1,1),I.splice(I.length-1,1)),{data_root:S.id,chunks:v,proofs:I}}r.generateTransactionChunks=h;async function g(A,v=0){if(A.length<2)return A[0];const b=[];for(let S=0;S<A.length;S+=2)b.push(await $(A[S],A[S+1]));return g(b,v+1)}r.buildLayers=g;function k(A){const v=C(A);return Array.isArray(v)?R(v):[v]}r.generateProofs=k;function C(A,v=new Uint8Array,b=0){if(A.type=="leaf")return{offset:A.maxByteRange-1,proof:(0,e.concatBuffers)([v,A.dataHash,L(A.maxByteRange)])};if(A.type=="branch"){const S=(0,e.concatBuffers)([v,A.leftChild.id,A.rightChild.id,L(A.byteRange)]);return[C(A.leftChild,S,b+1),C(A.rightChild,S,b+1)]}throw new Error("Unexpected node type")}function R(A){const v=[];return A.forEach(b=>{Array.isArray(b)?v.push(...R(b)):v.push(b)}),v}r.arrayFlatten=R;async function $(A,v){return v?{type:"branch",id:await B([await B(A.id),await B(v.id),await B(L(A.maxByteRange))]),byteRange:A.maxByteRange,maxByteRange:v.maxByteRange,leftChild:A,rightChild:v}:A}async function B(A){return Array.isArray(A)&&(A=t.default.utils.concatBuffers(A)),new Uint8Array(await t.default.crypto.hash(A))}function L(A){const v=new Uint8Array(n);for(var b=v.length-1;b>=0;b--){var S=A%256;v[b]=S,A=(A-S)/256}return v}r.intToBuffer=L;function K(A){let v=0;for(var b=0;b<A.length;b++)v*=256,v+=A[b];return v}r.bufferToInt=K;const j=(A,v)=>A.every((b,S)=>v[S]===b);r.arrayCompare=j;async function M(A,v,b,S,I){if(S<=0)return!1;if(v>=S)return M(A,0,S-1,S,I);if(v<0)return M(A,0,0,S,I);if(I.length==c+n){const at=I.slice(0,c),st=I.slice(at.length,at.length+n),lt=await B([await B(at),await B(st)]);return(0,r.arrayCompare)(A,lt)?{offset:S-1,leftBound:b,rightBound:S,chunkSize:S-b}:!1}const O=I.slice(0,c),q=I.slice(O.length,O.length+c),H=I.slice(O.length+q.length,O.length+q.length+n),F=K(H),tt=I.slice(O.length+q.length+H.length),rt=await B([await B(O),await B(q),await B(H)]);return(0,r.arrayCompare)(A,rt)?v<F?await M(O,v,b,Math.min(S,F),tt):await M(q,v,Math.max(b,F),S,tt):!1}r.validatePath=M;async function Z(A,v=""){if(A.byteLength<1)return v;const b=A.slice(0,c),S=A.slice(b.length,b.length+c),I=A.slice(b.length+S.length,b.length+S.length+n),O=K(I),q=A.slice(b.length+S.length+I.length),H=await B([await B(b),await B(S),await B(I)]),F=`${v}
${JSON.stringify(Buffer.from(b))},${JSON.stringify(Buffer.from(S))},${O} => ${JSON.stringify(H)}`;return Z(q,F)}r.debug=Z}(ue)),ue}var ze;function Ae(){if(ze)return Rt;ze=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.Tag=void 0;const r=J,t=wn(),e=br();class n{get(u,s){if(!Object.getOwnPropertyNames(this).includes(u))throw new Error(`Field "${u}" is not a property of the Arweave Transaction class.`);return this[u]instanceof Uint8Array?s&&s.decode&&s.string?r.bufferToString(this[u]):s&&s.decode&&!s.string?this[u]:r.bufferTob64Url(this[u]):s&&s.decode==!0?s&&s.string?r.b64UrlToString(this[u]):r.b64UrlToBuffer(this[u]):this[u]}}class c extends n{constructor(s,h,g=!1){super();P(this,"name");P(this,"value");this.name=s,this.value=h}}Rt.Tag=c;class l extends n{constructor(s={}){super();P(this,"format",2);P(this,"id","");P(this,"last_tx","");P(this,"owner","");P(this,"tags",[]);P(this,"target","");P(this,"quantity","0");P(this,"data_size","0");P(this,"data",new Uint8Array);P(this,"data_root","");P(this,"reward","0");P(this,"signature","");P(this,"chunks");Object.assign(this,s),typeof this.data=="string"&&(this.data=r.b64UrlToBuffer(this.data)),s.tags&&(this.tags=s.tags.map(h=>new c(h.name,h.value)))}addTag(s,h){this.tags.push(new c(r.stringToB64Url(s),r.stringToB64Url(h)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:r.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(s){this.owner=s}setSignature({id:s,owner:h,reward:g,tags:k,signature:C}){this.id=s,this.owner=h,g&&(this.reward=g),k&&(this.tags=k),this.signature=C}async prepareChunks(s){!this.chunks&&s.byteLength>0&&(this.chunks=await(0,e.generateTransactionChunks)(s),this.data_root=r.bufferTob64Url(this.chunks.data_root)),!this.chunks&&s.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(s,h){if(!this.chunks)throw new Error("Chunks have not been prepared");const g=this.chunks.proofs[s],k=this.chunks.chunks[s];return{data_root:this.data_root,data_size:this.data_size,data_path:r.bufferTob64Url(g.proof),offset:g.offset.toString(),chunk:r.bufferTob64Url(h.slice(k.minByteRange,k.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let s=this.tags.reduce((g,k)=>r.concatBuffers([g,k.get("name",{decode:!0,string:!1}),k.get("value",{decode:!0,string:!1})]),new Uint8Array);return r.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),r.stringToBuffer(this.quantity),r.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),s]);case 2:this.data_root||await this.prepareChunks(this.data);const h=this.tags.map(g=>[g.get("name",{decode:!0,string:!1}),g.get("value",{decode:!0,string:!1})]);return await(0,t.default)([r.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),r.stringToBuffer(this.quantity),r.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),h,r.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}}return Rt.default=l,Rt}var $t={},We;function yn(){if(We)return $t;We=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.TransactionUploader=void 0;const r=Ae(),t=J,e=At,n=br(),c=1,l=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],o=1e3*40;class u{constructor(h,g){P(this,"api");P(this,"chunkIndex",0);P(this,"txPosted",!1);P(this,"transaction");P(this,"lastRequestTimeEnd",0);P(this,"totalErrors",0);P(this,"data");P(this,"lastResponseStatus",0);P(this,"lastResponseError","");if(this.api=h,!g.id)throw new Error("Transaction is not signed");if(!g.chunks)throw new Error("Transaction chunks not prepared");this.data=g.data,this.transaction=new r.default(Object.assign({},g,{data:new Uint8Array(0)}))}get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}async uploadChunk(h){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let g=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+o-Date.now(),o);if(g>0&&(g=g-g*Math.random()*.3,await new Promise($=>setTimeout($,g))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}h&&(this.chunkIndex=h);const k=this.transaction.getChunk(h||this.chunkIndex,this.data);if(!await(0,n.validatePath)(this.transaction.chunks.data_root,parseInt(k.offset),0,parseInt(k.data_size),t.b64UrlToBuffer(k.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);const R=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch($=>(console.error($.message),{status:-1,data:{error:$.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=R.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,e.getError)(R),l.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(h,g,k){if(!g||typeof g.chunkIndex!="number"||typeof g.transaction!="object")throw new Error("Serialized object does not match expected format.");var C=new r.default(g.transaction);C.chunks||await C.prepareChunks(k);const R=new u(h,C);if(R.chunkIndex=g.chunkIndex,R.lastRequestTimeEnd=g.lastRequestTimeEnd,R.lastResponseError=g.lastResponseError,R.lastResponseStatus=g.lastResponseStatus,R.txPosted=g.txPosted,R.data=k,R.transaction.data_root!==g.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return R}static async fromTransactionId(h,g){const k=await h.get(`tx/${g}`);if(k.status!==200)throw new Error(`Tx ${g} not found: ${k.status}`);const C=k.data;return C.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:C}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=c){this.transaction.data=this.data;const k=await this.api.post("tx",this.transaction).catch(C=>(console.error(C),{status:-1,data:{error:C.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=k.status,this.transaction.data=new Uint8Array(0),k.status>=200&&k.status<300){this.txPosted=!0,this.chunkIndex=c;return}throw this.lastResponseError=(0,e.getError)(k),new Error(`Unable to upload transaction: ${k.status}, ${this.lastResponseError}`)}const g=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=g.status,!(g.status>=200&&g.status<300))throw this.lastResponseError=(0,e.getError)(g),new Error(`Unable to upload transaction: ${g.status}, ${this.lastResponseError}`);this.txPosted=!0}}return $t.TransactionUploader=u,$t}var Ge;function mn(){if(Ge)return Kt;Ge=1,Object.defineProperty(Kt,"__esModule",{value:!0});const r=At,t=Ae(),e=J,n=yn();class c{constructor(o,u,s){P(this,"api");P(this,"crypto");P(this,"chunks");this.api=o,this.crypto=u,this.chunks=s}getTransactionAnchor(){return this.api.get("tx_anchor").then(o=>o.data)}getPrice(o,u){let s=u?`price/${o}/${u}`:`price/${o}`;return this.api.get(s).then(h=>h.data)}async get(o){const u=await this.api.get(`tx/${o}`);if(u.status==200){const s=parseInt(u.data.data_size);if(u.data.format>=2&&s>0&&s<=1024*1024*12){const h=await this.getData(o);return new t.default({...u.data,data:h})}return new t.default({...u.data,format:u.data.format||1})}throw u.status==404?new r.default("TX_NOT_FOUND"):u.status==410?new r.default("TX_FAILED"):new r.default("TX_INVALID")}fromRaw(o){return new t.default(o)}async search(o,u){return this.api.post("arql",{op:"equals",expr1:o,expr2:u}).then(s=>s.data?s.data:[])}getStatus(o){return this.api.get(`tx/${o}/status`).then(u=>u.status==200?{status:200,confirmed:u.data}:{status:u.status,confirmed:null})}async getData(o,u){let s;try{s=await this.chunks.downloadChunkedData(o)}catch(h){console.error(`Error while trying to download chunked data for ${o}`),console.error(h)}if(!s){console.warn(`Falling back to gateway cache for ${o}`);try{s=(await this.api.get(`/${o}`,{responseType:"arraybuffer"})).data}catch(h){console.error(`Error while trying to download contiguous data from gateway cache for ${o}`),console.error(h)}}if(!s)throw new Error(`${o} was not found!`);return u&&u.decode&&!u.string?s:u&&u.decode&&u.string?e.bufferToString(s):e.bufferTob64Url(s)}async sign(o,u,s){if(!u&&typeof arweaveWallet!="object")throw new Error("A new Arweave transaction must provide the jwk parameter.");if(!u||u==="use_wallet"){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}const h=await arweaveWallet.sign(o,s);o.setSignature({id:h.id,owner:h.owner,reward:h.reward,tags:h.tags,signature:h.signature})}else{o.setOwner(u.n);let h=await o.getSignatureData(),g=await this.crypto.sign(u,h,s),k=await this.crypto.hash(g);o.setSignature({id:e.bufferTob64Url(k),owner:u.n,signature:e.bufferTob64Url(g)})}}async verify(o){const u=await o.getSignatureData(),s=o.get("signature",{decode:!0,string:!1}),h=e.bufferTob64Url(await this.crypto.hash(s));if(o.id!==h)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(o.owner,u,s)}async post(o){if(typeof o=="string"?o=new t.default(JSON.parse(o)):typeof o.readInt32BE=="function"?o=new t.default(JSON.parse(o.toString())):typeof o=="object"&&!(o instanceof t.default)&&(o=new t.default(o)),!(o instanceof t.default))throw new Error("Must be Transaction object");o.chunks||await o.prepareChunks(o.data);const u=await this.getUploader(o,o.data);try{for(;!u.isComplete;)await u.uploadChunk()}catch(s){if(u.lastResponseStatus>0)return{status:u.lastResponseStatus,statusText:u.lastResponseError,data:{error:u.lastResponseError}};throw s}return{status:200,statusText:"OK",data:{}}}async getUploader(o,u){let s;if(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),o instanceof t.default){if(u||(u=o.data),!(u instanceof Uint8Array))throw new Error("Data format is invalid");o.chunks||await o.prepareChunks(u),s=new n.TransactionUploader(this.api,o),(!s.data||s.data.length===0)&&(s.data=u)}else{if(typeof o=="string"&&(o=await n.TransactionUploader.fromTransactionId(this.api,o)),!u||!(u instanceof Uint8Array))throw new Error("Must provide data when resuming upload");s=await n.TransactionUploader.fromSerialized(this.api,o,u)}return s}async*upload(o,u){const s=await this.getUploader(o,u);for(;!s.isComplete;)await s.uploadChunk(),yield s;return s}}return Kt.default=c,Kt}var be={};Object.defineProperty(be,"__esModule",{value:!0});const Je=J;class vn{constructor(t,e){P(this,"api");P(this,"crypto");this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Je.bufferTob64Url(await this.crypto.hash(Je.b64UrlToBuffer(t)))}}be.default=vn;var xt={};Object.defineProperty(xt,"__esModule",{value:!0});xt.SiloResource=void 0;const Xe=J;class _n{constructor(t,e,n){P(this,"api");P(this,"crypto");P(this,"transactions");this.api=t,this.crypto=e,this.transactions=n}async get(t){if(!t)throw new Error("No Silo URI specified");const e=await this.parseUri(t),n=await this.transactions.search("Silo-Name",e.getAccessKey());if(n.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);const c=await this.transactions.get(n[0]);if(!c)throw new Error(`No data could be found for the Silo URI: ${t}`);const l=c.get("data",{decode:!0,string:!1});return this.crypto.decrypt(l,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");const n=await this.parseUri(e),c=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(c,n.getEncryptionKey())}async parseUri(t){const e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");const n=e[1],c=Math.pow(2,parseInt(e[2])),l=await this.hash(Xe.stringToBuffer(n),c),o=Xe.bufferTob64(l.slice(0,15)),u=await this.hash(l.slice(16,31),1);return new Er(t,o,u)}async hash(t,e){let n=await this.crypto.hash(t);for(let c=0;c<e-1;c++)n=await this.crypto.hash(n);return n}}xt.default=_n;class Er{constructor(t,e,n){P(this,"uri");P(this,"accessKey");P(this,"encryptionKey");this.uri=t,this.accessKey=e,this.encryptionKey=n}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}}xt.SiloResource=Er;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});const Ve=At,Tn=J;class An{constructor(t){P(this,"api");this.api=t}async getTransactionOffset(t){const e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,Ve.getError)(e)}`)}async getChunk(t){const e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,Ve.getError)(e)}`)}async getChunkData(t){const e=await this.getChunk(t);return Tn.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){const e=await this.getTransactionOffset(t),n=parseInt(e.size),l=parseInt(e.offset)-n+1,o=new Uint8Array(n);let u=0;for(;u<n;){this.api.config.logging&&console.log(`[chunk] ${u}/${n}`);let s;try{s=await this.getChunkData(l+u)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${l+u}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(s)o.set(s,u),u+=s.length;else throw new Error(`Couldn't complete data download at ${u}/${n}`)}return o}}Ee.default=An;var ke={};Object.defineProperty(ke,"__esModule",{value:!0});const bn=At,$e=class{constructor(t,e){P(this,"api");P(this,"network");this.api=t,this.network=e}async get(t){const e=await this.api.get(`${$e.ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new bn.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){const{current:t}=await this.network.getInfo();return await this.get(t)}};let Jt=$e;P(Jt,"ENDPOINT","block/hash/");ke.default=Jt;var Ze;function Zt(){if(Ze)return Ht;Ze=1,Object.defineProperty(Ht,"__esModule",{value:!0});const r=me,t=ve,e=_e,n=Te,c=mn(),l=be,o=Ae(),u=J,s=xt,h=Ee,g=ke,C=class{constructor($){P(this,"api");P(this,"wallets");P(this,"transactions");P(this,"network");P(this,"blocks");P(this,"ar");P(this,"silo");P(this,"chunks");this.api=new t.default($),this.wallets=new l.default(this.api,C.crypto),this.chunks=new h.default(this.api),this.transactions=new c.default(this.api,C.crypto,this.chunks),this.silo=new s.default(this.api,this.crypto,this.transactions),this.network=new n.default(this.api),this.blocks=new g.default(this.api,this.network),this.ar=new r.default}get crypto(){return C.crypto}get utils(){return C.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction($,B){const L={};if(Object.assign(L,$),!$.data&&!($.target&&$.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if($.owner==null&&B&&B!=="use_wallet"&&(L.owner=B.n),$.last_tx==null&&(L.last_tx=await this.transactions.getTransactionAnchor()),typeof $.data=="string"&&($.data=u.stringToBuffer($.data)),$.data instanceof ArrayBuffer&&($.data=new Uint8Array($.data)),$.data&&!($.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if($.reward==null){const j=$.data?$.data.byteLength:0;L.reward=await this.transactions.getPrice(j,L.target)}L.data_root="",L.data_size=$.data?$.data.byteLength.toString():"0",L.data=$.data||new Uint8Array(0);const K=new o.default(L);return await K.getSignatureData(),K}async createSiloTransaction($,B,L){const K={};if(Object.assign(K,$),!$.data)throw new Error("Silo transactions must have a 'data' value");if(!L)throw new Error("No Silo URI specified.");if($.target||$.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if($.owner==null){if(!B||!B.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");K.owner=B.n}$.last_tx==null&&(K.last_tx=await this.transactions.getTransactionAnchor());const j=await this.silo.parseUri(L);if(typeof $.data=="string"){const Z=await this.crypto.encrypt(u.stringToBuffer($.data),j.getEncryptionKey());K.reward=await this.transactions.getPrice(Z.byteLength),K.data=u.bufferTob64Url(Z)}if($.data instanceof Uint8Array){const Z=await this.crypto.encrypt($.data,j.getEncryptionKey());K.reward=await this.transactions.getPrice(Z.byteLength),K.data=u.bufferTob64Url(Z)}const M=new o.default(K);return M.addTag("Silo-Name",j.getAccessKey()),M.addTag("Silo-Version","0.1.0"),M}arql($){return this.api.post("/arql",$).then(B=>B.data||[])}};let k=C;return P(k,"init"),P(k,"crypto",new e.default),P(k,"utils",u),Ht.default=k,Ht}var Yt={};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.getDefaultConfig=void 0;const En=(r,t)=>{const e=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,n=t.split("."),c=n[n.length-1],l=["localhost","[::1]"];return l.includes(t)||r=="file"||l.includes(c)||!!t.match(e)||!!c.match(e)},kn=r=>{const t=r.charAt(0)==="[",e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!r.match(e)||t},Sn=(r,t)=>{if(En(r,t))return{protocol:"https",host:"arweave.net",port:443};if(!kn(t)){let e=t.split(".");if(e.length>=3){e.shift();const n=e.join(".");return{protocol:r,host:n}}}return{protocol:r,host:t}};Yt.getDefaultConfig=Sn;(function(r){var t=V&&V.__createBinding||(Object.create?function(l,o,u,s){s===void 0&&(s=u);var h=Object.getOwnPropertyDescriptor(o,u);(!h||("get"in h?!o.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(l,s,h)}:function(l,o,u,s){s===void 0&&(s=u),l[s]=o[u]}),e=V&&V.__exportStar||function(l,o){for(var u in l)u!=="default"&&!Object.prototype.hasOwnProperty.call(o,u)&&t(o,l,u)};Object.defineProperty(r,"__esModule",{value:!0});const n=Zt(),c=Yt;n.default.init=function(l={}){const o={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new n.default({...l,...o});const u=location.protocol.replace(":",""),s=location.hostname,h=location.port?parseInt(location.port):u=="https"?443:80,g=(0,c.getDefaultConfig)(u,s),k=l.protocol||g.protocol,C=l.host||g.host,R=l.port||g.port||h;return new n.default({...l,host:C,protocol:k,port:R})},typeof globalThis=="object"?globalThis.Arweave=n.default:typeof self=="object"&&(self.Arweave=n.default),e(Zt(),r),r.default=n.default})(gr);var Se={},Oe={},Qt={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.log=r.Log=r.LOGS=void 0;var t;(function(n){n[n.NO=0]="NO",n[n.YES=1]="YES",n[n.ARWEAVE=2]="ARWEAVE"})(t=r.LOGS||(r.LOGS={}));class e{constructor(){this.logs=t.ARWEAVE}init(c=t.ARWEAVE,l){return this.logs=c,this.arweave=l,this}show(c,l="log"){(this.logs===t.YES||this.logs===t.ARWEAVE&&this.arweave.getConfig().api.logging)&&console[l](c)}}r.Log=e,r.log=new e})(Qt);Object.defineProperty(Oe,"__esModule",{value:!0});const zt=Qt;class On{constructor(t){this._id=t.id,this._timestamp=t.timestamp,this._height=t.height,this._previous=t.previous}get id(){return this._id||zt.log.show("ID wasn't defined, make sure you have selected to return it."),this._id}get timestamp(){return this._timestamp||zt.log.show("Timestamp wasn't defined, make sure you have selected to return it."),this._timestamp}get height(){return this._height||zt.log.show("Height wasn't defined, make sure you have selected to return it."),this._height}get previous(){return this._previous||zt.log.show("Previous wasn't defined, make sure you have selected to return it."),this._previous}}Oe.default=On;var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});const ht=Qt;class Un{get id(){return this._id||ht.log.show("ID wasn't defined, make sure you have selected to return it."),this._id}get anchor(){return this._anchor||ht.log.show("Anchor wasn't defined, make sure you have selected to return it."),this._anchor}get signature(){return this._signature||ht.log.show("Signature wasn't defined, make sure you have selected to return it."),this._signature}get recipient(){return this._recipient||ht.log.show("Recipient wasn't defined, make sure you have selected to return it."),this._recipient}get owner(){return this._owner||ht.log.show("Owner wasn't defined, make sure you have selected to return it."),this._owner}get fee(){return this._fee||ht.log.show("Fee wasn't defined, make sure you have selected to return it."),this._fee}get quantity(){return this._quantity||ht.log.show("Quantity wasn't defined, make sure you have selected to return it."),this._quantity}get data(){return this._data||ht.log.show("Data wasn't defined, make sure you have selected to return it."),this._data}get tags(){return this._tags||ht.log.show("Tags wasn't defined, make sure you have selected to return it."),this._tags}get block(){return this._block||ht.log.show("Block wasn't defined, make sure you have selected to return it."),this._block}get parent(){return(!this._parent||!this._parent.id)&&ht.log.show("Parent wasn't defined, make sure you have selected to return it."),this._parent}constructor(t,e){this._id=t.id,this._anchor=t.anchor,this._signature=t.signature,this._recipient=t.recipient,this._owner=t.owner,this._fee=t.fee,this._quantity=t.quantity,this._data=t.data,this._tags=t.tags,this._block=t.block,t.parent&&t.parent.id&&(this._parent=t.parent),this.arweave=e}}Ue.default=Un;var kt=V&&V.__awaiter||function(r,t,e,n){function c(l){return l instanceof e?l:new e(function(o){o(l)})}return new(e||(e=Promise))(function(l,o){function u(g){try{h(n.next(g))}catch(k){o(k)}}function s(g){try{h(n.throw(g))}catch(k){o(k)}}function h(g){g.done?l(g.value):c(g.value).then(u,s)}h((n=n.apply(r,t||[])).next())})},kr=V&&V.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Se,"__esModule",{value:!0});const Wt=kr(Oe),Gt=kr(Ue),pt=Qt;class Rn{constructor(t,e=pt.LOGS.ARWEAVE){this.reqType="transactions",this.options={},this.after="",this.afterRegex=/after: *"([^"]*)"/gi,this.emptyLinesRegex=/^\s*[\r\n]/gm,this.fields=["id","anchor","signature","recipient","owner","owner.address","owner.key","fee","fee.winston","fee.ar","quantity","quantity.winston","quantity.ar","data","data.size","data.type","tags","tags.name","tags.value","block","block.id","block.timestamp","block.height","block.previous","parent","parent.id"],this.includes=new Set,this.arweave=t,pt.log.init(e,t),this.includes=new Set(this.fields)}getCursor(){return this.after}search(t="transactions"){return this.reqType=t,this.options={},this.after="",this}id(t){return this.checkSearchType(),this.options.id=t,this.options.ids=[t],this}ids(t){return this.checkSearchType(),this.options.ids=t,this.options.id=t[0],this}appName(t){return this.checkSearchType(),this.tag("App-Name",[t]),this}type(t){return this.checkSearchType(),this.tag("Content-Type",[t]),this}tags(t){this.checkSearchType();const e=[];for(const c of t){const l=typeof c.values=="string"?[c.values]:c.values;e.push({name:c.name,values:l})}const n=this.options.tags&&this.options.tags.length?this.options.tags:[];return this.options.tags=[...e,...n],this}tag(t,e){return this.checkSearchType(),this.options.tags||(this.options.tags=[]),typeof e=="string"&&(e=[e]),this.options.tags.push({name:t,values:e}),this}from(t){return this.checkSearchType(),typeof t=="string"&&(t=[t]),this.options.owners=t,this}to(t){return this.checkSearchType(),typeof t=="string"&&(t=[t]),this.options.recipients=t,this}min(t){return this.checkSearchType(),this.options.block||(this.options.block={}),this.options.block.min=t,this}max(t){return this.checkSearchType(),this.options.block||(this.options.block={}),this.options.block.max=t,this}limit(t){return this.checkSearchType(),t<1?(console.warn("Limit cannot be less than 1, setting it to 1."),t=1):t>100&&console.warn("Arweave GQL won't return more than 100 entries at once."),this.options.first=t,this}sort(t){return this.options.sort=t,this}cursor(t){return this.checkSearchType(),this.options.after=t,this}only(t){if(this.includes=new Set,typeof t=="string"&&this.fields.indexOf(t)!==-1)return this.includes.add(t),this.validateIncludes(),this;const e=[];for(const n of t)this.fields.indexOf(n)!==-1&&e.push(n);return e.length&&(this.includes=new Set(e)),this.validateIncludes(),this}exclude(t){if(this.includes=new Set(this.fields),typeof t=="string")return this.includes.delete(t),this.validateIncludes(),this;for(const e of t)this.includes.delete(e);return this.validateIncludes(),this}find(t={}){return kt(this,void 0,void 0,function*(){this.checkSearchType();for(const n of Object.keys(t))this.options[n]=t[n];this.options.first||(this.options.first=10);const e=this.construct();return this.run(e)})}findOne(t={}){return kt(this,void 0,void 0,function*(){this.checkSearchType();for(const c of Object.keys(t))this.options[c]=t[c];this.options.first=1;const e=this.construct(),n=yield this.run(e);return n.length?n[0]:null})}findAll(t={}){return kt(this,void 0,void 0,function*(){this.checkSearchType();for(const n of Object.keys(t))this.options[n]=t[n];this.options.first=100;const e=this.construct();return this.runAll(e)})}next(){return kt(this,void 0,void 0,function*(){if(!this.after||!this.after.length){pt.log.show("next(): Nothing more to search.");return}const t=this.construct().replace(this.afterRegex,`after: "${this.after}"`),e=yield this.run(t);return this.options.first===1?e.length?e[0]:null:e})}run(t){return kt(this,void 0,void 0,function*(){pt.log.show("Running query:"),pt.log.show(t);const e=yield this.get(t);if(!e)return[];if(e.transaction)return[new Gt.default(e.transaction,this.arweave)];if(e.block)return[new Wt.default(e.block)];if(e.transactions){const n=e.transactions.edges;return n&&n.length?this.after=n[n.length-1].cursor:this.after="",n.map(c=>new Gt.default(c.node,this.arweave))}else if(e.blocks){const n=e.blocks.edges;return n&&n.length?this.after=n[n.length-1].cursor:this.after="",n.map(c=>new Wt.default(c.node))}})}runAll(t){return kt(this,void 0,void 0,function*(){let e=!0,n=[],c=this.options.after||"",l=!0;for(;e;){pt.log.show("Running query:"),pt.log.show(t);const o=yield this.get(t);if(!o)return[];if(o.transaction)return[new Gt.default(o.transaction,this.arweave)];if(o.block)return[new Wt.default(o.block)];if(o.transactions){const u=o.transactions;u.edges&&u.edges.length&&(n=n.concat(u.edges),c=u.edges[u.edges.length-1].cursor,t=t.replace(this.afterRegex,`after: "${c}"`)),e=u.pageInfo.hasNextPage}else if(o.blocks){l=!1;const u=o.blocks;u.edges&&u.edges.length&&(n=n.concat(u.edges),c=u.edges[u.edges.length-1].cursor,t=t.replace(this.afterRegex,`after: "${c}"`)),e=u.pageInfo.hasNextPage}}return l?n.map(o=>new Gt.default(o.node,this.arweave)):n.map(o=>new Wt.default(o.node))})}checkSearchType(){if(!this.reqType||this.reqType!=="transaction"&&this.reqType!=="block"&&this.reqType!=="transactions"&&this.reqType!=="blocks")throw new Error('Invalid search type. Must provide one and it must be either "transaction", "transactions", "block" or "blocks"')}get(t){return kt(this,void 0,void 0,function*(){const e=yield this.arweave.api.post("graphql",{query:t},{headers:{"content-type":"application/json"}});return pt.log.show("Returned result: "),pt.log.show(e.data.data),e.data.data})}construct(){this.reqType==="transactions"||this.reqType==="blocks"?(delete this.options.id,this.reqType==="transactions"?delete this.options.height:(delete this.options.owners,delete this.options.recipients,delete this.options.tags,delete this.options.block),this.options.after||(this.options.after="")):this.options={id:this.options.id};let t=JSON.stringify(this.options,null,2).replace(/"([^"]+)":/gm,"$1: ").replace('"HEIGHT_DESC"',"HEIGHT_DESC").replace('"HEIGHT_ASC"',"HEIGHT_ASC");t=t.substring(1,t.length-1);let e="";if(this.reqType==="transaction"||this.reqType==="transactions"){let n="";this.includes.has("owner")&&(n=`owner {
          ${this.includes.has("owner.address")?"address":""}
          ${this.includes.has("owner.key")?"key":""}
        }`);let c="";this.includes.has("fee")&&(c=`fee {
          ${this.includes.has("fee.winston")?"winston":""}
          ${this.includes.has("fee.ar")?"ar":""}
        }`);let l="";this.includes.has("quantity")&&(l=`quantity {
          ${this.includes.has("quantity.winston")?"winston":""}
          ${this.includes.has("quantity.ar")?"ar":""}
        }`);let o="";this.includes.has("data")&&(o=`data {
          ${this.includes.has("data.size")?"size":""}
          ${this.includes.has("data.type")?"type":""}
        }`);let u="";this.includes.has("tags")&&(u=`tags {
          ${this.includes.has("tags.name")?"name":""}
          ${this.includes.has("tags.value")?"value":""}
        }`);let s="";this.includes.has("block")&&(s=`block {
          ${this.includes.has("block.id")?"id":""}
          ${this.includes.has("block.timestamp")?"timestamp":""}
          ${this.includes.has("block.height")?"height":""}
          ${this.includes.has("block.previous")?"previous":""}
        }`);let h="";(this.includes.has("parent")||this.includes.has("parent.id"))&&(h=`parent {
          id
        }`),e=`
      ${this.includes.has("id")?"id":""}
      ${this.includes.has("anchor")?"anchor":""}
      ${this.includes.has("signature")?"signature":""}
      ${this.includes.has("recipient")?"recipient":""}
      ${n}
      ${c}
      ${l}
      ${o}
      ${u}
      ${s}
      ${h}
      `,e=e.replace(this.emptyLinesRegex,"").trim(),e.length||(e=`
        id
        anchor
        signature
        recipient
        owner {
          address
          key
        }
        fee {
          winston
          ar
        }
        quantity {
          winston
          ar
        }
        data {
          size
          type
        }
        tags {
          name
          value
        }
        block {
          id
          timestamp
          height
          previous
        }
        parent {
          id
        }`)}else e=`
      ${this.includes.has("block.id")?"id":""}
      ${this.includes.has("block.timestamp")?"timestamp":""}
      ${this.includes.has("block.height")?"height":""}
      ${this.includes.has("block.previous")?"previous":""}
      `,e=e.replace(this.emptyLinesRegex,"").trim(),e.length||(e=`
        id
        timestamp
        height
        previous`);if((this.reqType==="transactions"||this.reqType==="blocks")&&(e=`
      pageInfo {
        hasNextPage
      }
      edges { 
        cursor
        node { 
          ${e}
        } 
      }`),!this.reqType||!t)throw new Error("Invalid options. You need to first set your options!");return`query {
      ${this.reqType}(
        ${t}
      ){
        ${e}
      }
    }`.replace(/(\r\n|\n|\r)/gm,"")}validateIncludes(){this.includes.has("owner")&&!this.includes.has("owner.address")&&!this.includes.has("owner.key")&&(this.includes.add("owner.address"),this.includes.add("owner.key")),this.includes.has("fee")&&!this.includes.has("fee.winston")&&!this.includes.has("fee.ar")&&(this.includes.add("fee.winston"),this.includes.add("fee.ar")),this.includes.has("quantity")&&!this.includes.has("quantity.winston")&&!this.includes.has("quantity.ar")&&(this.includes.add("quantity.winston"),this.includes.add("quantity.ar")),this.includes.has("data")&&!this.includes.has("data.size")&&!this.includes.has("data.type")&&(this.includes.add("data.size"),this.includes.add("data.type")),this.includes.has("tags")&&!this.includes.has("tags.name")&&!this.includes.has("tags.value")&&(this.includes.add("tags.name"),this.includes.add("tags.value")),this.includes.has("block")&&!this.includes.has("block.timestamp")&&!this.includes.has("block.height")&&!this.includes.has("block.previous")&&(this.includes.add("block.id"),this.includes.add("block.timestamp"),this.includes.add("block.height"),this.includes.add("block.previous")),!this.includes.has("owner")&&(this.includes.has("owner.address")||this.includes.has("owner.key"))&&this.includes.add("owner"),!this.includes.has("fee")&&(this.includes.has("fee.winston")||this.includes.has("fee.ar"))&&this.includes.add("fee"),!this.includes.has("quantity")&&(this.includes.has("quantity.winston")||this.includes.has("quantity.ar"))&&this.includes.add("quantity"),!this.includes.has("data")&&(this.includes.has("data.size")||this.includes.has("data.type"))&&this.includes.add("data"),!this.includes.has("tags")&&(this.includes.has("tags.name")||this.includes.has("tags.value"))&&this.includes.add("tags"),!this.includes.has("block")&&(this.includes.has("block.timestamp")||this.includes.has("block.height")||this.includes.has("block.previous"))&&this.includes.add("block")}}Se.default=Rn;var Re={},Ne={},Dt={},yt={};Object.defineProperty(yt,"__esModule",{value:!0});yt.PROTOCOL_NAME=yt.DEFAULT_BANNER_URI=yt.DEFAULT_AVATAR_URI=void 0;yt.DEFAULT_AVATAR_URI="ar://OrG-ZG2WN3wdcwvpjz1ihPe4MI24QBJUpsJGIdL85wA";yt.DEFAULT_BANNER_URI="ar://a0ieiziq2JkYhWamlrUCHxrGYnHWUAMcONxRmfkWt-k";yt.PROTOCOL_NAME=["Account-0.2","Account-0.3"];Object.defineProperty(Dt,"__esModule",{value:!0});const wt=yt;class Nn{constructor(t){this.gatewayConfig=t}getURLfromURI(t){let e;const n=this.gatewayConfig;return/^[a-zA-Z0-9\-_]{43}$/.test(t)?`${n.protocol}://${n.host}:${n.port}/${t}`:(e=t.match(/^ar:\/\/([a-zA-Z0-9\-_]{43})$/))?`${n.protocol}://${n.host}:${n.port}/${e[1]}`:/^https?:\/\/.+$/.test(t)?t:`${n.protocol}://${n.host}:${n.port}/${wt.DEFAULT_AVATAR_URI}`}getUniqueHandle(t,e){return e&&typeof e=="string"?`@${e}#${t.slice(0,3)}${t.slice(t.length-3)}`:`${t.slice(0,5)}...${t.slice(t.length-5)}`}isEncodedAccount(t){return t.handle!==void 0&&t.handle.length>0}isProfile(t){return t.handleName!==void 0&&t.handleName.length>0&&t.links!==void 0}getDefaultAccount(t){return{txid:null,addr:t,handle:this.getUniqueHandle(t),profile:{handleName:"",avatar:wt.DEFAULT_AVATAR_URI,avatarURL:this.getURLfromURI(wt.DEFAULT_AVATAR_URI),banner:wt.DEFAULT_BANNER_URI,bannerURL:this.getURLfromURI(wt.DEFAULT_BANNER_URI),name:"",bio:"",email:"",links:{},wallets:{}}}}encode(t){let e={handle:t.handleName};return t.avatar&&(e=Object.assign(Object.assign({},e),{avatar:t.avatar})),t.banner&&(e=Object.assign(Object.assign({},e),{banner:t.banner})),t.name&&(e=Object.assign(Object.assign({},e),{name:t.name})),t.bio&&(e=Object.assign(Object.assign({},e),{bio:t.bio})),t.email&&(e=Object.assign(Object.assign({},e),{email:t.email})),t.links&&(e=Object.assign(Object.assign({},e),{links:t.links})),t.wallets&&(e=Object.assign(Object.assign({},e),{wallets:t.wallets})),e}decode(t,e,n){return this.isEncodedAccount(n)?{txid:t,addr:e,handle:this.getUniqueHandle(e,n.handle),profile:{handleName:n.handle?n.handle:"",avatar:n.avatar?n.avatar:wt.DEFAULT_AVATAR_URI,avatarURL:n.avatar?this.getURLfromURI(n.avatar):this.getURLfromURI(wt.DEFAULT_AVATAR_URI),banner:n.banner?n.banner:wt.DEFAULT_BANNER_URI,bannerURL:n.banner?this.getURLfromURI(n.banner):this.getURLfromURI(wt.DEFAULT_BANNER_URI),name:n.name?n.name:"",bio:n.bio?n.bio:"",email:n.email?n.email:"",links:n.links?n.links:{},wallets:n.wallets?n.wallets:{}}}:this.getDefaultAccount(e)}}Dt.default=Nn;var Bn=V&&V.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ne,"__esModule",{value:!0});const $n=Bn(Dt);class Cn{constructor(t,e,n){this.expirationTime=e,this.size=t,this.data=new $n.default(n),localStorage.getItem("arweave-account")||localStorage.setItem("arweave-account","[]")}get(t){var e;const c=(e=JSON.parse(localStorage.getItem("arweave-account")).find(l=>l.addr===t&&Date.now()<l.timestamp+this.expirationTime))===null||e===void 0?void 0:e.account;if(c)return c;if(c===null)return this.data.getDefaultAccount(t)}find(t){var e;return(e=JSON.parse(localStorage.getItem("arweave-account")).find(c=>{var l;return((l=c.account)===null||l===void 0?void 0:l.handle)===t&&Date.now()<c.timestamp+this.expirationTime}))===null||e===void 0?void 0:e.account}hydrate(t,e){const n={timestamp:Date.now(),addr:t,account:e||null},c=JSON.parse(localStorage.getItem("arweave-account")),l=c.findIndex(o=>o.addr===n.addr);l!==-1?c.splice(l,1,n):(c.unshift(n),c.length>this.size&&c.pop()),localStorage.setItem("arweave-account",JSON.stringify(c))}reset(){localStorage.setItem("arweave-account","[]")}dump(){return localStorage.getItem("arweave-account")}}Ne.default=Cn;var Be={},In=V&&V.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Be,"__esModule",{value:!0});const Pn=In(Dt);class xn{constructor(t,e,n){this.store=new Map,this.expirationTime=e,this.size=t,this.data=new Pn.default(n)}get(t){var e;const n=this.store.get(t);if(n&&Date.now()<n.timestamp+this.expirationTime){const c=(e=this.store.get(t))===null||e===void 0?void 0:e.account;if(c)return c;if(c===null)return this.data.getDefaultAccount(t)}}find(t){var e,n;for(const[c,l]of this.store){const o=(n=(e=l.account)===null||e===void 0?void 0:e.profile)===null||n===void 0?void 0:n.handleName;if(t===o&&Date.now()<l.timestamp+this.expirationTime)return l.account}}hydrate(t,e){const n={timestamp:Date.now(),addr:t,account:e||null};this.store.set(n.addr,n),this.store.size>=this.size&&this.store.delete(this.store.keys().next().value)}reset(){this.store.clear()}dump(){return this.store}}Be.default=xn;var Sr=V&&V.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Re,"__esModule",{value:!0});const Dn=Sr(Ne),Ln=Sr(Be);class Mn{constructor(t,e,n,c){if(this.select={web:()=>new Dn.default(this.size,this.expirationTime,this.gatewayConfig),node:()=>new Ln.default(this.size,this.expirationTime,this.gatewayConfig)},this.get=l=>this.cacheObj.get(l),this.find=l=>this.cacheObj.find(l),this.hydrate=(l,o)=>this.cacheObj.hydrate(l,o),this.reset=()=>this.cacheObj.reset(),this.dump=()=>this.cacheObj.dump(),this.size=e,this.expirationTime=n,this.gatewayConfig=c,typeof t=="object")this.cacheObj=t;else if(this.select[t])this.cacheObj=this.select[t]();else throw new Error(`Cache for the '${t}' environment is not implemented.`)}}Re.default=Mn;var St=V&&V.__awaiter||function(r,t,e,n){function c(l){return l instanceof e?l:new e(function(o){o(l)})}return new(e||(e=Promise))(function(l,o){function u(g){try{h(n.next(g))}catch(k){o(k)}}function s(g){try{h(n.throw(g))}catch(k){o(k)}}function h(g){g.done?l(g.value):c(g.value).then(u,s)}h((n=n.apply(r,t||[])).next())})},te=V&&V.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(dr,"__esModule",{value:!0});const qn=te(gr),jn=te(Se),Ye=te(Re),Hn=te(Dt),Ct=yt;class Kn{constructor({cacheIsActivated:t=!0,cacheSize:e=100,cacheTime:n=6e4,gateway:c={host:"arweave.net",port:443,protocol:"https",timeout:2e4,logging:!1}}={}){this.walletAddr=null,this.debug={resetCache:()=>{var l;(l=this.cache)===null||l===void 0||l.reset()},printCache:()=>{var l;const o=new Date;console.log(` > Cache content at ${o.toISOString().replace(/T/," ").replace(/\..+/,"")}
`),console.log((l=this.cache)===null||l===void 0?void 0:l.dump())}},this.arweave=qn.default.init(c),this.ardb=new jn.default(this.arweave),this.data=new Hn.default(c),t?typeof window<"u"?this.cache=new Ye.default("web",e,n,c):this.cache=new Ye.default("node",e,n,c):this.cache=null}connect(t="use_wallet"){return St(this,void 0,void 0,function*(){this.walletAddr=yield this.arweave.wallets.getAddress(t)})}updateProfile(t){var e;return St(this,void 0,void 0,function*(){if(!this.walletAddr)throw Error("Method connect() should be called before updateProfile().");if(!this.data.isProfile(t))throw Error(`Object "${JSON.stringify(t)}" doesn't match with the shape of a T_profile object.
Typescript tip: import { T_profile } from 'arweave-account'`);const n=this.data.encode(t),c=JSON.stringify(n),l=yield this.arweave.createTransaction({data:c});l.addTag("Protocol-Name",Ct.PROTOCOL_NAME[Ct.PROTOCOL_NAME.length-1]),l.addTag("handle",t.handleName);let o=l;try{if(window.arweaveWallet)o=yield window.arweaveWallet.dispatch(l);else throw"no window.arweaveWallet"}catch{try{yield this.arweave.transactions.sign(l),yield this.arweave.transactions.post(l)}catch(s){throw s}}if(n){const u=this.data.decode(l.id,this.walletAddr,n);(e=this.cache)===null||e===void 0||e.hydrate(this.walletAddr,u)}return o})}get(t){var e,n;return St(this,void 0,void 0,function*(){if(t=t.trim(),!/^[a-zA-Z0-9\-_]{43}$/.test(t))throw"Invalid wallet address argument";const c=(e=this.cache)===null||e===void 0?void 0:e.get(t);if(c)return c;{const l=yield this.ardb.search("transactions").tag("Protocol-Name",Ct.PROTOCOL_NAME).from(t).limit(1).find(),o=l[0]?l[0].id:null,u=o?(yield this.arweave.api.get(o).catch(()=>({data:null}))).data:{data:null};try{const s=this.data.decode(o,t,JSON.parse(u));return(n=this.cache)===null||n===void 0||n.hydrate(t,s),s}catch{return this.data.getDefaultAccount(t)}}})}search(t){return St(this,void 0,void 0,function*(){const n=(yield this.ardb.search("transactions").tag("Protocol-Name",Ct.PROTOCOL_NAME).tag("handle",t).limit(100).find()).map(l=>St(this,void 0,void 0,function*(){var o;const u=l.id,s="owner"in l?l.owner.address:"anonymous",h=(yield this.arweave.api.get(u).catch(()=>({data:null}))).data;try{const g=this.data.decode(u,s,JSON.parse(h));return(o=this.cache)===null||o===void 0||o.hydrate(s,g),g}catch{return this.data.getDefaultAccount(s)}}));return(yield Promise.all(n)).filter((l,o,u)=>l!==null&&u.findIndex(s=>(s==null?void 0:s.addr)===(l==null?void 0:l.addr))===o)})}find(t){var e;return St(this,void 0,void 0,function*(){if(t=t.trim(),!/^(.+)#[a-zA-Z0-9\-\_]{6}$/.test(t))return null;const n=(e=this.cache)===null||e===void 0?void 0:e.find(t);if(n!==void 0)return n;{const l=(yield this.ardb.search("transactions").tag("Protocol-Name",Ct.PROTOCOL_NAME).tag("handle",t.slice(0,-7)).limit(100).find()).map(h=>St(this,void 0,void 0,function*(){var g;const k=h.id,C="owner"in h?h.owner.address:"anonymous",R=(yield this.arweave.api.get(k).catch(()=>({data:null}))).data;try{const $=this.data.decode(k,C,JSON.parse(R));return(g=this.cache)===null||g===void 0||g.hydrate(C,$),$}catch{return this.data.getDefaultAccount(C)}})),u=(yield Promise.all(l)).filter(h=>h!==void 0);return u.forEach(h=>{var g;(g=this.cache)===null||g===void 0||g.hydrate(h.addr,h)}),u.find(h=>h.handle.includes(t))||null}})}}var ra=dr.default=Kn;export{ea as A,ra as _,Xt as a,It as b,V as c,zn as g,G as u,Qe as w};
